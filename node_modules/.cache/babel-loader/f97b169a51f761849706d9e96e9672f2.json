{"ast":null,"code":"import _possibleConstructorReturn from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _wrapNativeSuper from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper\";\nimport _createForOfIteratorHelper from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport _toConsumableArray from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _inherits from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";\nimport _slicedToArray from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _objectWithoutProperties from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nimport _regeneratorRuntime from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _awaitAsyncGenerator from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/awaitAsyncGenerator\";\nimport _wrapAsyncGenerator from \"C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/wrapAsyncGenerator\";\nvar _DATA_MAPPING;\nvar _excluded = [\"timeoutMs\", \"url\"],\n  _excluded2 = [\"path\", \"url\", \"tokenType\", \"user\"];\nfunction _asyncIterator(iterable) { var method, async, sync, retry = 2; for (\"undefined\" != typeof Symbol && (async = Symbol.asyncIterator, sync = Symbol.iterator); retry--;) { if (async && null != (method = iterable[async])) return method.call(iterable); if (sync && null != (method = iterable[sync])) return new AsyncFromSyncIterator(method.call(iterable)); async = \"@@asyncIterator\", sync = \"@@iterator\"; } throw new TypeError(\"Object is not async iterable\"); }\nfunction AsyncFromSyncIterator(s) { function AsyncFromSyncIteratorContinuation(r) { if (Object(r) !== r) return Promise.reject(new TypeError(r + \" is not an object.\")); var done = r.done; return Promise.resolve(r.value).then(function (value) { return { value: value, done: done }; }); } return AsyncFromSyncIterator = function AsyncFromSyncIterator(s) { this.s = s, this.n = s.next; }, AsyncFromSyncIterator.prototype = { s: null, n: null, next: function next() { return AsyncFromSyncIteratorContinuation(this.n.apply(this.s, arguments)); }, return: function _return(value) { var ret = this.s.return; return void 0 === ret ? Promise.resolve({ value: value, done: !0 }) : AsyncFromSyncIteratorContinuation(ret.apply(this.s, arguments)); }, throw: function _throw(value) { var thr = this.s.return; return void 0 === thr ? Promise.reject(value) : AsyncFromSyncIteratorContinuation(thr.apply(this.s, arguments)); } }, new AsyncFromSyncIterator(s); }\nimport { EJSON, ObjectId } from 'bson';\nimport * as bson from 'bson';\nexport { bson as BSON };\nvar __spreadArray = undefined && undefined.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar BrowserInfo = /** @class */function () {\n  function BrowserInfo(name, version, os) {\n    this.name = name;\n    this.version = version;\n    this.os = os;\n    this.type = 'browser';\n  }\n  return BrowserInfo;\n}();\nvar NodeInfo = /** @class */function () {\n  function NodeInfo(version) {\n    this.version = version;\n    this.type = 'node';\n    this.name = 'node';\n    this.os = process.platform;\n  }\n  return NodeInfo;\n}();\nvar SearchBotDeviceInfo = /** @class */function () {\n  function SearchBotDeviceInfo(name, version, os, bot) {\n    this.name = name;\n    this.version = version;\n    this.os = os;\n    this.bot = bot;\n    this.type = 'bot-device';\n  }\n  return SearchBotDeviceInfo;\n}();\nvar BotInfo = /** @class */function () {\n  function BotInfo() {\n    this.type = 'bot';\n    this.bot = true; // NOTE: deprecated test name instead\n    this.name = 'bot';\n    this.version = null;\n    this.os = null;\n  }\n  return BotInfo;\n}();\nvar ReactNativeInfo = /** @class */function () {\n  function ReactNativeInfo() {\n    this.type = 'react-native';\n    this.name = 'react-native';\n    this.version = null;\n    this.os = null;\n  }\n  return ReactNativeInfo;\n}();\n// tslint:disable-next-line:max-line-length\nvar SEARCHBOX_UA_REGEX = /alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/;\nvar SEARCHBOT_OS_REGEX = /(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\\ Jeeves\\/Teoma|ia_archiver)/;\nvar REQUIRED_VERSION_PARTS = 3;\nvar userAgentRules = [['aol', /AOLShield\\/([0-9\\._]+)/], ['edge', /Edge\\/([0-9\\._]+)/], ['edge-ios', /EdgiOS\\/([0-9\\._]+)/], ['yandexbrowser', /YaBrowser\\/([0-9\\._]+)/], ['kakaotalk', /KAKAOTALK\\s([0-9\\.]+)/], ['samsung', /SamsungBrowser\\/([0-9\\.]+)/], ['silk', /\\bSilk\\/([0-9._-]+)\\b/], ['miui', /MiuiBrowser\\/([0-9\\.]+)$/], ['beaker', /BeakerBrowser\\/([0-9\\.]+)/], ['edge-chromium', /EdgA?\\/([0-9\\.]+)/], ['chromium-webview', /(?!Chrom.*OPR)wv\\).*Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/], ['chrome', /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/], ['phantomjs', /PhantomJS\\/([0-9\\.]+)(:?\\s|$)/], ['crios', /CriOS\\/([0-9\\.]+)(:?\\s|$)/], ['firefox', /Firefox\\/([0-9\\.]+)(?:\\s|$)/], ['fxios', /FxiOS\\/([0-9\\.]+)/], ['opera-mini', /Opera Mini.*Version\\/([0-9\\.]+)/], ['opera', /Opera\\/([0-9\\.]+)(?:\\s|$)/], ['opera', /OPR\\/([0-9\\.]+)(:?\\s|$)/], ['ie', /Trident\\/7\\.0.*rv\\:([0-9\\.]+).*\\).*Gecko$/], ['ie', /MSIE\\s([0-9\\.]+);.*Trident\\/[4-7].0/], ['ie', /MSIE\\s(7\\.0)/], ['bb10', /BB10;\\sTouch.*Version\\/([0-9\\.]+)/], ['android', /Android\\s([0-9\\.]+)/], ['ios', /Version\\/([0-9\\._]+).*Mobile.*Safari.*/], ['safari', /Version\\/([0-9\\._]+).*Safari/], ['facebook', /FB[AS]V\\/([0-9\\.]+)/], ['instagram', /Instagram\\s([0-9\\.]+)/], ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Mobile/], ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Gecko\\)$/], ['curl', /^curl\\/([0-9\\.]+)$/], ['searchbot', SEARCHBOX_UA_REGEX]];\nvar operatingSystemRules = [['iOS', /iP(hone|od|ad)/], ['Android OS', /Android/], ['BlackBerry OS', /BlackBerry|BB10/], ['Windows Mobile', /IEMobile/], ['Amazon OS', /Kindle/], ['Windows 3.11', /Win16/], ['Windows 95', /(Windows 95)|(Win95)|(Windows_95)/], ['Windows 98', /(Windows 98)|(Win98)/], ['Windows 2000', /(Windows NT 5.0)|(Windows 2000)/], ['Windows XP', /(Windows NT 5.1)|(Windows XP)/], ['Windows Server 2003', /(Windows NT 5.2)/], ['Windows Vista', /(Windows NT 6.0)/], ['Windows 7', /(Windows NT 6.1)/], ['Windows 8', /(Windows NT 6.2)/], ['Windows 8.1', /(Windows NT 6.3)/], ['Windows 10', /(Windows NT 10.0)/], ['Windows ME', /Windows ME/], ['Open BSD', /OpenBSD/], ['Sun OS', /SunOS/], ['Chrome OS', /CrOS/], ['Linux', /(Linux)|(X11)/], ['Mac OS', /(Mac_PowerPC)|(Macintosh)/], ['QNX', /QNX/], ['BeOS', /BeOS/], ['OS/2', /OS\\/2/]];\nfunction detect(userAgent) {\n  if (!!userAgent) {\n    return parseUserAgent(userAgent);\n  }\n  if (typeof document === 'undefined' && typeof navigator !== 'undefined' && navigator.product === 'ReactNative') {\n    return new ReactNativeInfo();\n  }\n  if (typeof navigator !== 'undefined') {\n    return parseUserAgent(navigator.userAgent);\n  }\n  return getNodeVersion();\n}\nfunction matchUserAgent(ua) {\n  // opted for using reduce here rather than Array#first with a regex.test call\n  // this is primarily because using the reduce we only perform the regex\n  // execution once rather than once for the test and for the exec again below\n  // probably something that needs to be benchmarked though\n  return ua !== '' && userAgentRules.reduce(function (matched, _a) {\n    var browser = _a[0],\n      regex = _a[1];\n    if (matched) {\n      return matched;\n    }\n    var uaMatch = regex.exec(ua);\n    return !!uaMatch && [browser, uaMatch];\n  }, false);\n}\nfunction parseUserAgent(ua) {\n  var matchedRule = matchUserAgent(ua);\n  if (!matchedRule) {\n    return null;\n  }\n  var name = matchedRule[0],\n    match = matchedRule[1];\n  if (name === 'searchbot') {\n    return new BotInfo();\n  }\n  // Do not use RegExp for split operation as some browser do not support it (See: http://blog.stevenlevithan.com/archives/cross-browser-split)\n  var versionParts = match[1] && match[1].split('.').join('_').split('_').slice(0, 3);\n  if (versionParts) {\n    if (versionParts.length < REQUIRED_VERSION_PARTS) {\n      versionParts = __spreadArray(__spreadArray([], versionParts, true), createVersionParts(REQUIRED_VERSION_PARTS - versionParts.length), true);\n    }\n  } else {\n    versionParts = [];\n  }\n  var version = versionParts.join('.');\n  var os = detectOS(ua);\n  var searchBotMatch = SEARCHBOT_OS_REGEX.exec(ua);\n  if (searchBotMatch && searchBotMatch[1]) {\n    return new SearchBotDeviceInfo(name, version, os, searchBotMatch[1]);\n  }\n  return new BrowserInfo(name, version, os);\n}\nfunction detectOS(ua) {\n  for (var ii = 0, count = operatingSystemRules.length; ii < count; ii++) {\n    var _a = operatingSystemRules[ii],\n      os = _a[0],\n      regex = _a[1];\n    var match = regex.exec(ua);\n    if (match) {\n      return os;\n    }\n  }\n  return null;\n}\nfunction getNodeVersion() {\n  var isNode = typeof process !== 'undefined' && process.version;\n  return isNode ? new NodeInfo(process.version.slice(1)) : null;\n}\nfunction createVersionParts(count) {\n  var output = [];\n  for (var ii = 0; ii < count; ii++) {\n    output.push('0');\n  }\n  return output;\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\nvar DefaultNetworkTransport = /*#__PURE__*/function () {\n  function DefaultNetworkTransport() {\n    _classCallCheck(this, DefaultNetworkTransport);\n    if (!DefaultNetworkTransport.fetch) {\n      throw new Error(\"DefaultNetworkTransport.fetch must be set before it's used\");\n    }\n    if (!DefaultNetworkTransport.AbortController) {\n      throw new Error(\"DefaultNetworkTransport.AbortController must be set before it's used\");\n    }\n  }\n  _createClass(DefaultNetworkTransport, [{\n    key: \"fetchWithCallbacks\",\n    value: function fetchWithCallbacks(request, handler) {\n      // tslint:disable-next-line: no-console\n      this.fetch(request).then( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(response) {\n          var decodedBody, responseHeaders;\n          return _regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return response.text();\n                case 2:\n                  decodedBody = _context.sent;\n                  // Pull out the headers of the response\n                  responseHeaders = {};\n                  response.headers.forEach(function (value, key) {\n                    responseHeaders[key] = value;\n                  });\n                  return _context.abrupt(\"return\", {\n                    statusCode: response.status,\n                    headers: responseHeaders,\n                    body: decodedBody\n                  });\n                case 6:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee);\n        }));\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }()).then(function (r) {\n        return handler.onSuccess(r);\n      }).catch(function (e) {\n        return handler.onError(e);\n      });\n    }\n  }, {\n    key: \"fetch\",\n    value: function () {\n      var _fetch = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(request) {\n        var timeoutMs, url, rest, _this$createTimeoutSi, signal, cancelTimeout;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                timeoutMs = request.timeoutMs, url = request.url, rest = _objectWithoutProperties(request, _excluded);\n                _this$createTimeoutSi = this.createTimeoutSignal(timeoutMs), signal = _this$createTimeoutSi.signal, cancelTimeout = _this$createTimeoutSi.cancelTimeout;\n                _context2.prev = 2;\n                _context2.next = 5;\n                return DefaultNetworkTransport.fetch(url, _objectSpread(_objectSpread({}, DefaultNetworkTransport.extraFetchOptions), {}, {\n                  signal: signal\n                }, rest));\n              case 5:\n                return _context2.abrupt(\"return\", _context2.sent);\n              case 6:\n                _context2.prev = 6;\n                // Whatever happens, cancel any timeout\n                cancelTimeout();\n                return _context2.finish(6);\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this, [[2,, 6, 9]]);\n      }));\n      function fetch(_x2) {\n        return _fetch.apply(this, arguments);\n      }\n      return fetch;\n    }()\n  }, {\n    key: \"createTimeoutSignal\",\n    value: function createTimeoutSignal(timeoutMs) {\n      if (typeof timeoutMs === \"number\") {\n        var controller = new DefaultNetworkTransport.AbortController();\n        // Call abort after a specific number of milliseconds\n        var timeout = setTimeout(function () {\n          controller.abort();\n        }, timeoutMs);\n        return {\n          signal: controller.signal,\n          cancelTimeout: function cancelTimeout() {\n            clearTimeout(timeout);\n          }\n        };\n      } else {\n        return {\n          signal: undefined,\n          cancelTimeout: function cancelTimeout() {\n            /* No-op */\n          }\n        };\n      }\n    }\n  }]);\n  return DefaultNetworkTransport;\n}();\nDefaultNetworkTransport.DEFAULT_HEADERS = {\n  \"Content-Type\": \"application/json\"\n};\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Set the value of `isDevelopmentMode`. This allows each entry point (node vs DOM)\n * to use its own method for determining whether we are in development mode.\n *\n * @param state A boolean indicating whether the user's app is running in\n * development mode or not.\n */\nvar setIsDevelopmentMode = function setIsDevelopmentMode(state) {};\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2022 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n// Exports a globalThis which is polyfilled for iOS 11/12\n// From https://github.com/zloirock/core-js/blob/master/packages/core-js/internals/global.js\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nvar check = function check(it) {\n  return it && it.Math == Math && it;\n};\n// eslint-disable-next-line no-restricted-globals\nvar safeGlobalThis =\n// eslint-disable-next-line no-restricted-globals\ncheck(typeof globalThis == \"object\" && globalThis) || check(typeof window == \"object\" && window) ||\n// eslint-disable-next-line no-restricted-globals -- safe\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore allow `self`\ncheck(typeof self == \"object\" && self) ||\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore allow `global`\ncheck(typeof global == \"object\" && global) ||\n// eslint-disable-next-line no-new-func -- fallback\nfunction () {\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore allow `this`\n  return this;\n}() || Function(\"return this\")();\n\n////////////////////////////////////////////////////////////////////////////\n// React/React Native set a global __DEV__ variable when running in dev mode\nsetIsDevelopmentMode(typeof __DEV__ !== \"undefined\" && __DEV__);\n\n////////////////////////////////////////////////////////////////////////////\nDefaultNetworkTransport.fetch = safeGlobalThis.fetch.bind(safeGlobalThis);\nDefaultNetworkTransport.AbortController = safeGlobalThis.AbortController.bind(safeGlobalThis);\n\n/**\n *  base64.ts\n *\n *  Licensed under the BSD 3-Clause License.\n *    http://opensource.org/licenses/BSD-3-Clause\n *\n *  References:\n *    http://en.wikipedia.org/wiki/Base64\n *\n * @author Dan Kogai (https://github.com/dankogai)\n */\nvar version = '3.7.2';\n/**\n * @deprecated use lowercase `version`.\n */\nvar VERSION = version;\nvar _hasatob = typeof atob === 'function';\nvar _hasbtoa = typeof btoa === 'function';\nvar _hasBuffer = typeof Buffer === 'function';\nvar _TD = typeof TextDecoder === 'function' ? new TextDecoder() : undefined;\nvar _TE = typeof TextEncoder === 'function' ? new TextEncoder() : undefined;\nvar b64ch = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\nvar b64chs = Array.prototype.slice.call(b64ch);\nvar b64tab = function (a) {\n  var tab = {};\n  a.forEach(function (c, i) {\n    return tab[c] = i;\n  });\n  return tab;\n}(b64chs);\nvar b64re = /^(?:[A-Za-z\\d+\\/]{4})*?(?:[A-Za-z\\d+\\/]{2}(?:==)?|[A-Za-z\\d+\\/]{3}=?)?$/;\nvar _fromCC = String.fromCharCode.bind(String);\nvar _U8Afrom = typeof Uint8Array.from === 'function' ? Uint8Array.from.bind(Uint8Array) : function (it) {\n  var fn = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function (x) {\n    return x;\n  };\n  return new Uint8Array(Array.prototype.slice.call(it, 0).map(fn));\n};\nvar _mkUriSafe = function _mkUriSafe(src) {\n  return src.replace(/=/g, '').replace(/[+\\/]/g, function (m0) {\n    return m0 == '+' ? '-' : '_';\n  });\n};\nvar _tidyB64 = function _tidyB64(s) {\n  return s.replace(/[^A-Za-z0-9\\+\\/]/g, '');\n};\n/**\n * polyfill version of `btoa`\n */\nvar btoaPolyfill = function btoaPolyfill(bin) {\n  // console.log('polyfilled');\n  var u32,\n    c0,\n    c1,\n    c2,\n    asc = '';\n  var pad = bin.length % 3;\n  for (var i = 0; i < bin.length;) {\n    if ((c0 = bin.charCodeAt(i++)) > 255 || (c1 = bin.charCodeAt(i++)) > 255 || (c2 = bin.charCodeAt(i++)) > 255) throw new TypeError('invalid character found');\n    u32 = c0 << 16 | c1 << 8 | c2;\n    asc += b64chs[u32 >> 18 & 63] + b64chs[u32 >> 12 & 63] + b64chs[u32 >> 6 & 63] + b64chs[u32 & 63];\n  }\n  return pad ? asc.slice(0, pad - 3) + \"===\".substring(pad) : asc;\n};\n/**\n * does what `window.btoa` of web browsers do.\n * @param {String} bin binary string\n * @returns {string} Base64-encoded string\n */\nvar _btoa = _hasbtoa ? function (bin) {\n  return btoa(bin);\n} : _hasBuffer ? function (bin) {\n  return Buffer.from(bin, 'binary').toString('base64');\n} : btoaPolyfill;\nvar _fromUint8Array = _hasBuffer ? function (u8a) {\n  return Buffer.from(u8a).toString('base64');\n} : function (u8a) {\n  // cf. https://stackoverflow.com/questions/12710001/how-to-convert-uint8-array-to-base64-encoded-string/12713326#12713326\n  var maxargs = 0x1000;\n  var strs = [];\n  for (var i = 0, l = u8a.length; i < l; i += maxargs) {\n    strs.push(_fromCC.apply(null, u8a.subarray(i, i + maxargs)));\n  }\n  return _btoa(strs.join(''));\n};\n/**\n * converts a Uint8Array to a Base64 string.\n * @param {boolean} [urlsafe] URL-and-filename-safe a la RFC4648 ยง5\n * @returns {string} Base64 string\n */\nvar fromUint8Array = function fromUint8Array(u8a) {\n  var urlsafe = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  return urlsafe ? _mkUriSafe(_fromUint8Array(u8a)) : _fromUint8Array(u8a);\n};\n// This trick is found broken https://github.com/dankogai/js-base64/issues/130\n// const utob = (src: string) => unescape(encodeURIComponent(src));\n// reverting good old fationed regexp\nvar cb_utob = function cb_utob(c) {\n  if (c.length < 2) {\n    var cc = c.charCodeAt(0);\n    return cc < 0x80 ? c : cc < 0x800 ? _fromCC(0xc0 | cc >>> 6) + _fromCC(0x80 | cc & 0x3f) : _fromCC(0xe0 | cc >>> 12 & 0x0f) + _fromCC(0x80 | cc >>> 6 & 0x3f) + _fromCC(0x80 | cc & 0x3f);\n  } else {\n    var cc = 0x10000 + (c.charCodeAt(0) - 0xD800) * 0x400 + (c.charCodeAt(1) - 0xDC00);\n    return _fromCC(0xf0 | cc >>> 18 & 0x07) + _fromCC(0x80 | cc >>> 12 & 0x3f) + _fromCC(0x80 | cc >>> 6 & 0x3f) + _fromCC(0x80 | cc & 0x3f);\n  }\n};\nvar re_utob = /[\\uD800-\\uDBFF][\\uDC00-\\uDFFFF]|[^\\x00-\\x7F]/g;\n/**\n * @deprecated should have been internal use only.\n * @param {string} src UTF-8 string\n * @returns {string} UTF-16 string\n */\nvar utob = function utob(u) {\n  return u.replace(re_utob, cb_utob);\n};\n//\nvar _encode = _hasBuffer ? function (s) {\n  return Buffer.from(s, 'utf8').toString('base64');\n} : _TE ? function (s) {\n  return _fromUint8Array(_TE.encode(s));\n} : function (s) {\n  return _btoa(utob(s));\n};\n/**\n * converts a UTF-8-encoded string to a Base64 string.\n * @param {boolean} [urlsafe] if `true` make the result URL-safe\n * @returns {string} Base64 string\n */\nvar encode = function encode(src) {\n  var urlsafe = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  return urlsafe ? _mkUriSafe(_encode(src)) : _encode(src);\n};\n/**\n * converts a UTF-8-encoded string to URL-safe Base64 RFC4648 ยง5.\n * @returns {string} Base64 string\n */\nvar encodeURI = function encodeURI(src) {\n  return encode(src, true);\n};\n// This trick is found broken https://github.com/dankogai/js-base64/issues/130\n// const btou = (src: string) => decodeURIComponent(escape(src));\n// reverting good old fationed regexp\nvar re_btou = /[\\xC0-\\xDF][\\x80-\\xBF]|[\\xE0-\\xEF][\\x80-\\xBF]{2}|[\\xF0-\\xF7][\\x80-\\xBF]{3}/g;\nvar cb_btou = function cb_btou(cccc) {\n  switch (cccc.length) {\n    case 4:\n      var cp = (0x07 & cccc.charCodeAt(0)) << 18 | (0x3f & cccc.charCodeAt(1)) << 12 | (0x3f & cccc.charCodeAt(2)) << 6 | 0x3f & cccc.charCodeAt(3),\n        offset = cp - 0x10000;\n      return _fromCC((offset >>> 10) + 0xD800) + _fromCC((offset & 0x3FF) + 0xDC00);\n    case 3:\n      return _fromCC((0x0f & cccc.charCodeAt(0)) << 12 | (0x3f & cccc.charCodeAt(1)) << 6 | 0x3f & cccc.charCodeAt(2));\n    default:\n      return _fromCC((0x1f & cccc.charCodeAt(0)) << 6 | 0x3f & cccc.charCodeAt(1));\n  }\n};\n/**\n * @deprecated should have been internal use only.\n * @param {string} src UTF-16 string\n * @returns {string} UTF-8 string\n */\nvar btou = function btou(b) {\n  return b.replace(re_btou, cb_btou);\n};\n/**\n * polyfill version of `atob`\n */\nvar atobPolyfill = function atobPolyfill(asc) {\n  // console.log('polyfilled');\n  asc = asc.replace(/\\s+/g, '');\n  if (!b64re.test(asc)) throw new TypeError('malformed base64.');\n  asc += '=='.slice(2 - (asc.length & 3));\n  var u24,\n    bin = '',\n    r1,\n    r2;\n  for (var i = 0; i < asc.length;) {\n    u24 = b64tab[asc.charAt(i++)] << 18 | b64tab[asc.charAt(i++)] << 12 | (r1 = b64tab[asc.charAt(i++)]) << 6 | (r2 = b64tab[asc.charAt(i++)]);\n    bin += r1 === 64 ? _fromCC(u24 >> 16 & 255) : r2 === 64 ? _fromCC(u24 >> 16 & 255, u24 >> 8 & 255) : _fromCC(u24 >> 16 & 255, u24 >> 8 & 255, u24 & 255);\n  }\n  return bin;\n};\n/**\n * does what `window.atob` of web browsers do.\n * @param {String} asc Base64-encoded string\n * @returns {string} binary string\n */\nvar _atob = _hasatob ? function (asc) {\n  return atob(_tidyB64(asc));\n} : _hasBuffer ? function (asc) {\n  return Buffer.from(asc, 'base64').toString('binary');\n} : atobPolyfill;\n//\nvar _toUint8Array = _hasBuffer ? function (a) {\n  return _U8Afrom(Buffer.from(a, 'base64'));\n} : function (a) {\n  return _U8Afrom(_atob(a), function (c) {\n    return c.charCodeAt(0);\n  });\n};\n/**\n * converts a Base64 string to a Uint8Array.\n */\nvar toUint8Array = function toUint8Array(a) {\n  return _toUint8Array(_unURI(a));\n};\n//\nvar _decode = _hasBuffer ? function (a) {\n  return Buffer.from(a, 'base64').toString('utf8');\n} : _TD ? function (a) {\n  return _TD.decode(_toUint8Array(a));\n} : function (a) {\n  return btou(_atob(a));\n};\nvar _unURI = function _unURI(a) {\n  return _tidyB64(a.replace(/[-_]/g, function (m0) {\n    return m0 == '-' ? '+' : '/';\n  }));\n};\n/**\n * converts a Base64 string to a UTF-8 string.\n * @param {String} src Base64 string.  Both normal and URL-safe are supported\n * @returns {string} UTF-8 string\n */\nvar decode = function decode(src) {\n  return _decode(_unURI(src));\n};\n/**\n * check if a value is a valid Base64 string\n * @param {String} src a value to check\n  */\nvar isValid = function isValid(src) {\n  if (typeof src !== 'string') return false;\n  var s = src.replace(/\\s+/g, '').replace(/={0,2}$/, '');\n  return !/[^\\s0-9a-zA-Z\\+/]/.test(s) || !/[^\\s0-9a-zA-Z\\-_]/.test(s);\n};\n//\nvar _noEnum = function _noEnum(v) {\n  return {\n    value: v,\n    enumerable: false,\n    writable: true,\n    configurable: true\n  };\n};\n/**\n * extend String.prototype with relevant methods\n */\nvar extendString = function extendString() {\n  var _add = function _add(name, body) {\n    return Object.defineProperty(String.prototype, name, _noEnum(body));\n  };\n  _add('fromBase64', function () {\n    return decode(this);\n  });\n  _add('toBase64', function (urlsafe) {\n    return encode(this, urlsafe);\n  });\n  _add('toBase64URI', function () {\n    return encode(this, true);\n  });\n  _add('toBase64URL', function () {\n    return encode(this, true);\n  });\n  _add('toUint8Array', function () {\n    return toUint8Array(this);\n  });\n};\n/**\n * extend Uint8Array.prototype with relevant methods\n */\nvar extendUint8Array = function extendUint8Array() {\n  var _add = function _add(name, body) {\n    return Object.defineProperty(Uint8Array.prototype, name, _noEnum(body));\n  };\n  _add('toBase64', function (urlsafe) {\n    return fromUint8Array(this, urlsafe);\n  });\n  _add('toBase64URI', function () {\n    return fromUint8Array(this, true);\n  });\n  _add('toBase64URL', function () {\n    return fromUint8Array(this, true);\n  });\n};\n/**\n * extend Builtin prototypes with relevant methods\n */\nvar extendBuiltins = function extendBuiltins() {\n  extendString();\n  extendUint8Array();\n};\nvar gBase64 = {\n  version: version,\n  VERSION: VERSION,\n  atob: _atob,\n  atobPolyfill: atobPolyfill,\n  btoa: _btoa,\n  btoaPolyfill: btoaPolyfill,\n  fromBase64: decode,\n  toBase64: encode,\n  encode: encode,\n  encodeURI: encodeURI,\n  encodeURL: encodeURI,\n  utob: utob,\n  btou: btou,\n  decode: decode,\n  isValid: isValid,\n  fromUint8Array: fromUint8Array,\n  toUint8Array: toUint8Array,\n  extendString: extendString,\n  extendUint8Array: extendUint8Array,\n  extendBuiltins: extendBuiltins\n};\n\n////////////////////////////////////////////////////////////////////////////\nvar SERIALIZATION_OPTIONS = {\n  relaxed: false // Ensure Canonical mode\n};\n/**\n * Serialize an object containing BSON types into extended-JSON.\n *\n * @param obj The object containing BSON types.\n * @returns The document in extended-JSON format.\n */\nfunction serialize(obj) {\n  return EJSON.serialize(obj, SERIALIZATION_OPTIONS);\n}\n/**\n * De-serialize an object or an array of object from extended-JSON into an object or an array of object with BSON types.\n *\n * @param obj The object or array of objects in extended-JSON format.\n * @returns The object or array of objects with inflated BSON types.\n */\nfunction deserialize(obj) {\n  if (Array.isArray(obj)) {\n    return obj.map(function (doc) {\n      return EJSON.deserialize(doc);\n    });\n  } else {\n    return EJSON.deserialize(obj);\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * The type of a user.\n */\nvar UserType;\n(function (UserType) {\n  /**\n   * A normal end-user created this user.\n   */\n  UserType[\"Normal\"] = \"normal\";\n  /**\n   * The user was created by the server.\n   */\n  UserType[\"Server\"] = \"server\";\n})(UserType || (UserType = {}));\n/** @ignore */\nvar DataKey;\n(function (DataKey) {\n  /** @ignore */\n  DataKey[\"NAME\"] = \"name\";\n  /** @ignore */\n  DataKey[\"EMAIL\"] = \"email\";\n  /** @ignore */\n  DataKey[\"PICTURE\"] = \"picture\";\n  /** @ignore */\n  DataKey[\"FIRST_NAME\"] = \"first_name\";\n  /** @ignore */\n  DataKey[\"LAST_NAME\"] = \"last_name\";\n  /** @ignore */\n  DataKey[\"GENDER\"] = \"gender\";\n  /** @ignore */\n  DataKey[\"BIRTHDAY\"] = \"birthday\";\n  /** @ignore */\n  DataKey[\"MIN_AGE\"] = \"min_age\";\n  /** @ignore */\n  DataKey[\"MAX_AGE\"] = \"max_age\";\n})(DataKey || (DataKey = {}));\nvar DATA_MAPPING = (_DATA_MAPPING = {}, _defineProperty(_DATA_MAPPING, DataKey.NAME, \"name\"), _defineProperty(_DATA_MAPPING, DataKey.EMAIL, \"email\"), _defineProperty(_DATA_MAPPING, DataKey.PICTURE, \"pictureUrl\"), _defineProperty(_DATA_MAPPING, DataKey.FIRST_NAME, \"firstName\"), _defineProperty(_DATA_MAPPING, DataKey.LAST_NAME, \"lastName\"), _defineProperty(_DATA_MAPPING, DataKey.GENDER, \"gender\"), _defineProperty(_DATA_MAPPING, DataKey.BIRTHDAY, \"birthday\"), _defineProperty(_DATA_MAPPING, DataKey.MIN_AGE, \"minAge\"), _defineProperty(_DATA_MAPPING, DataKey.MAX_AGE, \"maxAge\"), _DATA_MAPPING);\n/** @inheritdoc */\nvar UserProfile =\n/**\n * @param response The response of a call fetching the users profile.\n */\nfunction UserProfile(response) {\n  _classCallCheck(this, UserProfile);\n  /** @ignore */\n  this.type = UserType.Normal;\n  /** @ignore */\n  this.identities = [];\n  if (typeof response === \"object\" && response !== null) {\n    var type = response.type,\n      identities = response.identities,\n      data = response.data;\n    if (typeof type === \"string\") {\n      this.type = type;\n    } else {\n      throw new Error(\"Expected 'type' in the response body\");\n    }\n    if (Array.isArray(identities)) {\n      this.identities = identities.map(function (identity) {\n        var id = identity.id,\n          providerType = identity.provider_type;\n        return {\n          id: id,\n          providerType: providerType\n        };\n      });\n    } else {\n      throw new Error(\"Expected 'identities' in the response body\");\n    }\n    if (typeof data === \"object\" && data !== null) {\n      var mappedData = Object.fromEntries(Object.entries(data).map(function (_ref2) {\n        var _ref3 = _slicedToArray(_ref2, 2),\n          key = _ref3[0],\n          value = _ref3[1];\n        if (key in DATA_MAPPING) {\n          // Translate any known data field to its JS idiomatic alias\n          return [DATA_MAPPING[key], value];\n        } else {\n          // Pass through any other values\n          return [key, value];\n        }\n      }));\n      // We can use `any` since we trust the user supplies the correct type\n      this.data = deserialize(mappedData);\n    } else {\n      throw new Error(\"Expected 'data' in the response body\");\n    }\n  } else {\n    this.data = {};\n  }\n}; ////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * A `Storage` which will prefix a key part to every operation.\n */\nvar PrefixedStorage = /*#__PURE__*/function () {\n  /**\n   * Construct a `Storage` which will prefix a key part to every operation.\n   *\n   * @param storage The underlying storage to use for operations.\n   * @param keyPart The part of the key to prefix when performing operations.\n   */\n  function PrefixedStorage(storage, keyPart) {\n    _classCallCheck(this, PrefixedStorage);\n    this.storage = storage;\n    this.keyPart = keyPart;\n  }\n  /** @inheritdoc */\n  _createClass(PrefixedStorage, [{\n    key: \"get\",\n    value: function get(key) {\n      return this.storage.get(this.keyPart + PrefixedStorage.PART_SEPARATOR + key);\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"set\",\n    value: function set(key, value) {\n      return this.storage.set(this.keyPart + PrefixedStorage.PART_SEPARATOR + key, value);\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"remove\",\n    value: function remove(key) {\n      return this.storage.remove(this.keyPart + PrefixedStorage.PART_SEPARATOR + key);\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"prefix\",\n    value: function prefix(keyPart) {\n      return new PrefixedStorage(this, keyPart);\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"clear\",\n    value: function clear() {\n      var prefix = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : \"\";\n      return this.storage.clear(this.keyPart + PrefixedStorage.PART_SEPARATOR + prefix);\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"addListener\",\n    value: function addListener(listener) {\n      return this.storage.addListener(listener);\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"removeListener\",\n    value: function removeListener(listener) {\n      return this.storage.addListener(listener);\n    }\n  }]);\n  return PrefixedStorage;\n}();\n/**\n * The string separating two parts.\n */\nPrefixedStorage.PART_SEPARATOR = \":\";\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * In-memory storage that will not be persisted.\n */\nvar MemoryStorage = /*#__PURE__*/function () {\n  function MemoryStorage() {\n    _classCallCheck(this, MemoryStorage);\n    /**\n     * Internal state of the storage.\n     */\n    this.storage = {};\n    /**\n     * A set of listners.\n     */\n    this.listeners = new Set();\n  }\n  /** @inheritdoc */\n  _createClass(MemoryStorage, [{\n    key: \"get\",\n    value: function get(key) {\n      if (key in this.storage) {\n        return this.storage[key];\n      } else {\n        return null;\n      }\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"set\",\n    value: function set(key, value) {\n      this.storage[key] = value;\n      // Fire the listeners\n      this.fireListeners();\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"remove\",\n    value: function remove(key) {\n      delete this.storage[key];\n      // Fire the listeners\n      this.fireListeners();\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"prefix\",\n    value: function prefix(keyPart) {\n      return new PrefixedStorage(this, keyPart);\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"clear\",\n    value: function clear(prefix) {\n      // Iterate all keys and delete their values if they have a matching prefix\n      for (var _i = 0, _Object$keys = Object.keys(this.storage); _i < _Object$keys.length; _i++) {\n        var key = _Object$keys[_i];\n        if (!prefix || key.startsWith(prefix)) {\n          delete this.storage[key];\n        }\n      }\n      // Fire the listeners\n      this.fireListeners();\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"addListener\",\n    value: function addListener(listener) {\n      this.listeners.add(listener);\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"removeListener\",\n    value: function removeListener(listener) {\n      this.listeners.delete(listener);\n    }\n    /**\n     * Tell the listeners that a change occurred.\n     */\n  }, {\n    key: \"fireListeners\",\n    value: function fireListeners() {\n      this.listeners.forEach(function (listener) {\n        return listener();\n      });\n    }\n  }]);\n  return MemoryStorage;\n}(); ////////////////////////////////////////////////////////////////////////////\nvar ACCESS_TOKEN_STORAGE_KEY = \"accessToken\";\nvar REFRESH_TOKEN_STORAGE_KEY = \"refreshToken\";\nvar PROFILE_STORAGE_KEY = \"profile\";\nvar PROVIDER_TYPE_STORAGE_KEY = \"providerType\";\n/**\n * Storage specific to the app.\n */\nvar UserStorage = /*#__PURE__*/function (_PrefixedStorage) {\n  _inherits(UserStorage, _PrefixedStorage);\n  var _super = _createSuper(UserStorage);\n  /**\n   * Construct a storage for a `User`.\n   *\n   * @param storage The underlying storage to wrap.\n   * @param userId The id of the user.\n   */\n  function UserStorage(storage, userId) {\n    _classCallCheck(this, UserStorage);\n    return _super.call(this, storage, \"user(\".concat(userId, \")\"));\n  }\n  /**\n   * Get the access token from storage.\n   *\n   * @returns Access token (null if unknown).\n   */\n  _createClass(UserStorage, [{\n    key: \"accessToken\",\n    get: function get() {\n      return this.get(ACCESS_TOKEN_STORAGE_KEY);\n    }\n    /**\n     * Set the access token in storage.\n     *\n     * @param value Access token (null if unknown).\n     */,\n    set: function set(value) {\n      if (value === null) {\n        this.remove(ACCESS_TOKEN_STORAGE_KEY);\n      } else {\n        this.set(ACCESS_TOKEN_STORAGE_KEY, value);\n      }\n    }\n    /**\n     * Get the refresh token from storage.\n     *\n     * @returns Refresh token (null if unknown and user is logged out).\n     */\n  }, {\n    key: \"refreshToken\",\n    get: function get() {\n      return this.get(REFRESH_TOKEN_STORAGE_KEY);\n    }\n    /**\n     * Set the refresh token in storage.\n     *\n     * @param value Refresh token (null if unknown and user is logged out).\n     */,\n    set: function set(value) {\n      if (value === null) {\n        this.remove(REFRESH_TOKEN_STORAGE_KEY);\n      } else {\n        this.set(REFRESH_TOKEN_STORAGE_KEY, value);\n      }\n    }\n    /**\n     * Get the user profile from storage.\n     *\n     * @returns User profile (undefined if its unknown).\n     */\n  }, {\n    key: \"profile\",\n    get: function get() {\n      var value = this.get(PROFILE_STORAGE_KEY);\n      if (value) {\n        var profile = new UserProfile();\n        // Patch in the values\n        Object.assign(profile, JSON.parse(value));\n        return profile;\n      }\n    }\n    /**\n     * Set the user profile in storage.\n     *\n     * @param value User profile (undefined if its unknown).\n     */,\n    set: function set(value) {\n      if (value) {\n        this.set(PROFILE_STORAGE_KEY, JSON.stringify(value));\n      } else {\n        this.remove(PROFILE_STORAGE_KEY);\n      }\n    }\n    /**\n     * Get the type of authentication provider used to authenticate\n     *\n     * @returns User profile (undefined if its unknown).\n     */\n  }, {\n    key: \"providerType\",\n    get: function get() {\n      var value = this.get(PROVIDER_TYPE_STORAGE_KEY);\n      if (value) {\n        return value;\n      }\n    }\n    /**\n     * Set the type of authentication provider used to authenticate\n     *\n     * @param value Type of authentication provider.\n     */,\n    set: function set(value) {\n      if (value) {\n        this.set(PROVIDER_TYPE_STORAGE_KEY, value);\n      } else {\n        this.remove(PROVIDER_TYPE_STORAGE_KEY);\n      }\n    }\n  }]);\n  return UserStorage;\n}(PrefixedStorage); ////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * @param obj The object to remove keys (and undefined values from)\n * @returns A new object without the keys where the value is undefined.\n */\nfunction removeKeysWithUndefinedValues(obj) {\n  return Object.fromEntries(Object.entries(obj).filter(function (entry) {\n    return typeof entry[1] !== \"undefined\";\n  }));\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Generate a random sequence of characters.\n *\n * @param length The length of the string.\n * @param alphabet The alphabet of characters to pick from.\n * @returns A string of characters picked randomly from `alphabet`.\n */\nfunction generateRandomString(length, alphabet) {\n  var result = \"\";\n  for (var i = 0; i < length; i++) {\n    result += alphabet[Math.floor(Math.random() * alphabet.length)];\n  }\n  return result;\n}\n/**\n * Encode an object mapping from string to string, into a query string to be appended a URL.\n *\n * @param params The parameters to include in the string.\n * @param prefixed Should the \"?\" prefix be added if values exists?\n * @returns A URL encoded representation of the parameters (omitting a \"?\" prefix).\n */\nfunction encodeQueryString(params) {\n  var prefixed = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n  // Filter out undefined values\n  var cleanedParams = removeKeysWithUndefinedValues(params);\n  // Determine if a prefixed \"?\" is appropreate\n  var prefix = prefixed && Object.keys(cleanedParams).length > 0 ? \"?\" : \"\";\n  // Transform keys and values to a query string\n  return prefix + Object.entries(cleanedParams).map(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n      k = _ref5[0],\n      v = _ref5[1];\n    return \"\".concat(k, \"=\").concat(encodeURIComponent(v));\n  }).join(\"&\");\n}\n/**\n * Decodes a query string into an object.\n *\n * @param str The query string to decode.\n * @returns The decoded query string.\n */\nfunction decodeQueryString(str) {\n  var cleanStr = str[0] === \"?\" ? str.substr(1) : str;\n  return Object.fromEntries(cleanStr.split(\"&\").filter(function (s) {\n    return s.length > 0;\n  }).map(function (kvp) {\n    return kvp.split(\"=\");\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n      k = _ref7[0],\n      v = _ref7[1];\n    return [k, decodeURIComponent(v)];\n  }));\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * A list of names that functions cannot have to be callable through the functions proxy.\n */\nvar RESERVED_NAMES = [\"inspect\", \"callFunction\", \"callFunctionStreaming\"].concat(_toConsumableArray(Object.getOwnPropertyNames(Object.prototype)));\n/**\n * Remove the key for any fields with undefined values.\n *\n * @param args The arguments to clean.\n * @returns The cleaned arguments.\n */\nfunction cleanArgs(args) {\n  var _iterator2 = _createForOfIteratorHelper(args),\n    _step2;\n  try {\n    for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n      var arg = _step2.value;\n      if (typeof arg === \"object\" && arg) {\n        for (var _i2 = 0, _Object$entries = Object.entries(arg); _i2 < _Object$entries.length; _i2++) {\n          var _Object$entries$_i = _slicedToArray(_Object$entries[_i2], 2),\n            key = _Object$entries$_i[0],\n            value = _Object$entries$_i[1];\n          if (value === undefined) {\n            delete arg[key];\n          }\n        }\n      }\n    }\n  } catch (err) {\n    _iterator2.e(err);\n  } finally {\n    _iterator2.f();\n  }\n  return args;\n}\n/**\n * Remove keys for any undefined values and serialize to EJSON.\n *\n * @param args The arguments to clean and serialize.\n * @returns The cleaned and serialized arguments.\n */\nfunction cleanArgsAndSerialize(args) {\n  var cleaned = cleanArgs(args);\n  return cleaned.map(function (arg) {\n    return typeof arg === \"object\" ? serialize(arg) : arg;\n  });\n}\n/**\n * Defines how functions are called.\n */\nvar FunctionsFactory = /*#__PURE__*/function () {\n  /**\n   * @param fetcher The underlying fetcher to use when sending requests.\n   * @param config Additional configuration parameters.\n   */\n  function FunctionsFactory(fetcher) {\n    var config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    _classCallCheck(this, FunctionsFactory);\n    this.fetcher = fetcher;\n    this.serviceName = config.serviceName;\n    this.argsTransformation = config.argsTransformation || cleanArgsAndSerialize;\n  }\n  /**\n   * Create a factory of functions, wrapped in a Proxy that returns bound copies of `callFunction` on any property.\n   *\n   * @param fetcher The underlying fetcher to use when requesting.\n   * @param config Additional configuration parameters.\n   * @returns The newly created factory of functions.\n   */\n  _createClass(FunctionsFactory, [{\n    key: \"callFunction\",\n    value:\n    /**\n     * Call a remote function by it's name.\n     *\n     * @param name Name of the remote function.\n     * @param args Arguments to pass to the remote function.\n     * @returns A promise of the value returned when executing the remote function.\n     */\n    function () {\n      var _callFunction = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(name) {\n        var _len,\n          args,\n          _key,\n          body,\n          appRoute,\n          _args3 = arguments;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                for (_len = _args3.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n                  args[_key - 1] = _args3[_key];\n                }\n                // See https://github.com/mongodb/stitch-js-sdk/blob/master/packages/core/sdk/src/services/internal/CoreStitchServiceClientImpl.ts\n                body = {\n                  name: name,\n                  arguments: this.argsTransformation ? this.argsTransformation(args) : args\n                };\n                if (this.serviceName) {\n                  body.service = this.serviceName;\n                }\n                appRoute = this.fetcher.appRoute;\n                return _context3.abrupt(\"return\", this.fetcher.fetchJSON({\n                  method: \"POST\",\n                  path: appRoute.functionsCall().path,\n                  body: body\n                }));\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n      function callFunction(_x3) {\n        return _callFunction.apply(this, arguments);\n      }\n      return callFunction;\n    }()\n    /**\n     * Call a remote function by it's name.\n     *\n     * @param name Name of the remote function.\n     * @param args Arguments to pass to the remote function.\n     * @returns A promise of the value returned when executing the remote function.\n     */\n  }, {\n    key: \"callFunctionStreaming\",\n    value: function callFunctionStreaming(name) {\n      for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n        args[_key2 - 1] = arguments[_key2];\n      }\n      var body = {\n        name: name,\n        arguments: this.argsTransformation ? this.argsTransformation(args) : args\n      };\n      if (this.serviceName) {\n        body.service = this.serviceName;\n      }\n      var appRoute = this.fetcher.appRoute;\n      var qs = encodeQueryString(_defineProperty({}, \"baas_request\", gBase64.encode(JSON.stringify(body))));\n      return this.fetcher.fetchStream({\n        method: \"GET\",\n        path: appRoute.functionsCall().path + qs\n      });\n    }\n  }], [{\n    key: \"create\",\n    value: function create(fetcher) {\n      var config = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      // Create a proxy, wrapping a simple object returning methods that calls functions\n      // TODO: Lazily fetch available functions and return these from the ownKeys() trap\n      var factory = new FunctionsFactory(fetcher, config);\n      // Wrap the factory in a proxy that calls the internal call method\n      return new Proxy(factory, {\n        get: function get(target, p, receiver) {\n          if (typeof p === \"string\" && RESERVED_NAMES.indexOf(p) === -1) {\n            return target.callFunction.bind(target, p);\n          } else {\n            var prop = Reflect.get(target, p, receiver);\n            return typeof prop === \"function\" ? prop.bind(target) : prop;\n          }\n        }\n      });\n    }\n  }]);\n  return FunctionsFactory;\n}(); ////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/** @inheritdoc */\nvar EmailPasswordAuth = /*#__PURE__*/function () {\n  /**\n   * Construct an interface to the email / password authentication provider.\n   *\n   * @param fetcher The underlying fetcher used to request the services.\n   * @param providerName Optional custom name of the authentication provider.\n   */\n  function EmailPasswordAuth(fetcher) {\n    var providerName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"local-userpass\";\n    _classCallCheck(this, EmailPasswordAuth);\n    this.fetcher = fetcher;\n    this.providerName = providerName;\n  }\n  /** @inheritdoc */\n  _createClass(EmailPasswordAuth, [{\n    key: \"registerUser\",\n    value: function () {\n      var _registerUser = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(details) {\n        var appRoute;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                appRoute = this.fetcher.appRoute;\n                _context4.next = 3;\n                return this.fetcher.fetchJSON({\n                  method: \"POST\",\n                  path: appRoute.emailPasswordAuth(this.providerName).register().path,\n                  body: details\n                });\n              case 3:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n      function registerUser(_x4) {\n        return _registerUser.apply(this, arguments);\n      }\n      return registerUser;\n    }() /** @inheritdoc */\n  }, {\n    key: \"confirmUser\",\n    value: function () {\n      var _confirmUser = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(details) {\n        var appRoute;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                appRoute = this.fetcher.appRoute;\n                _context5.next = 3;\n                return this.fetcher.fetchJSON({\n                  method: \"POST\",\n                  path: appRoute.emailPasswordAuth(this.providerName).confirm().path,\n                  body: details\n                });\n              case 3:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n      function confirmUser(_x5) {\n        return _confirmUser.apply(this, arguments);\n      }\n      return confirmUser;\n    }() /** @inheritdoc */\n  }, {\n    key: \"resendConfirmationEmail\",\n    value: function () {\n      var _resendConfirmationEmail = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(details) {\n        var appRoute;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                appRoute = this.fetcher.appRoute;\n                _context6.next = 3;\n                return this.fetcher.fetchJSON({\n                  method: \"POST\",\n                  path: appRoute.emailPasswordAuth(this.providerName).confirmSend().path,\n                  body: details\n                });\n              case 3:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n      function resendConfirmationEmail(_x6) {\n        return _resendConfirmationEmail.apply(this, arguments);\n      }\n      return resendConfirmationEmail;\n    }() /** @inheritdoc */\n  }, {\n    key: \"retryCustomConfirmation\",\n    value: function () {\n      var _retryCustomConfirmation = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(details) {\n        var appRoute;\n        return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                appRoute = this.fetcher.appRoute;\n                _context7.next = 3;\n                return this.fetcher.fetchJSON({\n                  method: \"POST\",\n                  path: appRoute.emailPasswordAuth(this.providerName).confirmCall().path,\n                  body: details\n                });\n              case 3:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n      function retryCustomConfirmation(_x7) {\n        return _retryCustomConfirmation.apply(this, arguments);\n      }\n      return retryCustomConfirmation;\n    }() /** @inheritdoc */\n  }, {\n    key: \"resetPassword\",\n    value: function () {\n      var _resetPassword = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8(details) {\n        var appRoute;\n        return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                appRoute = this.fetcher.appRoute;\n                _context8.next = 3;\n                return this.fetcher.fetchJSON({\n                  method: \"POST\",\n                  path: appRoute.emailPasswordAuth(this.providerName).reset().path,\n                  body: details\n                });\n              case 3:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, this);\n      }));\n      function resetPassword(_x8) {\n        return _resetPassword.apply(this, arguments);\n      }\n      return resetPassword;\n    }() /** @inheritdoc */\n  }, {\n    key: \"sendResetPasswordEmail\",\n    value: function () {\n      var _sendResetPasswordEmail = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee9(details) {\n        var appRoute;\n        return _regeneratorRuntime.wrap(function _callee9$(_context9) {\n          while (1) {\n            switch (_context9.prev = _context9.next) {\n              case 0:\n                appRoute = this.fetcher.appRoute;\n                _context9.next = 3;\n                return this.fetcher.fetchJSON({\n                  method: \"POST\",\n                  path: appRoute.emailPasswordAuth(this.providerName).resetSend().path,\n                  body: details\n                });\n              case 3:\n              case \"end\":\n                return _context9.stop();\n            }\n          }\n        }, _callee9, this);\n      }));\n      function sendResetPasswordEmail(_x9) {\n        return _sendResetPasswordEmail.apply(this, arguments);\n      }\n      return sendResetPasswordEmail;\n    }() /** @inheritdoc */\n  }, {\n    key: \"callResetPasswordFunction\",\n    value: function () {\n      var _callResetPasswordFunction = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee10(details) {\n        var appRoute,\n          _len3,\n          args,\n          _key3,\n          _args10 = arguments;\n        return _regeneratorRuntime.wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                appRoute = this.fetcher.appRoute;\n                for (_len3 = _args10.length, args = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n                  args[_key3 - 1] = _args10[_key3];\n                }\n                _context10.next = 4;\n                return this.fetcher.fetchJSON({\n                  method: \"POST\",\n                  path: appRoute.emailPasswordAuth(this.providerName).resetCall().path,\n                  body: _objectSpread(_objectSpread({}, details), {}, {\n                    arguments: args\n                  })\n                });\n              case 4:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n      function callResetPasswordFunction(_x10) {\n        return _callResetPasswordFunction.apply(this, arguments);\n      }\n      return callResetPasswordFunction;\n    }()\n  }]);\n  return EmailPasswordAuth;\n}(); ////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * @returns The base api route.\n */\nfunction api() {\n  return {\n    path: \"/api/client/v2.0\",\n    /**\n     * @param appId The id of the app.\n     * @returns The URL of the app endpoint.\n     */\n    app: function app(appId) {\n      return {\n        path: this.path + \"/app/\".concat(appId),\n        /**\n         * @returns The URL of the app location endpoint.\n         */\n        location: function location() {\n          return {\n            path: this.path + \"/location\"\n          };\n        },\n        /**\n         * @param providerName The name of the provider.\n         * @returns The app url concatinated with the /auth/providers/{providerName}\n         */\n        authProvider: function authProvider(providerName) {\n          return {\n            path: this.path + \"/auth/providers/\".concat(providerName),\n            /**\n             * @returns Get the URL of an authentication provider.\n             */\n            login: function login() {\n              return {\n                path: this.path + \"/login\"\n              };\n            }\n          };\n        },\n        /**\n         * @param providerName The name of the provider.\n         * @returns The app url concatinated with the /auth/providers/{providerName}\n         */\n        emailPasswordAuth: function emailPasswordAuth(providerName) {\n          var authProviderRoutes = this.authProvider(providerName);\n          return _objectSpread(_objectSpread({}, authProviderRoutes), {}, {\n            register: function register() {\n              return {\n                path: this.path + \"/register\"\n              };\n            },\n            confirm: function confirm() {\n              return {\n                path: this.path + \"/confirm\"\n              };\n            },\n            confirmSend: function confirmSend() {\n              return {\n                path: this.path + \"/confirm/send\"\n              };\n            },\n            confirmCall: function confirmCall() {\n              return {\n                path: this.path + \"/confirm/call\"\n              };\n            },\n            reset: function reset() {\n              return {\n                path: this.path + \"/reset\"\n              };\n            },\n            resetSend: function resetSend() {\n              return {\n                path: this.path + \"/reset/send\"\n              };\n            },\n            resetCall: function resetCall() {\n              return {\n                path: this.path + \"/reset/call\"\n              };\n            }\n          });\n        },\n        functionsCall: function functionsCall() {\n          return {\n            path: this.path + \"/functions/call\"\n          };\n        }\n      };\n    },\n    auth: function auth() {\n      return {\n        path: this.path + \"/auth\",\n        apiKeys: function apiKeys() {\n          return {\n            path: this.path + \"/api_keys\",\n            key: function key(id) {\n              return {\n                path: this.path + \"/\".concat(id),\n                enable: function enable() {\n                  return {\n                    path: this.path + \"/enable\"\n                  };\n                },\n                disable: function disable() {\n                  return {\n                    path: this.path + \"/disable\"\n                  };\n                }\n              };\n            }\n          };\n        },\n        profile: function profile() {\n          return {\n            path: this.path + \"/profile\"\n          };\n        },\n        session: function session() {\n          return {\n            path: this.path + \"/session\"\n          };\n        },\n        delete: function _delete() {\n          return {\n            path: this.path + \"/delete\"\n          };\n        }\n      };\n    }\n  };\n}\nvar routes = {\n  api: api\n};\n\n////////////////////////////////////////////////////////////////////////////\n/** @inheritdoc */\nvar ApiKeyAuth = /*#__PURE__*/function () {\n  /**\n   * Construct an interface to the API-key authentication provider.\n   *\n   * @param fetcher The fetcher used to send requests to services.\n   */\n  function ApiKeyAuth(fetcher) {\n    _classCallCheck(this, ApiKeyAuth);\n    this.fetcher = fetcher;\n  }\n  /** @inheritdoc */\n  _createClass(ApiKeyAuth, [{\n    key: \"create\",\n    value: function create(name) {\n      return this.fetcher.fetchJSON({\n        method: \"POST\",\n        body: {\n          name: name\n        },\n        path: routes.api().auth().apiKeys().path,\n        tokenType: \"refresh\"\n      });\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"fetch\",\n    value: function fetch(keyId) {\n      return this.fetcher.fetchJSON({\n        method: \"GET\",\n        path: routes.api().auth().apiKeys().key(keyId).path,\n        tokenType: \"refresh\"\n      });\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"fetchAll\",\n    value: function fetchAll() {\n      return this.fetcher.fetchJSON({\n        method: \"GET\",\n        tokenType: \"refresh\",\n        path: routes.api().auth().apiKeys().path\n      });\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"delete\",\n    value: function () {\n      var _delete2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee11(keyId) {\n        return _regeneratorRuntime.wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                _context11.next = 2;\n                return this.fetcher.fetchJSON({\n                  method: \"DELETE\",\n                  path: routes.api().auth().apiKeys().key(keyId).path,\n                  tokenType: \"refresh\"\n                });\n              case 2:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this);\n      }));\n      function _delete(_x11) {\n        return _delete2.apply(this, arguments);\n      }\n      return _delete;\n    }() /** @inheritdoc */\n  }, {\n    key: \"enable\",\n    value: function () {\n      var _enable = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee12(keyId) {\n        return _regeneratorRuntime.wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                _context12.next = 2;\n                return this.fetcher.fetchJSON({\n                  method: \"PUT\",\n                  path: routes.api().auth().apiKeys().key(keyId).enable().path,\n                  tokenType: \"refresh\"\n                });\n              case 2:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n      function enable(_x12) {\n        return _enable.apply(this, arguments);\n      }\n      return enable;\n    }() /** @inheritdoc */\n  }, {\n    key: \"disable\",\n    value: function () {\n      var _disable = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee13(keyId) {\n        return _regeneratorRuntime.wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                _context13.next = 2;\n                return this.fetcher.fetchJSON({\n                  method: \"PUT\",\n                  path: routes.api().auth().apiKeys().key(keyId).disable().path,\n                  tokenType: \"refresh\"\n                });\n              case 2:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n      function disable(_x13) {\n        return _disable.apply(this, arguments);\n      }\n      return disable;\n    }()\n  }]);\n  return ApiKeyAuth;\n}(); ////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\nvar environment = null;\n/**\n * Set the environment of execution.\n * Note: This should be called as the first thing before executing any code which calls getEnvironment()\n *\n * @param e An object containing environment specific implementations.\n */\nfunction setEnvironment(e) {\n  environment = e;\n}\n/**\n * Get the environment of execution.\n *\n * @returns An object containing environment specific implementations.\n */\nfunction getEnvironment() {\n  if (environment) {\n    return environment;\n  } else {\n    throw new Error(\"Cannot get environment before it's set\");\n  }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * An error occured during the parsing of a watch stream.\n */\nvar WatchError = /*#__PURE__*/function (_Error) {\n  _inherits(WatchError, _Error);\n  var _super2 = _createSuper(WatchError);\n  function WatchError(_ref8) {\n    var _this;\n    var message = _ref8.message,\n      code = _ref8.code;\n    _classCallCheck(this, WatchError);\n    _this = _super2.call(this, message);\n    /**\n     * The name of this type of error\n     */\n    _this.name = \"WatchError\";\n    _this.code = code;\n    return _this;\n  }\n  return WatchError;\n}( /*#__PURE__*/_wrapNativeSuper(Error)); ////////////////////////////////////////////////////////////////////////////\n// NOTE: this is a fully processed event, not a single \"data: foo\" line!\n/**\n * The state of a WatchStream.\n */\nvar WatchStreamState;\n(function (WatchStreamState) {\n  /**\n   * Need to call one of the feed functions.\n   */\n  WatchStreamState[\"NEED_DATA\"] = \"NEED_DATA\";\n  /**\n   * Call nextEvent() to consume an event.\n   */\n  WatchStreamState[\"HAVE_EVENT\"] = \"HAVE_EVENT\";\n  /**\n   * Call error().\n   */\n  WatchStreamState[\"HAVE_ERROR\"] = \"HAVE_ERROR\";\n})(WatchStreamState || (WatchStreamState = {}));\n/**\n * Represents a stream of events\n */\nvar WatchStream = /*#__PURE__*/function () {\n  function WatchStream() {\n    _classCallCheck(this, WatchStream);\n    this._state = WatchStreamState.NEED_DATA;\n    this._error = null;\n    // Used by feedBuffer to construct lines\n    this._textDecoder = new (getEnvironment().TextDecoder)();\n    this._buffer = \"\";\n    this._bufferOffset = 0;\n    // Used by feedLine for building the next SSE\n    this._eventType = \"\";\n    this._dataBuffer = \"\";\n  }\n  // Call these when you have data, in whatever shape is easiest for your SDK to get.\n  // Pick one, mixing and matching on a single instance isn't supported.\n  // These can only be called in NEED_DATA state, which is the initial state.\n  _createClass(WatchStream, [{\n    key: \"feedBuffer\",\n    value: function feedBuffer(buffer) {\n      this.assertState(WatchStreamState.NEED_DATA);\n      this._buffer += this._textDecoder.decode(buffer, {\n        stream: true\n      });\n      this.advanceBufferState();\n    }\n  }, {\n    key: \"feedLine\",\n    value: function feedLine(line) {\n      this.assertState(WatchStreamState.NEED_DATA);\n      // This is an implementation of the algorithm described at\n      // https://html.spec.whatwg.org/multipage/server-sent-events.html#event-stream-interpretation.\n      // Currently the server does not use id or retry lines, so that processing isn't implemented.\n      // ignore trailing LF if not removed by SDK.\n      if (line.endsWith(\"\\n\")) line = line.substr(0, line.length - 1);\n      // ignore trailing CR from CRLF\n      if (line.endsWith(\"\\r\")) line = line.substr(0, line.length - 1);\n      if (line.length === 0) {\n        // This is the \"dispatch the event\" portion of the algorithm.\n        if (this._dataBuffer.length === 0) {\n          this._eventType = \"\";\n          return;\n        }\n        if (this._dataBuffer.endsWith(\"\\n\")) this._dataBuffer = this._dataBuffer.substr(0, this._dataBuffer.length - 1);\n        this.feedSse({\n          data: this._dataBuffer,\n          eventType: this._eventType\n        });\n        this._dataBuffer = \"\";\n        this._eventType = \"\";\n      }\n      if (line[0] === \":\") return;\n      var colon = line.indexOf(\":\");\n      var field = line.substr(0, colon);\n      var value = colon === -1 ? \"\" : line.substr(colon + 1);\n      if (value.startsWith(\" \")) value = value.substr(1);\n      if (field === \"event\") {\n        this._eventType = value;\n      } else if (field === \"data\") {\n        this._dataBuffer += value;\n        this._dataBuffer += \"\\n\";\n      } else ;\n    }\n  }, {\n    key: \"feedSse\",\n    value: function feedSse(sse) {\n      this.assertState(WatchStreamState.NEED_DATA);\n      var firstPercentIndex = sse.data.indexOf(\"%\");\n      if (firstPercentIndex !== -1) {\n        // For some reason, the stich server decided to add percent-encoding for '%', '\\n', and '\\r' to its\n        // event-stream replies. But it isn't real urlencoding, since most characters pass through, so we can't use\n        // uri_percent_decode() here.\n        var buffer = \"\";\n        var start = 0;\n        for (var percentIndex = firstPercentIndex; percentIndex !== -1; percentIndex = sse.data.indexOf(\"%\", start)) {\n          buffer += sse.data.substr(start, percentIndex - start);\n          var encoded = sse.data.substr(percentIndex, 3); // may be smaller than 3 if string ends with %\n          if (encoded === \"%25\") {\n            buffer += \"%\";\n          } else if (encoded === \"%0A\") {\n            buffer += \"\\x0A\"; // '\\n'\n          } else if (encoded === \"%0D\") {\n            buffer += \"\\x0D\"; // '\\r'\n          } else {\n            buffer += encoded; // propagate as-is\n          }\n\n          start = percentIndex + encoded.length;\n        }\n        // Advance the buffer with the last part\n        buffer += sse.data.substr(start);\n        sse.data = buffer;\n      }\n      if (!sse.eventType || sse.eventType === \"message\") {\n        try {\n          var parsed = EJSON.parse(sse.data);\n          if (typeof parsed === \"object\") {\n            // ???\n            this._nextEvent = parsed;\n            this._state = WatchStreamState.HAVE_EVENT;\n            return;\n          }\n        } catch (_unused) {\n          // fallthrough to same handling as for non-document value.\n        }\n        this._state = WatchStreamState.HAVE_ERROR;\n        this._error = new WatchError({\n          message: \"server returned malformed event: \" + sse.data,\n          code: \"bad bson parse\"\n        });\n      } else if (sse.eventType === \"error\") {\n        this._state = WatchStreamState.HAVE_ERROR;\n        // default error message if we have issues parsing the reply.\n        this._error = new WatchError({\n          message: sse.data,\n          code: \"unknown\"\n        });\n        try {\n          var _EJSON$parse = EJSON.parse(sse.data),\n            errorCode = _EJSON$parse.error_code,\n            error = _EJSON$parse.error;\n          if (typeof errorCode !== \"string\") return;\n          if (typeof error !== \"string\") return;\n          // XXX in realm-js, object-store will error if the error_code is not one of the known\n          // error code enum values.\n          this._error = new WatchError({\n            message: error,\n            code: errorCode\n          });\n        } catch (_unused2) {\n          return; // Use the default state.\n        }\n      } else ;\n    }\n  }, {\n    key: \"state\",\n    get: function get() {\n      return this._state;\n    }\n    // Consumes the returned event. If you used feedBuffer(), there may be another event or error after this one,\n    // so you need to call state() again to see what to do next.\n  }, {\n    key: \"nextEvent\",\n    value: function nextEvent() {\n      this.assertState(WatchStreamState.HAVE_EVENT);\n      // We can use \"as ChangeEvent<T>\" since we just asserted the state.\n      var out = this._nextEvent;\n      this._state = WatchStreamState.NEED_DATA;\n      this.advanceBufferState();\n      return out;\n    }\n    // Once this enters the error state, it stays that way. You should not feed any more data.\n  }, {\n    key: \"error\",\n    get: function get() {\n      return this._error;\n    }\n    ////////////////////////////////////////////\n  }, {\n    key: \"advanceBufferState\",\n    value: function advanceBufferState() {\n      this.assertState(WatchStreamState.NEED_DATA);\n      while (this.state === WatchStreamState.NEED_DATA) {\n        if (this._bufferOffset === this._buffer.length) {\n          this._buffer = \"\";\n          this._bufferOffset = 0;\n          return;\n        }\n        // NOTE not supporting CR-only newlines, just LF and CRLF.\n        var nextNewlineIndex = this._buffer.indexOf(\"\\n\", this._bufferOffset);\n        if (nextNewlineIndex === -1) {\n          // We have a partial line.\n          if (this._bufferOffset !== 0) {\n            // Slide the partial line down to the front of the buffer.\n            this._buffer = this._buffer.substr(this._bufferOffset, this._buffer.length - this._bufferOffset);\n            this._bufferOffset = 0;\n          }\n          return;\n        }\n        this.feedLine(this._buffer.substr(this._bufferOffset, nextNewlineIndex - this._bufferOffset));\n        this._bufferOffset = nextNewlineIndex + 1; // Advance past this line, including its newline.\n      }\n    }\n  }, {\n    key: \"assertState\",\n    value: function assertState(state) {\n      if (this._state !== state) {\n        throw Error(\"Expected WatchStream to be in state \".concat(state, \", but in state \").concat(this._state));\n      }\n    }\n  }]);\n  return WatchStream;\n}(); ////////////////////////////////////////////////////////////////////////////\n/**\n * A remote collection of documents.\n */\nvar MongoDBCollection = /*#__PURE__*/function () {\n  /**\n   * Construct a remote collection of documents.\n   *\n   * @param fetcher The fetcher to use when requesting the service.\n   * @param serviceName The name of the remote service.\n   * @param databaseName The name of the database.\n   * @param collectionName The name of the remote collection.\n   */\n  function MongoDBCollection(fetcher, serviceName, databaseName, collectionName) {\n    _classCallCheck(this, MongoDBCollection);\n    this.functions = FunctionsFactory.create(fetcher, {\n      serviceName: serviceName\n    });\n    this.databaseName = databaseName;\n    this.collectionName = collectionName;\n    this.serviceName = serviceName;\n    this.fetcher = fetcher;\n  }\n  /** @inheritdoc */\n  _createClass(MongoDBCollection, [{\n    key: \"find\",\n    value: function find() {\n      var filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      return this.functions.find({\n        database: this.databaseName,\n        collection: this.collectionName,\n        query: filter,\n        project: options.projection,\n        sort: options.sort,\n        limit: options.limit\n      });\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"findOne\",\n    value: function findOne() {\n      var filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      return this.functions.findOne({\n        database: this.databaseName,\n        collection: this.collectionName,\n        query: filter,\n        project: options.projection,\n        sort: options.sort\n      });\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"findOneAndUpdate\",\n    value: function findOneAndUpdate() {\n      var filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var update = arguments.length > 1 ? arguments[1] : undefined;\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      return this.functions.findOneAndUpdate({\n        database: this.databaseName,\n        collection: this.collectionName,\n        filter: filter,\n        update: update,\n        sort: options.sort,\n        projection: options.projection,\n        upsert: options.upsert,\n        returnNewDocument: options.returnNewDocument\n      });\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"findOneAndReplace\",\n    value: function findOneAndReplace() {\n      var filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var replacement = arguments.length > 1 ? arguments[1] : undefined;\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      return this.functions.findOneAndReplace({\n        database: this.databaseName,\n        collection: this.collectionName,\n        filter: filter,\n        update: replacement,\n        sort: options.sort,\n        projection: options.projection,\n        upsert: options.upsert,\n        returnNewDocument: options.returnNewDocument\n      });\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"findOneAndDelete\",\n    value: function findOneAndDelete() {\n      var filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      return this.functions.findOneAndReplace({\n        database: this.databaseName,\n        collection: this.collectionName,\n        filter: filter,\n        sort: options.sort,\n        projection: options.projection\n      });\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"aggregate\",\n    value: function aggregate(pipeline) {\n      return this.functions.aggregate({\n        database: this.databaseName,\n        collection: this.collectionName,\n        pipeline: pipeline\n      });\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"count\",\n    value: function count() {\n      var filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      return this.functions.count({\n        database: this.databaseName,\n        collection: this.collectionName,\n        query: filter,\n        limit: options.limit\n      });\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"insertOne\",\n    value: function insertOne(document) {\n      return this.functions.insertOne({\n        database: this.databaseName,\n        collection: this.collectionName,\n        document: document\n      });\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"insertMany\",\n    value: function insertMany(documents) {\n      return this.functions.insertMany({\n        database: this.databaseName,\n        collection: this.collectionName,\n        documents: documents\n      });\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"deleteOne\",\n    value: function deleteOne() {\n      var filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      return this.functions.deleteOne({\n        database: this.databaseName,\n        collection: this.collectionName,\n        query: filter\n      });\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"deleteMany\",\n    value: function deleteMany() {\n      var filter = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      return this.functions.deleteMany({\n        database: this.databaseName,\n        collection: this.collectionName,\n        query: filter\n      });\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"updateOne\",\n    value: function updateOne(filter, update) {\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      return this.functions.updateOne({\n        database: this.databaseName,\n        collection: this.collectionName,\n        query: filter,\n        update: update,\n        upsert: options.upsert,\n        arrayFilters: options.arrayFilters\n      });\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"updateMany\",\n    value: function updateMany(filter, update) {\n      var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      return this.functions.updateMany({\n        database: this.databaseName,\n        collection: this.collectionName,\n        query: filter,\n        update: update,\n        upsert: options.upsert,\n        arrayFilters: options.arrayFilters\n      });\n    }\n  }, {\n    key: \"watch\",\n    value: function watch() {\n      var _ref9 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        ids = _ref9.ids,\n        filter = _ref9.filter;\n      var iterable = this.functions.callFunctionStreaming(\"watch\", {\n        database: this.databaseName,\n        collection: this.collectionName,\n        ids: ids,\n        filter: filter\n      });\n      // Unpack the async iterable, making it possible for us to propagate the `return` when this generator is returning\n      var iterator = iterable.then(function (i) {\n        return i[Symbol.asyncIterator]();\n      });\n      var stream = this.watchImpl(iterator);\n      // Store the original return on the stream, to enable propagating to the original implementation after we've returned on the iterator\n      var originalReturn = stream.return;\n      return Object.assign(stream, {\n        return: function _return(value) {\n          iterator.then(function (i) {\n            return i.return ? i.return(value) : undefined;\n          });\n          return originalReturn.call(stream, value);\n        }\n      });\n    }\n    /**\n     * @param iterator An async iterator of the response body of a watch request.\n     * @yields Change events.\n     * Note: We had to split this from the `watch` method above to enable manually calling `return` on the response body iterator.\n     */\n  }, {\n    key: \"watchImpl\",\n    value: function watchImpl(iterator) {\n      return _wrapAsyncGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee14() {\n        var watchStream, iterable, _iteratorAbruptCompletion, _didIteratorError, _iteratorError, _iterator, _step, chunk;\n        return _regeneratorRuntime.wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                watchStream = new WatchStream(); // Repack the iterator into an interable for the `watchImpl` to consume\n                iterable = iterator.then(function (i) {\n                  return _defineProperty({}, Symbol.asyncIterator, function () {\n                    return i;\n                  });\n                }); // Start consuming change events\n                _iteratorAbruptCompletion = false;\n                _didIteratorError = false;\n                _context14.prev = 4;\n                _context14.t0 = _asyncIterator;\n                _context14.next = 8;\n                return _awaitAsyncGenerator(iterable);\n              case 8:\n                _context14.t1 = _context14.sent;\n                _iterator = (0, _context14.t0)(_context14.t1);\n              case 10:\n                _context14.next = 12;\n                return _awaitAsyncGenerator(_iterator.next());\n              case 12:\n                if (!(_iteratorAbruptCompletion = !(_step = _context14.sent).done)) {\n                  _context14.next = 27;\n                  break;\n                }\n                chunk = _step.value;\n                if (chunk) {\n                  _context14.next = 16;\n                  break;\n                }\n                return _context14.abrupt(\"continue\", 24);\n              case 16:\n                watchStream.feedBuffer(chunk);\n              case 17:\n                if (!(watchStream.state == WatchStreamState.HAVE_EVENT)) {\n                  _context14.next = 22;\n                  break;\n                }\n                _context14.next = 20;\n                return watchStream.nextEvent();\n              case 20:\n                _context14.next = 17;\n                break;\n              case 22:\n                if (!(watchStream.state == WatchStreamState.HAVE_ERROR)) {\n                  _context14.next = 24;\n                  break;\n                }\n                throw watchStream.error;\n              case 24:\n                _iteratorAbruptCompletion = false;\n                _context14.next = 10;\n                break;\n              case 27:\n                _context14.next = 33;\n                break;\n              case 29:\n                _context14.prev = 29;\n                _context14.t2 = _context14[\"catch\"](4);\n                _didIteratorError = true;\n                _iteratorError = _context14.t2;\n              case 33:\n                _context14.prev = 33;\n                _context14.prev = 34;\n                if (!(_iteratorAbruptCompletion && _iterator.return != null)) {\n                  _context14.next = 38;\n                  break;\n                }\n                _context14.next = 38;\n                return _awaitAsyncGenerator(_iterator.return());\n              case 38:\n                _context14.prev = 38;\n                if (!_didIteratorError) {\n                  _context14.next = 41;\n                  break;\n                }\n                throw _iteratorError;\n              case 41:\n                return _context14.finish(38);\n              case 42:\n                return _context14.finish(33);\n              case 43:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14, null, [[4, 29, 33, 43], [34,, 38, 42]]);\n      }))();\n    }\n  }]);\n  return MongoDBCollection;\n}(); ////////////////////////////////////////////////////////////////////////////\n/**\n * Creates an Remote MongoDB Collection.\n * Note: This method exists to enable function binding.\n *\n * @param fetcher The underlying fetcher.\n * @param serviceName A service name.\n * @param databaseName A database name.\n * @param collectionName A collection name.\n * @returns The collection.\n */\nfunction createCollection(fetcher, serviceName, databaseName, collectionName) {\n  return new MongoDBCollection(fetcher, serviceName, databaseName, collectionName);\n}\n/**\n * Creates a Remote MongoDB Database.\n * Note: This method exists to enable function binding.\n *\n * @param fetcher The underlying fetcher\n * @param serviceName A service name\n * @param databaseName A database name\n * @returns The database.\n */\nfunction createDatabase(fetcher, serviceName, databaseName) {\n  return {\n    collection: createCollection.bind(null, fetcher, serviceName, databaseName)\n  };\n}\n/**\n * Creates a Remote MongoDB Service.\n * Note: This method exists to enable function binding.\n *\n * @param fetcher The underlying fetcher.\n * @param serviceName An optional service name.\n * @returns The service.\n */\nfunction createService(fetcher) {\n  var serviceName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : \"mongo-db\";\n  return {\n    db: createDatabase.bind(null, fetcher, serviceName)\n  };\n}\n\n////////////////////////////////////////////////////////////////////////////\nvar DEFAULT_DEVICE_ID = \"000000000000000000000000\";\n/** The state of a user within the app */\nvar UserState;\n(function (UserState) {\n  /** Active, with both access and refresh tokens */\n  UserState[\"Active\"] = \"active\";\n  /** Logged out, but there might still be data persisted about the user, in the browser. */\n  UserState[\"LoggedOut\"] = \"logged-out\";\n  /** Logged out and all data about the user has been removed. */\n  UserState[\"Removed\"] = \"removed\";\n})(UserState || (UserState = {}));\n/** The type of a user. */\nvar UserType$1;\n(function (UserType) {\n  /** Created by the user itself. */\n  UserType[\"Normal\"] = \"normal\";\n  /** Created by an administrator of the app. */\n  UserType[\"Server\"] = \"server\";\n})(UserType$1 || (UserType$1 = {}));\n/**\n * Representation of an authenticated user of an app.\n */\nvar User = /*#__PURE__*/function () {\n  /**\n   * @param parameters Parameters of the user.\n   */\n  function User(parameters) {\n    _classCallCheck(this, User);\n    this.app = parameters.app;\n    this.id = parameters.id;\n    this.storage = new UserStorage(this.app.storage, this.id);\n    if (\"accessToken\" in parameters && \"refreshToken\" in parameters && \"providerType\" in parameters) {\n      this._accessToken = parameters.accessToken;\n      this._refreshToken = parameters.refreshToken;\n      this.providerType = parameters.providerType;\n      // Save the parameters to storage, for future instances to be hydrated from\n      this.storage.accessToken = parameters.accessToken;\n      this.storage.refreshToken = parameters.refreshToken;\n      this.storage.providerType = parameters.providerType;\n    } else {\n      // Hydrate the rest of the parameters from storage\n      this._accessToken = this.storage.accessToken;\n      this._refreshToken = this.storage.refreshToken;\n      var providerType = this.storage.providerType;\n      this._profile = this.storage.profile;\n      if (providerType) {\n        this.providerType = providerType;\n      } else {\n        throw new Error(\"Storage is missing a provider type\");\n      }\n    }\n    this.fetcher = this.app.fetcher.clone({\n      userContext: {\n        currentUser: this\n      }\n    });\n    this.apiKeys = new ApiKeyAuth(this.fetcher);\n    this.functions = FunctionsFactory.create(this.fetcher);\n  }\n  /**\n   * @returns The access token used to authenticate the user towards Atlas App Services.\n   */\n  _createClass(User, [{\n    key: \"accessToken\",\n    get: function get() {\n      return this._accessToken;\n    }\n    /**\n     * @param token The new access token.\n     */,\n    set: function set(token) {\n      this._accessToken = token;\n      this.storage.accessToken = token;\n    }\n    /**\n     * @returns The refresh token used to issue new access tokens.\n     */\n  }, {\n    key: \"refreshToken\",\n    get: function get() {\n      return this._refreshToken;\n    }\n    /**\n     * @param token The new refresh token.\n     */,\n    set: function set(token) {\n      this._refreshToken = token;\n      this.storage.refreshToken = token;\n    }\n    /**\n     * @returns The current state of the user.\n     */\n  }, {\n    key: \"state\",\n    get: function get() {\n      if (this.id in this.app.allUsers) {\n        return this.refreshToken === null ? UserState.LoggedOut : UserState.Active;\n      } else {\n        return UserState.Removed;\n      }\n    }\n    /**\n     * @returns The logged in state of the user.\n     */\n  }, {\n    key: \"isLoggedIn\",\n    get: function get() {\n      return this.state === UserState.Active;\n    }\n  }, {\n    key: \"customData\",\n    get: function get() {\n      if (this.accessToken) {\n        var decodedToken = this.decodeAccessToken();\n        return decodedToken.userData;\n      } else {\n        throw new Error(\"Cannot read custom data without an access token\");\n      }\n    }\n    /**\n     * @returns Profile containing detailed information about the user.\n     */\n  }, {\n    key: \"profile\",\n    get: function get() {\n      if (this._profile) {\n        return this._profile.data;\n      } else {\n        throw new Error(\"A profile was never fetched for this user\");\n      }\n    }\n  }, {\n    key: \"identities\",\n    get: function get() {\n      if (this._profile) {\n        return this._profile.identities;\n      } else {\n        throw new Error(\"A profile was never fetched for this user\");\n      }\n    }\n  }, {\n    key: \"deviceId\",\n    get: function get() {\n      if (this.accessToken) {\n        var payload = this.accessToken.split(\".\")[1];\n        if (payload) {\n          var parsedPayload = JSON.parse(gBase64.decode(payload));\n          var deviceId = parsedPayload[\"baas_device_id\"];\n          if (typeof deviceId === \"string\" && deviceId !== DEFAULT_DEVICE_ID) {\n            return deviceId;\n          }\n        }\n      }\n      return null;\n    }\n    /**\n     * Refresh the users profile data.\n     */\n  }, {\n    key: \"refreshProfile\",\n    value: function () {\n      var _refreshProfile = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee15() {\n        var response;\n        return _regeneratorRuntime.wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                _context15.next = 2;\n                return this.fetcher.fetchJSON({\n                  method: \"GET\",\n                  path: routes.api().auth().profile().path\n                });\n              case 2:\n                response = _context15.sent;\n                // Create a profile instance\n                this._profile = new UserProfile(response);\n                // Store this for later hydration\n                this.storage.profile = this._profile;\n              case 5:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15, this);\n      }));\n      function refreshProfile() {\n        return _refreshProfile.apply(this, arguments);\n      }\n      return refreshProfile;\n    }()\n    /**\n     * Log out the user, invalidating the session (and its refresh token).\n     */\n  }, {\n    key: \"logOut\",\n    value: function () {\n      var _logOut = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee16() {\n        return _regeneratorRuntime.wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                _context16.prev = 0;\n                if (!(this._refreshToken !== null)) {\n                  _context16.next = 4;\n                  break;\n                }\n                _context16.next = 4;\n                return this.fetcher.fetchJSON({\n                  method: \"DELETE\",\n                  path: routes.api().auth().session().path,\n                  tokenType: \"refresh\"\n                });\n              case 4:\n                _context16.next = 10;\n                break;\n              case 6:\n                _context16.prev = 6;\n                _context16.t0 = _context16[\"catch\"](0);\n                if (!(!(_context16.t0 instanceof Error) || !_context16.t0.message.includes(\"failed to find refresh token\"))) {\n                  _context16.next = 10;\n                  break;\n                }\n                throw _context16.t0;\n              case 10:\n                _context16.prev = 10;\n                // Forget the access and refresh token\n                this.accessToken = null;\n                this.refreshToken = null;\n                return _context16.finish(10);\n              case 14:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16, this, [[0, 6, 10, 14]]);\n      }));\n      function logOut() {\n        return _logOut.apply(this, arguments);\n      }\n      return logOut;\n    }() /** @inheritdoc */\n  }, {\n    key: \"linkCredentials\",\n    value: function () {\n      var _linkCredentials = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee17(credentials) {\n        var response, details;\n        return _regeneratorRuntime.wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                _context17.next = 2;\n                return this.app.authenticator.authenticate(credentials, this);\n              case 2:\n                response = _context17.sent;\n                if (!(this.id !== response.userId)) {\n                  _context17.next = 6;\n                  break;\n                }\n                details = \"got user id \".concat(response.userId, \" expected \").concat(this.id);\n                throw new Error(\"Link response ment for another user (\".concat(details, \")\"));\n              case 6:\n                // Update the access token\n                this.accessToken = response.accessToken;\n                // Refresh the profile to include the new identity\n                _context17.next = 9;\n                return this.refreshProfile();\n              case 9:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17, this);\n      }));\n      function linkCredentials(_x14) {\n        return _linkCredentials.apply(this, arguments);\n      }\n      return linkCredentials;\n    }()\n    /**\n     * Request a new access token, using the refresh token.\n     */\n  }, {\n    key: \"refreshAccessToken\",\n    value: function () {\n      var _refreshAccessToken = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee18() {\n        var response, accessToken;\n        return _regeneratorRuntime.wrap(function _callee18$(_context18) {\n          while (1) {\n            switch (_context18.prev = _context18.next) {\n              case 0:\n                _context18.next = 2;\n                return this.fetcher.fetchJSON({\n                  method: \"POST\",\n                  path: routes.api().auth().session().path,\n                  tokenType: \"refresh\"\n                });\n              case 2:\n                response = _context18.sent;\n                accessToken = response.access_token;\n                if (!(typeof accessToken === \"string\")) {\n                  _context18.next = 8;\n                  break;\n                }\n                this.accessToken = accessToken;\n                _context18.next = 9;\n                break;\n              case 8:\n                throw new Error(\"Expected an 'access_token' in the response\");\n              case 9:\n              case \"end\":\n                return _context18.stop();\n            }\n          }\n        }, _callee18, this);\n      }));\n      function refreshAccessToken() {\n        return _refreshAccessToken.apply(this, arguments);\n      }\n      return refreshAccessToken;\n    }() /** @inheritdoc */\n  }, {\n    key: \"refreshCustomData\",\n    value: function () {\n      var _refreshCustomData = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee19() {\n        return _regeneratorRuntime.wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                _context19.next = 2;\n                return this.refreshAccessToken();\n              case 2:\n                return _context19.abrupt(\"return\", this.customData);\n              case 3:\n              case \"end\":\n                return _context19.stop();\n            }\n          }\n        }, _callee19, this);\n      }));\n      function refreshCustomData() {\n        return _refreshCustomData.apply(this, arguments);\n      }\n      return refreshCustomData;\n    }()\n    /**\n     * @inheritdoc\n     */\n  }, {\n    key: \"addListener\",\n    value: function addListener() {\n      throw new Error(\"Not yet implemented\");\n    }\n    /**\n     * @inheritdoc\n     */\n  }, {\n    key: \"removeListener\",\n    value: function removeListener() {\n      throw new Error(\"Not yet implemented\");\n    }\n    /**\n     * @inheritdoc\n     */\n  }, {\n    key: \"removeAllListeners\",\n    value: function removeAllListeners() {\n      throw new Error(\"Not yet implemented\");\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"callFunction\",\n    value: function callFunction(name) {\n      var _this$functions;\n      for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n        args[_key4 - 1] = arguments[_key4];\n      }\n      return (_this$functions = this.functions).callFunction.apply(_this$functions, [name].concat(args));\n    }\n    /**\n     * @returns A plain ol' JavaScript object representation of the user.\n     */\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return {\n        id: this.id,\n        accessToken: this.accessToken,\n        refreshToken: this.refreshToken,\n        profile: this._profile,\n        state: this.state,\n        customData: this.customData\n      };\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"push\",\n    value: function push() {\n      throw new Error(\"Not yet implemented\");\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"mongoClient\",\n    value: function mongoClient(serviceName) {\n      return createService(this.fetcher, serviceName);\n    }\n  }, {\n    key: \"decodeAccessToken\",\n    value: function decodeAccessToken() {\n      if (this.accessToken) {\n        // Decode and spread the token\n        var parts = this.accessToken.split(\".\");\n        if (parts.length !== 3) {\n          throw new Error(\"Expected an access token with three parts\");\n        }\n        // Decode the payload\n        var encodedPayload = parts[1];\n        var decodedPayload = gBase64.decode(encodedPayload);\n        var parsedPayload = JSON.parse(decodedPayload);\n        var expires = parsedPayload.exp,\n          issuedAt = parsedPayload.iat,\n          subject = parsedPayload.sub,\n          _parsedPayload$user_d = parsedPayload.user_data,\n          userData = _parsedPayload$user_d === void 0 ? {} : _parsedPayload$user_d;\n        // Validate the types\n        if (typeof expires !== \"number\") {\n          throw new Error(\"Failed to decode access token 'exp'\");\n        } else if (typeof issuedAt !== \"number\") {\n          throw new Error(\"Failed to decode access token 'iat'\");\n        }\n        return {\n          expires: expires,\n          issuedAt: issuedAt,\n          subject: subject,\n          userData: userData\n        };\n      } else {\n        throw new Error(\"Missing an access token\");\n      }\n    }\n  }]);\n  return User;\n}(); ////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n// TODO: Ensure the static interface of the Credentials class implements the static interface of Realm.Credentials\n// See https://stackoverflow.com/a/43484801\n/**\n * Instances of this class can be passed to the `app.logIn` method to authenticate an end-user.\n */\nvar Credentials = /*#__PURE__*/function () {\n  /**\n   * Constructs an instance of credentials.\n   *\n   * @param providerName The name of the authentication provider used when authenticating.\n   * @param providerType The type of the authentication provider used when authenticating.\n   * @param payload The data being sent to the service when authenticating.\n   */\n  function Credentials(providerName, providerType, payload) {\n    _classCallCheck(this, Credentials);\n    this.providerName = providerName;\n    this.providerType = providerType;\n    this.payload = payload;\n  }\n  /**\n   * Creates credentials that logs in using the [Anonymous Provider](https://docs.mongodb.com/realm/authentication/anonymous/).\n   *\n   * @returns The credentials instance, which can be passed to `app.logIn`.\n   */\n  _createClass(Credentials, null, [{\n    key: \"anonymous\",\n    value: function anonymous() {\n      return new Credentials(\"anon-user\", \"anon-user\", {});\n    }\n    /**\n     * Creates credentials that logs in using the [API Key Provider](https://docs.mongodb.com/realm/authentication/api-key/).\n     *\n     * @param key The secret content of the API key.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n  }, {\n    key: \"apiKey\",\n    value: function apiKey(key) {\n      return new Credentials(\"api-key\", \"api-key\", {\n        key: key\n      });\n    }\n    /**\n     * Creates credentials that logs in using the [Email/Password Provider](https://docs.mongodb.com/realm/authentication/email-password/).\n     * Note: This was formerly known as the \"Username/Password\" provider.\n     *\n     * @param email The end-users email address.\n     * @param password The end-users password.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n  }, {\n    key: \"emailPassword\",\n    value: function emailPassword(email, password) {\n      return new Credentials(\"local-userpass\", \"local-userpass\", {\n        username: email,\n        password: password\n      });\n    }\n    /**\n     * Creates credentials that logs in using the [Custom Function Provider](https://docs.mongodb.com/realm/authentication/custom-function/).\n     *\n     * @param payload The custom payload as expected by the server.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n  }, {\n    key: \"function\",\n    value: function _function(payload) {\n      return new Credentials(\"custom-function\", \"custom-function\", payload);\n    }\n    /**\n     * Creates credentials that logs in using the [Custom JWT Provider](https://docs.mongodb.com/realm/authentication/custom-jwt/).\n     *\n     * @param token The JSON Web Token (JWT).\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n  }, {\n    key: \"jwt\",\n    value: function jwt(token) {\n      return new Credentials(\"custom-token\", \"custom-token\", {\n        token: token\n      });\n    }\n    /**\n     * Creates credentials that logs in using the [Google Provider](https://docs.mongodb.com/realm/authentication/google/).\n     *\n     * @param payload The URL that users should be redirected to, the auth code or id token from Google.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n  }, {\n    key: \"google\",\n    value: function google(payload) {\n      return new Credentials(\"oauth2-google\", \"oauth2-google\", Credentials.derivePayload(payload));\n    }\n    /**\n     * @param payload The payload string.\n     * @returns A payload object based on the string.\n     */\n  }, {\n    key: \"derivePayload\",\n    value: function derivePayload(payload) {\n      if (typeof payload === \"string\") {\n        throw new Error(\"`google(<tokenString>)` has been deprecated.  Please use `google(<authCodeObject>).\");\n      } else if (Object.keys(payload).length === 1) {\n        if (\"authCode\" in payload || \"redirectUrl\" in payload) {\n          return payload;\n        } else if (\"idToken\" in payload) {\n          return {\n            id_token: payload.idToken\n          };\n        } else {\n          throw new Error(\"Unexpected payload: \" + JSON.stringify(payload));\n        }\n      } else {\n        throw new Error(\"Expected only one property in payload, got \" + JSON.stringify(payload));\n      }\n    }\n    /**\n     * Creates credentials that logs in using the [Facebook Provider](https://docs.mongodb.com/realm/authentication/facebook/).\n     *\n     * @param redirectUrlOrAccessToken The URL that users should be redirected to or the auth code returned from Facebook.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n  }, {\n    key: \"facebook\",\n    value: function facebook(redirectUrlOrAccessToken) {\n      return new Credentials(\"oauth2-facebook\", \"oauth2-facebook\", redirectUrlOrAccessToken.includes(\"://\") ? {\n        redirectUrl: redirectUrlOrAccessToken\n      } : {\n        accessToken: redirectUrlOrAccessToken\n      });\n    }\n    /**\n     * Creates credentials that logs in using the [Apple ID Provider](https://docs.mongodb.com/realm/authentication/apple/).\n     *\n     * @param redirectUrlOrIdToken The URL that users should be redirected to or the id_token returned from Apple.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n  }, {\n    key: \"apple\",\n    value: function apple(redirectUrlOrIdToken) {\n      return new Credentials(\"oauth2-apple\", \"oauth2-apple\", redirectUrlOrIdToken.includes(\"://\") ? {\n        redirectUrl: redirectUrlOrIdToken\n      } : {\n        id_token: redirectUrlOrIdToken\n      });\n    }\n  }]);\n  return Credentials;\n}(); ////////////////////////////////////////////////////////////////////////////\nvar USER_IDS_STORAGE_KEY = \"userIds\";\nvar DEVICE_ID_STORAGE_KEY = \"deviceId\";\n/**\n * Storage specific to the app.\n */\nvar AppStorage = /*#__PURE__*/function (_PrefixedStorage2) {\n  _inherits(AppStorage, _PrefixedStorage2);\n  var _super3 = _createSuper(AppStorage);\n  /**\n   * @param storage The underlying storage to wrap.\n   * @param appId The id of the app.\n   */\n  function AppStorage(storage, appId) {\n    _classCallCheck(this, AppStorage);\n    return _super3.call(this, storage, \"app(\".concat(appId, \")\"));\n  }\n  /**\n   * Reads out the list of user ids from storage.\n   *\n   * @returns A list of user ids.\n   */\n  _createClass(AppStorage, [{\n    key: \"getUserIds\",\n    value: function getUserIds() {\n      var userIdsString = this.get(USER_IDS_STORAGE_KEY);\n      var userIds = userIdsString ? JSON.parse(userIdsString) : [];\n      if (Array.isArray(userIds)) {\n        // Remove any duplicates that might have been added\n        // The Set preserves insertion order\n        return _toConsumableArray(new Set(userIds));\n      } else {\n        throw new Error(\"Expected the user ids to be an array\");\n      }\n    }\n    /**\n     * Sets the list of ids in storage.\n     * Optionally merging with existing ids stored in the storage, by prepending these while voiding duplicates.\n     *\n     * @param userIds The list of ids to store.\n     * @param mergeWithExisting Prepend existing ids to avoid data-races with other apps using this storage.\n     */\n  }, {\n    key: \"setUserIds\",\n    value: function setUserIds(userIds, mergeWithExisting) {\n      if (mergeWithExisting) {\n        // Add any existing user id to the end of this list, avoiding duplicates\n        var existingIds = this.getUserIds();\n        var _iterator3 = _createForOfIteratorHelper(existingIds),\n          _step3;\n        try {\n          for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n            var id = _step3.value;\n            if (userIds.indexOf(id) === -1) {\n              userIds.push(id);\n            }\n          }\n        } catch (err) {\n          _iterator3.e(err);\n        } finally {\n          _iterator3.f();\n        }\n      }\n      // Store the list of ids\n      this.set(USER_IDS_STORAGE_KEY, JSON.stringify(userIds));\n    }\n    /**\n     * Remove an id from the list of ids.\n     *\n     * @param userId The id of a User to be removed.\n     */\n  }, {\n    key: \"removeUserId\",\n    value: function removeUserId(userId) {\n      var existingIds = this.getUserIds();\n      var userIds = existingIds.filter(function (id) {\n        return id !== userId;\n      });\n      // Store the list of ids\n      this.setUserIds(userIds, false);\n    }\n    /**\n     * @returns id of this device (if any exists)\n     */\n  }, {\n    key: \"getDeviceId\",\n    value: function getDeviceId() {\n      return this.get(DEVICE_ID_STORAGE_KEY);\n    }\n    /**\n     * @param deviceId The id of this device, to send on subsequent authentication requests.\n     */\n  }, {\n    key: \"setDeviceId\",\n    value: function setDeviceId(deviceId) {\n      this.set(DEVICE_ID_STORAGE_KEY, deviceId);\n    }\n  }]);\n  return AppStorage;\n}(PrefixedStorage); ////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\nvar LOWERCASE_LETTERS = \"abcdefghijklmnopqrstuvwxyz\";\nvar CLOSE_CHECK_INTERVAL = 100; // 10 times per second\nvar REDIRECT_HASH_TO_RESULT = {\n  _stitch_client_app_id: \"appId\",\n  _baas_client_app_id: \"appId\",\n  _stitch_ua: \"userAuth\",\n  _baas_ua: \"userAuth\",\n  _stitch_link: \"link\",\n  _baas_link: \"link\",\n  _stitch_error: \"error\",\n  _baas_error: \"error\",\n  _stitch_state: \"state\",\n  _baas_state: \"state\"\n};\n/**\n * A collection of methods helping implement the OAuth2 flow.\n */\nvar OAuth2Helper = /*#__PURE__*/function () {\n  /**\n   * @param storage The underlying storage to use when storing and retriving secrets.\n   * @param openWindow An optional function called when a browser window needs to open.\n   */\n  function OAuth2Helper(storage) {\n    var openWindow = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : getEnvironment().openWindow;\n    _classCallCheck(this, OAuth2Helper);\n    this.storage = storage.prefix(\"oauth2\");\n    this.openWindow = openWindow;\n  }\n  /**\n   * Parses the query string from the final step of the OAuth flow.\n   *\n   * @param queryString The query string passed through in location.hash.\n   * @returns The result of the OAuth flow.\n   */\n  _createClass(OAuth2Helper, [{\n    key: \"openWindowAndWaitForRedirect\",\n    value:\n    /**\n     * Open a window and wait for the redirect to be handled.\n     *\n     * @param url The URL to open.\n     * @param state The state which will be used to listen for storage updates.\n     * @returns The result passed through the redirect.\n     */\n    function openWindowAndWaitForRedirect(url, state) {\n      var _this2 = this;\n      var stateStorage = OAuth2Helper.getStateStorage(this.storage, state);\n      // Return a promise that resolves when the  gets known\n      return new Promise(function (resolve, reject) {\n        var redirectWindow = null;\n        // We're declaring the interval now to enable referencing before its initialized\n        var windowClosedInterval; // eslint-disable-line prefer-const\n        var handleStorageUpdate = function handleStorageUpdate() {\n          // Trying to get the secret from storage\n          var result = stateStorage.get(\"result\");\n          if (result) {\n            var parsedResult = JSON.parse(result);\n            // The secret got updated!\n            stateStorage.removeListener(handleStorageUpdate);\n            // Clear the storage to prevent others from reading this\n            stateStorage.clear();\n            // Try closing the newly created window\n            try {\n              if (redirectWindow) {\n                // Stop checking if the window closed\n                clearInterval(windowClosedInterval);\n                redirectWindow.close();\n              }\n            } catch (err) {\n              console.warn(\"Failed closing redirect window: \".concat(err));\n            } finally {\n              resolve(parsedResult);\n            }\n          }\n        };\n        // Add a listener to the state storage, awaiting an update to the secret\n        stateStorage.addListener(handleStorageUpdate);\n        // Open up a window\n        redirectWindow = _this2.openWindow(url);\n        // Not using a const, because we need the two listeners to reference each other when removing the other.\n        windowClosedInterval = setInterval(function () {\n          // Polling \"closed\" because registering listeners on the window violates cross-origin policies\n          if (!redirectWindow) {\n            // No need to keep polling for a window that we can't check\n            clearInterval(windowClosedInterval);\n          } else if (redirectWindow.closed) {\n            // Stop polling the window state\n            clearInterval(windowClosedInterval);\n            // Stop listening for changes to the storage\n            stateStorage.removeListener(handleStorageUpdate);\n            // Reject the promise\n            var err = new Error(\"Window closed\");\n            reject(err);\n          }\n        }, CLOSE_CHECK_INTERVAL);\n      });\n    }\n    /**\n     * Generate a random state string.\n     *\n     * @returns The random state string.\n     */\n  }, {\n    key: \"generateState\",\n    value: function generateState() {\n      return generateRandomString(12, LOWERCASE_LETTERS);\n    }\n  }], [{\n    key: \"parseRedirectLocation\",\n    value: function parseRedirectLocation(queryString) {\n      var params = decodeQueryString(queryString);\n      var result = {};\n      for (var _i3 = 0, _Object$entries2 = Object.entries(REDIRECT_HASH_TO_RESULT); _i3 < _Object$entries2.length; _i3++) {\n        var _Object$entries2$_i = _slicedToArray(_Object$entries2[_i3], 2),\n          p = _Object$entries2$_i[0],\n          r = _Object$entries2$_i[1];\n        var value = params[p];\n        if (value) {\n          result[r] = value;\n        }\n      }\n      return result;\n    }\n    /**\n     * Handle the redirect querystring by parsing it and storing it for others to consume.\n     *\n     * @param queryString The query string containing the encoded result from the OAuth provider.\n     * @param storage The underlying storage used to persist the result.\n     */\n  }, {\n    key: \"handleRedirect\",\n    value: function handleRedirect(queryString) {\n      var storage = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : getEnvironment().defaultStorage;\n      var result = OAuth2Helper.parseRedirectLocation(queryString);\n      var state = result.state,\n        error = result.error;\n      if (typeof state === \"string\") {\n        var oauth2Storage = storage.prefix(\"oauth2\");\n        var stateStorage = OAuth2Helper.getStateStorage(oauth2Storage, state);\n        stateStorage.set(\"result\", JSON.stringify(result));\n      } else if (error) {\n        throw new Error(\"Failed to handle OAuth 2.0 redirect: \".concat(error));\n      } else {\n        throw new Error(\"Failed to handle OAuth 2.0 redirect.\");\n      }\n    }\n    /**\n     * Decodes the authInfo string into its seperate parts.\n     *\n     * @param authInfo An authInfo string returned from the server.\n     * @returns An object containing the separate parts of the authInfo string.\n     */\n  }, {\n    key: \"decodeAuthInfo\",\n    value: function decodeAuthInfo(authInfo) {\n      var parts = (authInfo || \"\").split(\"$\");\n      if (parts.length === 4) {\n        var _parts = _slicedToArray(parts, 4),\n          accessToken = _parts[0],\n          refreshToken = _parts[1],\n          userId = _parts[2],\n          deviceId = _parts[3];\n        return {\n          accessToken: accessToken,\n          refreshToken: refreshToken,\n          userId: userId,\n          deviceId: deviceId\n        };\n      } else {\n        throw new Error(\"Failed to decode 'authInfo' into ids and tokens\");\n      }\n    }\n    /**\n     * Get the storage key associated of an secret associated with a state.\n     *\n     * @param storage The root storage used to derive a \"state namespaced\" storage.\n     * @param state The random state.\n     * @returns The storage associated with a particular state.\n     */\n  }, {\n    key: \"getStateStorage\",\n    value: function getStateStorage(storage, state) {\n      return storage.prefix(\"state(\".concat(state, \")\"));\n    }\n  }]);\n  return OAuth2Helper;\n}(); ////////////////////////////////////////////////////////////////////////////\nvar REDIRECT_LOCATION_HEADER = \"x-baas-location\";\n/**\n * Handles authentication and linking of users.\n */\nvar Authenticator = /*#__PURE__*/function () {\n  /**\n   * @param fetcher The fetcher used to fetch responses from the server.\n   * @param storage The storage used when completing OAuth 2.0 flows (should not be scoped to a specific app).\n   * @param getDeviceInformation Called to get device information to be sent to the server.\n   */\n  function Authenticator(fetcher, storage, getDeviceInformation) {\n    _classCallCheck(this, Authenticator);\n    this.fetcher = fetcher;\n    this.oauth2 = new OAuth2Helper(storage);\n    this.getDeviceInformation = getDeviceInformation;\n  }\n  /**\n   * @param credentials Credentials to use when logging in.\n   * @param linkingUser A user requesting to link.\n   * @returns A promise resolving to the response from the server.\n   */\n  _createClass(Authenticator, [{\n    key: \"authenticate\",\n    value: function () {\n      var _authenticate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee20(credentials, linkingUser) {\n        var deviceInformation, isLinking, state, url, response, redirectUrl, logInUrl, _response, userId, accessToken, _response$refresh_tok, refreshToken, deviceId;\n        return _regeneratorRuntime.wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                deviceInformation = this.getDeviceInformation();\n                isLinking = typeof linkingUser === \"object\";\n                if (!(credentials.providerType.startsWith(\"oauth2\") && typeof credentials.payload.redirectUrl === \"string\")) {\n                  _context20.next = 22;\n                  break;\n                }\n                // Initiate the OAuth2 flow by generating a state and fetch a redirect URL\n                state = this.oauth2.generateState();\n                _context20.next = 6;\n                return this.getLogInUrl(credentials, isLinking, {\n                  state: state,\n                  redirect: credentials.payload.redirectUrl,\n                  // Ensure redirects are communicated in a header different from \"Location\" and status remains 200 OK\n                  providerRedirectHeader: isLinking ? true : undefined,\n                  // Add the device information, only if we're not linking - since that request won't have a body of its own.\n                  device: !isLinking ? deviceInformation.encode() : undefined\n                });\n              case 6:\n                url = _context20.sent;\n                if (!isLinking) {\n                  _context20.next = 19;\n                  break;\n                }\n                _context20.next = 10;\n                return this.fetcher.fetch({\n                  method: \"GET\",\n                  url: url,\n                  tokenType: isLinking ? \"access\" : \"none\",\n                  user: linkingUser,\n                  // The response will set a cookie that we need to tell the browser to store\n                  mode: \"cors\",\n                  credentials: \"include\"\n                });\n              case 10:\n                response = _context20.sent;\n                // If a response header contains a redirect URL: Open a window and wait for the redirect to be handled\n                redirectUrl = response.headers.get(REDIRECT_LOCATION_HEADER);\n                if (!redirectUrl) {\n                  _context20.next = 16;\n                  break;\n                }\n                return _context20.abrupt(\"return\", this.openWindowAndWaitForAuthResponse(redirectUrl, state));\n              case 16:\n                throw new Error(\"Missing \".concat(REDIRECT_LOCATION_HEADER, \" header\"));\n              case 17:\n                _context20.next = 20;\n                break;\n              case 19:\n                return _context20.abrupt(\"return\", this.openWindowAndWaitForAuthResponse(url, state));\n              case 20:\n                _context20.next = 38;\n                break;\n              case 22:\n                _context20.next = 24;\n                return this.getLogInUrl(credentials, isLinking);\n              case 24:\n                logInUrl = _context20.sent;\n                _context20.next = 27;\n                return this.fetcher.fetchJSON({\n                  method: \"POST\",\n                  url: logInUrl,\n                  body: _objectSpread(_objectSpread({}, credentials.payload), {}, {\n                    options: {\n                      device: deviceInformation.toJSON()\n                    }\n                  }),\n                  tokenType: isLinking ? \"access\" : \"none\",\n                  user: linkingUser\n                });\n              case 27:\n                _response = _context20.sent;\n                // Spread out values from the response and ensure they're valid\n                userId = _response.user_id, accessToken = _response.access_token, _response$refresh_tok = _response.refresh_token, refreshToken = _response$refresh_tok === void 0 ? null : _response$refresh_tok, deviceId = _response.device_id;\n                if (!(typeof userId !== \"string\")) {\n                  _context20.next = 31;\n                  break;\n                }\n                throw new Error(\"Expected a user id in the response\");\n              case 31:\n                if (!(typeof accessToken !== \"string\")) {\n                  _context20.next = 33;\n                  break;\n                }\n                throw new Error(\"Expected an access token in the response\");\n              case 33:\n                if (!(typeof refreshToken !== \"string\" && refreshToken !== null)) {\n                  _context20.next = 35;\n                  break;\n                }\n                throw new Error(\"Expected refresh token to be a string or null\");\n              case 35:\n                if (!(typeof deviceId !== \"string\")) {\n                  _context20.next = 37;\n                  break;\n                }\n                throw new Error(\"Expected device id to be a string\");\n              case 37:\n                return _context20.abrupt(\"return\", {\n                  userId: userId,\n                  accessToken: accessToken,\n                  refreshToken: refreshToken,\n                  deviceId: deviceId\n                });\n              case 38:\n              case \"end\":\n                return _context20.stop();\n            }\n          }\n        }, _callee20, this);\n      }));\n      function authenticate(_x15, _x16) {\n        return _authenticate.apply(this, arguments);\n      }\n      return authenticate;\n    }()\n    /**\n     * @param credentials Credentials to use when logging in.\n     * @param link Should the request link with the current user?\n     * @param extraQueryParams Any extra parameters to include in the query string\n     * @returns A promise resolving to the url to be used when logging in.\n     */\n  }, {\n    key: \"getLogInUrl\",\n    value: function () {\n      var _getLogInUrl = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee21(credentials) {\n        var link,\n          extraQueryParams,\n          appRoute,\n          loginRoute,\n          qs,\n          locationUrl,\n          _args21 = arguments;\n        return _regeneratorRuntime.wrap(function _callee21$(_context21) {\n          while (1) {\n            switch (_context21.prev = _context21.next) {\n              case 0:\n                link = _args21.length > 1 && _args21[1] !== undefined ? _args21[1] : false;\n                extraQueryParams = _args21.length > 2 && _args21[2] !== undefined ? _args21[2] : {};\n                // See https://github.com/mongodb/stitch-js-sdk/blob/310f0bd5af80f818cdfbc3caf1ae29ffa8e9c7cf/packages/core/sdk/src/auth/internal/CoreStitchAuth.ts#L746-L780\n                appRoute = this.fetcher.appRoute;\n                loginRoute = appRoute.authProvider(credentials.providerName).login();\n                qs = encodeQueryString(_objectSpread({\n                  link: link ? \"true\" : undefined\n                }, extraQueryParams));\n                _context21.next = 7;\n                return this.fetcher.locationUrl;\n              case 7:\n                locationUrl = _context21.sent;\n                return _context21.abrupt(\"return\", locationUrl + loginRoute.path + qs);\n              case 9:\n              case \"end\":\n                return _context21.stop();\n            }\n          }\n        }, _callee21, this);\n      }));\n      function getLogInUrl(_x17) {\n        return _getLogInUrl.apply(this, arguments);\n      }\n      return getLogInUrl;\n    }()\n  }, {\n    key: \"openWindowAndWaitForAuthResponse\",\n    value: function () {\n      var _openWindowAndWaitForAuthResponse = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee22(redirectUrl, state) {\n        var redirectResult;\n        return _regeneratorRuntime.wrap(function _callee22$(_context22) {\n          while (1) {\n            switch (_context22.prev = _context22.next) {\n              case 0:\n                _context22.next = 2;\n                return this.oauth2.openWindowAndWaitForRedirect(redirectUrl, state);\n              case 2:\n                redirectResult = _context22.sent;\n                return _context22.abrupt(\"return\", OAuth2Helper.decodeAuthInfo(redirectResult.userAuth));\n              case 4:\n              case \"end\":\n                return _context22.stop();\n            }\n          }\n        }, _callee22, this);\n      }));\n      function openWindowAndWaitForAuthResponse(_x18, _x19) {\n        return _openWindowAndWaitForAuthResponse.apply(this, arguments);\n      }\n      return openWindowAndWaitForAuthResponse;\n    }()\n  }]);\n  return Authenticator;\n}(); ////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n// TODO: Determine if the shape of an error response is specific to each service or widely used.\n/**\n * An error produced while communicating with the MongoDB Realm server.\n */\nvar MongoDBRealmError = /*#__PURE__*/function (_Error2) {\n  _inherits(MongoDBRealmError, _Error2);\n  var _super4 = _createSuper(MongoDBRealmError);\n  function MongoDBRealmError(method, url, statusCode, statusText, error, errorCode, link) {\n    var _this3;\n    _classCallCheck(this, MongoDBRealmError);\n    var summary = statusText ? \"status \".concat(statusCode, \" \").concat(statusText) : \"status \".concat(statusCode);\n    if (typeof error === \"string\") {\n      _this3 = _super4.call(this, \"Request failed (\".concat(method, \" \").concat(url, \"): \").concat(error, \" (\").concat(summary, \")\"));\n    } else {\n      _this3 = _super4.call(this, \"Request failed (\".concat(method, \" \").concat(url, \"): (\").concat(summary, \")\"));\n    }\n    _this3.method = method;\n    _this3.url = url;\n    _this3.statusText = statusText;\n    _this3.statusCode = statusCode;\n    _this3.error = error;\n    _this3.errorCode = errorCode;\n    _this3.link = link;\n    return _possibleConstructorReturn(_this3);\n  }\n  /**\n   * Constructs and returns an error from a request and a response.\n   * Note: The caller must throw this error themselves.\n   *\n   * @param request The request sent to the server.\n   * @param response A raw response, as returned from the server.\n   * @returns An error from a request and a response.\n   */\n  _createClass(MongoDBRealmError, null, [{\n    key: \"fromRequestAndResponse\",\n    value: function () {\n      var _fromRequestAndResponse = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee23(request, response) {\n        var _a, url, method, status, statusText, body, error, errorCode, link;\n        return _regeneratorRuntime.wrap(function _callee23$(_context23) {\n          while (1) {\n            switch (_context23.prev = _context23.next) {\n              case 0:\n                url = request.url, method = request.method;\n                status = response.status, statusText = response.statusText;\n                if (!((_a = response.headers.get(\"content-type\")) === null || _a === void 0 ? void 0 : _a.startsWith(\"application/json\"))) {\n                  _context23.next = 9;\n                  break;\n                }\n                _context23.next = 5;\n                return response.json();\n              case 5:\n                body = _context23.sent;\n                if (!(typeof body === \"object\" && body)) {\n                  _context23.next = 9;\n                  break;\n                }\n                error = body.error, errorCode = body.error_code, link = body.link;\n                return _context23.abrupt(\"return\", new MongoDBRealmError(method, url, status, statusText, typeof error === \"string\" ? error : undefined, typeof errorCode === \"string\" ? errorCode : undefined, typeof link === \"string\" ? link : undefined));\n              case 9:\n                return _context23.abrupt(\"return\", new MongoDBRealmError(method, url, status, statusText));\n              case 10:\n              case \"end\":\n                return _context23.stop();\n            }\n          }\n        }, _callee23);\n      }));\n      function fromRequestAndResponse(_x20, _x21) {\n        return _fromRequestAndResponse.apply(this, arguments);\n      }\n      return fromRequestAndResponse;\n    }()\n  }]);\n  return MongoDBRealmError;\n}( /*#__PURE__*/_wrapNativeSuper(Error)); ////////////////////////////////////////////////////////////////////////////\n/**\n * @param body A possible resonse body.\n * @returns An async iterator.\n */\nfunction asyncIteratorFromResponseBody(body) {\n  if (typeof body !== \"object\" || body === null) {\n    throw new Error(\"Expected a non-null object\");\n  } else if (Symbol.asyncIterator in body) {\n    return body;\n  } else if (\"getReader\" in body) {\n    var stream = body;\n    return _defineProperty({}, Symbol.asyncIterator, function () {\n      var reader = stream.getReader();\n      return {\n        next: function next() {\n          return reader.read();\n        },\n        return: function _return() {\n          return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee24() {\n            return _regeneratorRuntime.wrap(function _callee24$(_context24) {\n              while (1) {\n                switch (_context24.prev = _context24.next) {\n                  case 0:\n                    _context24.next = 2;\n                    return reader.cancel();\n                  case 2:\n                    return _context24.abrupt(\"return\", {\n                      done: true,\n                      value: null\n                    });\n                  case 3:\n                  case \"end\":\n                    return _context24.stop();\n                }\n              }\n            }, _callee24);\n          }))();\n        }\n      };\n    });\n  } else {\n    throw new Error(\"Expected an AsyncIterable or a ReadableStream\");\n  }\n}\n/**\n * Wraps a NetworkTransport from the \"@realm/network-transport\" package.\n * Extracts error messages and throws `MongoDBRealmError` objects upon failures.\n * Injects access or refresh tokens for a current or specific user.\n * Refreshes access tokens if requests fails due to a 401 error.\n * Optionally parses response as JSON before returning it.\n * Fetches and exposes an app's location url.\n */\nvar Fetcher = /*#__PURE__*/function () {\n  /**\n   * @param config A configuration of the fetcher.\n   * @param config.appId The application id.\n   * @param config.transport The transport used when fetching.\n   * @param config.userContext An object used to determine the requesting user.\n   * @param config.locationUrlContext An object used to determine the location / base URL.\n   */\n  function Fetcher(_ref12) {\n    var appId = _ref12.appId,\n      transport = _ref12.transport,\n      userContext = _ref12.userContext,\n      locationUrlContext = _ref12.locationUrlContext;\n    _classCallCheck(this, Fetcher);\n    this.appId = appId;\n    this.transport = transport;\n    this.userContext = userContext;\n    this.locationUrlContext = locationUrlContext;\n  }\n  /**\n   * @param user An optional user to generate the header for.\n   * @param tokenType The type of token (access or refresh).\n   * @returns An object containing the user's token as \"Authorization\" header or undefined if no user is given.\n   */\n  _createClass(Fetcher, [{\n    key: \"clone\",\n    value: function clone(config) {\n      return new Fetcher(_objectSpread({\n        appId: this.appId,\n        transport: this.transport,\n        userContext: this.userContext,\n        locationUrlContext: this.locationUrlContext\n      }, config));\n    }\n    /**\n     * Fetch a network resource as an authenticated user.\n     *\n     * @param request The request which should be sent to the server.\n     * @returns The response from the server.\n     */\n  }, {\n    key: \"fetch\",\n    value: function () {\n      var _fetch2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee25(request) {\n        var path, url, _request$tokenType, tokenType, _request$user, user, restOfRequest, _url, response;\n        return _regeneratorRuntime.wrap(function _callee25$(_context25) {\n          while (1) {\n            switch (_context25.prev = _context25.next) {\n              case 0:\n                path = request.path, url = request.url, _request$tokenType = request.tokenType, tokenType = _request$tokenType === void 0 ? \"access\" : _request$tokenType, _request$user = request.user, user = _request$user === void 0 ? this.userContext.currentUser : _request$user, restOfRequest = _objectWithoutProperties(request, _excluded2);\n                if (!(typeof path === \"string\" && typeof url === \"string\")) {\n                  _context25.next = 5;\n                  break;\n                }\n                throw new Error(\"Use of 'url' and 'path' mutually exclusive\");\n              case 5:\n                if (!(typeof path === \"string\")) {\n                  _context25.next = 14;\n                  break;\n                }\n                _context25.next = 8;\n                return this.locationUrlContext.locationUrl;\n              case 8:\n                _context25.t0 = _context25.sent;\n                _context25.t1 = path;\n                _url = _context25.t0 + _context25.t1;\n                return _context25.abrupt(\"return\", this.fetch(_objectSpread(_objectSpread({}, request), {}, {\n                  path: undefined,\n                  url: _url\n                })));\n              case 14:\n                if (!(typeof url === \"string\")) {\n                  _context25.next = 34;\n                  break;\n                }\n                _context25.next = 17;\n                return this.transport.fetch(_objectSpread(_objectSpread({}, restOfRequest), {}, {\n                  url: url,\n                  headers: _objectSpread(_objectSpread({}, Fetcher.buildAuthorizationHeader(user, tokenType)), request.headers)\n                }));\n              case 17:\n                response = _context25.sent;\n                if (!response.ok) {\n                  _context25.next = 22;\n                  break;\n                }\n                return _context25.abrupt(\"return\", response);\n              case 22:\n                if (!(user && response.status === 401 && tokenType === \"access\")) {\n                  _context25.next = 28;\n                  break;\n                }\n                _context25.next = 25;\n                return user.refreshAccessToken();\n              case 25:\n                return _context25.abrupt(\"return\", this.fetch(_objectSpread(_objectSpread({}, request), {}, {\n                  user: user\n                })));\n              case 28:\n                if (user && response.status === 401 && tokenType === \"refresh\") {\n                  // A 401 error while using the refresh token indicates the token has an issue.\n                  // Reset the tokens to prevent a lock.\n                  user.accessToken = null;\n                  user.refreshToken = null;\n                }\n                // Throw an error with a message extracted from the body\n                _context25.next = 31;\n                return MongoDBRealmError.fromRequestAndResponse(request, response);\n              case 31:\n                throw _context25.sent;\n              case 32:\n                _context25.next = 35;\n                break;\n              case 34:\n                throw new Error(\"Expected either 'url' or 'path'\");\n              case 35:\n              case \"end\":\n                return _context25.stop();\n            }\n          }\n        }, _callee25, this);\n      }));\n      function fetch(_x22) {\n        return _fetch2.apply(this, arguments);\n      }\n      return fetch;\n    }()\n    /**\n     * Fetch a network resource as an authenticated user and parse the result as extended JSON.\n     *\n     * @param request The request which should be sent to the server.\n     * @returns The response from the server, parsed as extended JSON.\n     */\n  }, {\n    key: \"fetchJSON\",\n    value: function () {\n      var _fetchJSON = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee26(request) {\n        var body, serializedBody, contentTypeHeaders, response, contentType, responseBody;\n        return _regeneratorRuntime.wrap(function _callee26$(_context26) {\n          while (1) {\n            switch (_context26.prev = _context26.next) {\n              case 0:\n                body = request.body;\n                serializedBody = Fetcher.buildBody(body);\n                contentTypeHeaders = Fetcher.buildJsonHeader(serializedBody);\n                _context26.next = 5;\n                return this.fetch(_objectSpread(_objectSpread({}, request), {}, {\n                  body: serializedBody,\n                  headers: _objectSpread(_objectSpread({\n                    Accept: \"application/json\"\n                  }, contentTypeHeaders), request.headers)\n                }));\n              case 5:\n                response = _context26.sent;\n                contentType = response.headers.get(\"content-type\");\n                if (!(contentType === null || contentType === void 0 ? void 0 : contentType.startsWith(\"application/json\"))) {\n                  _context26.next = 14;\n                  break;\n                }\n                _context26.next = 10;\n                return response.json();\n              case 10:\n                responseBody = _context26.sent;\n                return _context26.abrupt(\"return\", deserialize(responseBody));\n              case 14:\n                if (!(contentType === null)) {\n                  _context26.next = 18;\n                  break;\n                }\n                return _context26.abrupt(\"return\", null);\n              case 18:\n                throw new Error(\"Expected JSON response, got \\\"\".concat(contentType, \"\\\"\"));\n              case 19:\n              case \"end\":\n                return _context26.stop();\n            }\n          }\n        }, _callee26, this);\n      }));\n      function fetchJSON(_x23) {\n        return _fetchJSON.apply(this, arguments);\n      }\n      return fetchJSON;\n    }()\n    /**\n     * Fetch an \"event-stream\" resource as an authenticated user.\n     *\n     * @param request The request which should be sent to the server.\n     * @returns An async iterator over the response body.\n     */\n  }, {\n    key: \"fetchStream\",\n    value: function () {\n      var _fetchStream = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee27(request) {\n        var _yield$this$fetch, body;\n        return _regeneratorRuntime.wrap(function _callee27$(_context27) {\n          while (1) {\n            switch (_context27.prev = _context27.next) {\n              case 0:\n                _context27.next = 2;\n                return this.fetch(_objectSpread(_objectSpread({}, request), {}, {\n                  headers: _objectSpread({\n                    Accept: \"text/event-stream\"\n                  }, request.headers)\n                }));\n              case 2:\n                _yield$this$fetch = _context27.sent;\n                body = _yield$this$fetch.body;\n                return _context27.abrupt(\"return\", asyncIteratorFromResponseBody(body));\n              case 5:\n              case \"end\":\n                return _context27.stop();\n            }\n          }\n        }, _callee27, this);\n      }));\n      function fetchStream(_x24) {\n        return _fetchStream.apply(this, arguments);\n      }\n      return fetchStream;\n    }()\n    /**\n     * @returns The path of the app route.\n     */\n  }, {\n    key: \"appRoute\",\n    get: function get() {\n      return routes.api().app(this.appId);\n    }\n    /**\n     * @returns A promise of the location URL of the app.\n     */\n  }, {\n    key: \"locationUrl\",\n    get: function get() {\n      return this.locationUrlContext.locationUrl;\n    }\n  }], [{\n    key: \"buildAuthorizationHeader\",\n    value: function buildAuthorizationHeader(user, tokenType) {\n      if (!user || tokenType === \"none\") {\n        return {};\n      } else if (tokenType === \"access\") {\n        return {\n          Authorization: \"Bearer \".concat(user.accessToken)\n        };\n      } else if (tokenType === \"refresh\") {\n        return {\n          Authorization: \"Bearer \".concat(user.refreshToken)\n        };\n      } else {\n        throw new Error(\"Unexpected token type (\".concat(tokenType, \")\"));\n      }\n    }\n    /**\n     * @param body The body string or object passed from a request.\n     * @returns An object optionally specifying the \"Content-Type\" header.\n     */\n  }, {\n    key: \"buildBody\",\n    value: function buildBody(body) {\n      if (!body) {\n        return;\n      } else if (typeof body === \"object\" && body !== null) {\n        return JSON.stringify(serialize(body));\n      } else if (typeof body === \"string\") {\n        return body;\n      } else {\n        console.log(\"body is\", body);\n        throw new Error(\"Unexpected type of body\");\n      }\n    }\n    /**\n     * @param body The body string or object passed from a request.\n     * @returns An object optionally specifying the \"Content-Type\" header.\n     */\n  }, {\n    key: \"buildJsonHeader\",\n    value: function buildJsonHeader(body) {\n      if (body && body.length > 0) {\n        return {\n          \"Content-Type\": \"application/json\"\n        };\n      } else {\n        return {};\n      }\n    }\n  }]);\n  return Fetcher;\n}(); ////////////////////////////////////////////////////////////////////////////\n/**\n * The key in a storage on which the device id is stored.\n */\nvar DEVICE_ID_STORAGE_KEY$1 = \"deviceId\";\nvar DeviceFields;\n(function (DeviceFields) {\n  DeviceFields[\"DEVICE_ID\"] = \"deviceId\";\n  DeviceFields[\"APP_ID\"] = \"appId\";\n  DeviceFields[\"APP_VERSION\"] = \"appVersion\";\n  DeviceFields[\"PLATFORM\"] = \"platform\";\n  DeviceFields[\"PLATFORM_VERSION\"] = \"platformVersion\";\n  DeviceFields[\"SDK_VERSION\"] = \"sdkVersion\";\n})(DeviceFields || (DeviceFields = {}));\n/**\n * Information describing the device, app and SDK.\n */\nvar DeviceInformation = /*#__PURE__*/function () {\n  /**\n   * @param params Construct the device information from these parameters.\n   * @param params.appId A user-defined application id.\n   * @param params.appVersion A user-defined application version.\n   * @param params.deviceId An unique id for the end-users device.\n   */\n  function DeviceInformation(_ref13) {\n    var appId = _ref13.appId,\n      appVersion = _ref13.appVersion,\n      deviceId = _ref13.deviceId;\n    _classCallCheck(this, DeviceInformation);\n    /**\n     * The version of the Realm Web SDK (constant provided by Rollup).\n     */\n    this.sdkVersion = \"2.0.0\";\n    var environment = getEnvironment();\n    this.platform = environment.platform;\n    this.platformVersion = environment.platformVersion;\n    this.appId = appId;\n    this.appVersion = appVersion;\n    this.deviceId = deviceId;\n  }\n  /**\n   * @returns An base64 URI encoded representation of the device information.\n   */\n  _createClass(DeviceInformation, [{\n    key: \"encode\",\n    value: function encode() {\n      var obj = removeKeysWithUndefinedValues(this);\n      return gBase64.encode(JSON.stringify(obj));\n    }\n    /**\n     * @returns The defaults\n     */\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return removeKeysWithUndefinedValues(this);\n    }\n  }]);\n  return DeviceInformation;\n}(); ////////////////////////////////////////////////////////////////////////////\n/**\n * Default base url to prefix all requests if no baseUrl is specified in the configuration.\n */\nvar DEFAULT_BASE_URL = \"https://realm.mongodb.com\";\n/**\n * Atlas App Services Application\n */\nvar App = /*#__PURE__*/function () {\n  /**\n   * Construct a Realm App, either from the Realm App id visible from the Atlas App Services UI or a configuration.\n   *\n   * @param idOrConfiguration The Realm App id or a configuration to use for this app.\n   */\n  function App(idOrConfiguration) {\n    var _this4 = this;\n    _classCallCheck(this, App);\n    /**\n     * An array of active and logged-out users.\n     * Elements in the beginning of the array is considered more recent than the later elements.\n     */\n    this.users = [];\n    /**\n     * A promise resolving to the App's location url.\n     */\n    this._locationUrl = null;\n    // If the argument is a string, convert it to a simple configuration object.\n    var configuration = typeof idOrConfiguration === \"string\" ? {\n      id: idOrConfiguration\n    } : idOrConfiguration;\n    // Initialize properties from the configuration\n    if (typeof configuration === \"object\" && typeof configuration.id === \"string\") {\n      this.id = configuration.id;\n    } else {\n      throw new Error(\"Missing an Atlas App Services app-id\");\n    }\n    this.baseUrl = configuration.baseUrl || DEFAULT_BASE_URL;\n    if (configuration.skipLocationRequest) {\n      // Use the base url directly, instead of requesting a location URL from the server\n      this._locationUrl = Promise.resolve(this.baseUrl);\n    }\n    this.localApp = configuration.app;\n    var storage = configuration.storage,\n      _configuration$transp = configuration.transport,\n      transport = _configuration$transp === void 0 ? new DefaultNetworkTransport() : _configuration$transp;\n    // Construct a fetcher wrapping the network transport\n    this.fetcher = new Fetcher({\n      appId: this.id,\n      userContext: this,\n      locationUrlContext: this,\n      transport: transport\n    });\n    // Construct the auth providers\n    this.emailPasswordAuth = new EmailPasswordAuth(this.fetcher);\n    // Construct the storage\n    var baseStorage = storage || getEnvironment().defaultStorage;\n    this.storage = new AppStorage(baseStorage, this.id);\n    this.authenticator = new Authenticator(this.fetcher, baseStorage, function () {\n      return _this4.deviceInformation;\n    });\n    // Hydrate the app state from storage\n    try {\n      this.hydrate();\n    } catch (err) {\n      // The storage was corrupted\n      this.storage.clear();\n      // A failed hydration shouldn't throw and break the app experience\n      // Since this is \"just\" persisted state that unfortunately got corrupted or partially lost\n      console.warn(\"Realm app hydration failed:\", err instanceof Error ? err.message : err);\n    }\n  }\n  /**\n   * Get or create a singleton Realm App from an id.\n   * Calling this function multiple times with the same id will return the same instance.\n   *\n   * @param id The Realm App id visible from the Atlas App Services UI or a configuration.\n   * @returns The Realm App instance.\n   */\n  _createClass(App, [{\n    key: \"switchUser\",\n    value:\n    /**\n     * Switch user.\n     *\n     * @param nextUser The user or id of the user to switch to.\n     */\n    function switchUser(nextUser) {\n      var index = this.users.findIndex(function (u) {\n        return u === nextUser;\n      });\n      if (index === -1) {\n        throw new Error(\"The user was never logged into this app\");\n      }\n      // Remove the user from the stack\n      var _this$users$splice = this.users.splice(index, 1),\n        _this$users$splice2 = _slicedToArray(_this$users$splice, 1),\n        user = _this$users$splice2[0];\n      // Insert the user in the beginning of the stack\n      this.users.unshift(user);\n    }\n    /**\n     * Log in a user.\n     *\n     * @param credentials Credentials to use when logging in.\n     * @param fetchProfile Should the users profile be fetched? (default: true)\n     * @returns A promise resolving to the newly logged in user.\n     */\n  }, {\n    key: \"logIn\",\n    value: function () {\n      var _logIn = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee28(credentials) {\n        var fetchProfile,\n          response,\n          user,\n          deviceId,\n          _args28 = arguments;\n        return _regeneratorRuntime.wrap(function _callee28$(_context28) {\n          while (1) {\n            switch (_context28.prev = _context28.next) {\n              case 0:\n                fetchProfile = _args28.length > 1 && _args28[1] !== undefined ? _args28[1] : true;\n                _context28.next = 3;\n                return this.authenticator.authenticate(credentials);\n              case 3:\n                response = _context28.sent;\n                user = this.createOrUpdateUser(response, credentials.providerType); // Let's ensure this will be the current user, in case the user object was reused.\n                this.switchUser(user);\n                // If needed, fetch and set the profile on the user\n                if (!fetchProfile) {\n                  _context28.next = 9;\n                  break;\n                }\n                _context28.next = 9;\n                return user.refreshProfile();\n              case 9:\n                // Persist the user id in the storage,\n                // merging to avoid overriding logins from other apps using the same underlying storage\n                this.storage.setUserIds(this.users.map(function (u) {\n                  return u.id;\n                }), true);\n                // Read out and store the device id from the server\n                deviceId = response.deviceId;\n                if (deviceId && deviceId !== \"000000000000000000000000\") {\n                  this.storage.set(DEVICE_ID_STORAGE_KEY$1, deviceId);\n                }\n                // Return the user\n                return _context28.abrupt(\"return\", user);\n              case 13:\n              case \"end\":\n                return _context28.stop();\n            }\n          }\n        }, _callee28, this);\n      }));\n      function logIn(_x25) {\n        return _logIn.apply(this, arguments);\n      }\n      return logIn;\n    }()\n    /**\n     * @inheritdoc\n     */\n  }, {\n    key: \"removeUser\",\n    value: function () {\n      var _removeUser = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee29(user) {\n        var index;\n        return _regeneratorRuntime.wrap(function _callee29$(_context29) {\n          while (1) {\n            switch (_context29.prev = _context29.next) {\n              case 0:\n                // Remove the user from the list of users\n                index = this.users.findIndex(function (u) {\n                  return u === user;\n                });\n                if (!(index === -1)) {\n                  _context29.next = 3;\n                  break;\n                }\n                throw new Error(\"The user was never logged into this app\");\n              case 3:\n                this.users.splice(index, 1);\n                // Log out the user - this removes access and refresh tokens from storage\n                _context29.next = 6;\n                return user.logOut();\n              case 6:\n                // Remove the users profile from storage\n                this.storage.remove(\"user(\".concat(user.id, \"):profile\"));\n                // Remove the user from the storage\n                this.storage.removeUserId(user.id);\n              case 8:\n              case \"end\":\n                return _context29.stop();\n            }\n          }\n        }, _callee29, this);\n      }));\n      function removeUser(_x26) {\n        return _removeUser.apply(this, arguments);\n      }\n      return removeUser;\n    }()\n    /**\n     * @inheritdoc\n     */\n  }, {\n    key: \"deleteUser\",\n    value: function () {\n      var _deleteUser = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee30(user) {\n        return _regeneratorRuntime.wrap(function _callee30$(_context30) {\n          while (1) {\n            switch (_context30.prev = _context30.next) {\n              case 0:\n                _context30.next = 2;\n                return this.fetcher.fetchJSON({\n                  method: \"DELETE\",\n                  path: routes.api().auth().delete().path\n                });\n              case 2:\n                _context30.next = 4;\n                return this.removeUser(user);\n              case 4:\n              case \"end\":\n                return _context30.stop();\n            }\n          }\n        }, _callee30, this);\n      }));\n      function deleteUser(_x27) {\n        return _deleteUser.apply(this, arguments);\n      }\n      return deleteUser;\n    }()\n    /**\n     * @inheritdoc\n     */\n  }, {\n    key: \"addListener\",\n    value: function addListener() {\n      throw new Error(\"Not yet implemented\");\n    }\n    /**\n     * @inheritdoc\n     */\n  }, {\n    key: \"removeListener\",\n    value: function removeListener() {\n      throw new Error(\"Not yet implemented\");\n    }\n    /**\n     * @inheritdoc\n     */\n  }, {\n    key: \"removeAllListeners\",\n    value: function removeAllListeners() {\n      throw new Error(\"Not yet implemented\");\n    }\n    /**\n     * The currently active user (or null if no active users exists).\n     *\n     * @returns the currently active user or null.\n     */\n  }, {\n    key: \"currentUser\",\n    get: function get() {\n      var activeUsers = this.users.filter(function (user) {\n        return user.state === UserState.Active;\n      });\n      if (activeUsers.length === 0) {\n        return null;\n      } else {\n        // Current user is the top of the stack\n        return activeUsers[0];\n      }\n    }\n    /**\n     * All active and logged-out users:\n     *  - First in the list are active users (ordered by most recent call to switchUser or login)\n     *  - Followed by logged out users (also ordered by most recent call to switchUser or login).\n     *\n     * @returns An array of users active or logged out users (current user being the first).\n     */\n  }, {\n    key: \"allUsers\",\n    get: function get() {\n      // Returning a freezed copy of the list of users to prevent outside changes\n      return Object.fromEntries(this.users.map(function (user) {\n        return [user.id, user];\n      }));\n    }\n    /**\n     * @returns A promise of the app URL, with the app location resolved.\n     */\n  }, {\n    key: \"locationUrl\",\n    get: function get() {\n      var _this5 = this;\n      if (!this._locationUrl) {\n        var path = routes.api().app(this.id).location().path;\n        this._locationUrl = this.fetcher.fetchJSON({\n          method: \"GET\",\n          url: this.baseUrl + path,\n          tokenType: \"none\"\n        }).then(function (body) {\n          if (typeof body !== \"object\") {\n            throw new Error(\"Expected response body be an object\");\n          } else {\n            return body;\n          }\n        }).then(function (_ref14) {\n          var hostname = _ref14.hostname;\n          if (typeof hostname !== \"string\") {\n            throw new Error(\"Expected response to contain a 'hostname'\");\n          } else {\n            return hostname;\n          }\n        }).catch(function (err) {\n          // Reset the location to allow another request to fetch again.\n          _this5._locationUrl = null;\n          throw err;\n        });\n      }\n      return this._locationUrl;\n    }\n    /**\n     * @returns Information about the current device, sent to the server when authenticating.\n     */\n  }, {\n    key: \"deviceInformation\",\n    get: function get() {\n      var deviceIdStr = this.storage.getDeviceId();\n      var deviceId = typeof deviceIdStr === \"string\" && deviceIdStr !== \"000000000000000000000000\" ? new ObjectId(deviceIdStr) : undefined;\n      return new DeviceInformation({\n        appId: this.localApp ? this.localApp.name : undefined,\n        appVersion: this.localApp ? this.localApp.version : undefined,\n        deviceId: deviceId\n      });\n    }\n    /**\n     * Create (and store) a new user or update an existing user's access and refresh tokens.\n     * This helps de-duplicating users in the list of users known to the app.\n     *\n     * @param response A response from the Authenticator.\n     * @param providerType The type of the authentication provider used.\n     * @returns A new or an existing user.\n     */\n  }, {\n    key: \"createOrUpdateUser\",\n    value: function createOrUpdateUser(response, providerType) {\n      var existingUser = this.users.find(function (u) {\n        return u.id === response.userId;\n      });\n      if (existingUser) {\n        // Update the users access and refresh tokens\n        existingUser.accessToken = response.accessToken;\n        existingUser.refreshToken = response.refreshToken;\n        return existingUser;\n      } else {\n        // Create and store a new user\n        if (!response.refreshToken) {\n          throw new Error(\"No refresh token in response from server\");\n        }\n        var user = new User({\n          app: this,\n          id: response.userId,\n          accessToken: response.accessToken,\n          refreshToken: response.refreshToken,\n          providerType: providerType\n        });\n        this.users.unshift(user);\n        return user;\n      }\n    }\n    /**\n     * Restores the state of the app (active and logged-out users) from the storage\n     */\n  }, {\n    key: \"hydrate\",\n    value: function hydrate() {\n      var _this6 = this;\n      var userIds = this.storage.getUserIds();\n      this.users = userIds.map(function (id) {\n        return new User({\n          app: _this6,\n          id: id\n        });\n      });\n    }\n  }], [{\n    key: \"getApp\",\n    value: function getApp(id) {\n      if (id in App.appCache) {\n        return App.appCache[id];\n      } else {\n        var instance = new App(id);\n        App.appCache[id] = instance;\n        return instance;\n      }\n    }\n  }]);\n  return App;\n}();\n/**\n * A map of app instances returned from calling getApp.\n */\nApp.appCache = {};\n/**\n * Instances of this class can be passed to the `app.logIn` method to authenticate an end-user.\n */\nApp.Credentials = Credentials;\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Get or create a singleton Realm App from an id.\n * Calling this function multiple times with the same id will return the same instance.\n *\n * @param id The Realm App id visible from the Atlas App Services UI or a configuration.\n * @returns The Realm App instance.\n */\nfunction getApp(id) {\n  return App.getApp(id);\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Set the value of `isDevelopmentMode`. This allows each entry point (node vs DOM)\n * to use its own method for determining whether we are in development mode.\n *\n * @param state A boolean indicating whether the user's app is running in\n * development mode or not.\n */\nvar setIsDevelopmentMode$1 = function setIsDevelopmentMode$1(state) {};\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2022 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n// Exports a globalThis which is polyfilled for iOS 11/12\n// From https://github.com/zloirock/core-js/blob/master/packages/core-js/internals/global.js\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nvar check$1 = function check$1(it) {\n  return it && it.Math == Math && it;\n};\n// eslint-disable-next-line no-restricted-globals\nvar safeGlobalThis$1 =\n// eslint-disable-next-line no-restricted-globals\ncheck$1(typeof globalThis == \"object\" && globalThis) || check$1(typeof window == \"object\" && window) ||\n// eslint-disable-next-line no-restricted-globals -- safe\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore allow `self`\ncheck$1(typeof self == \"object\" && self) ||\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore allow `global`\ncheck$1(typeof global == \"object\" && global) ||\n// eslint-disable-next-line no-new-func -- fallback\nfunction () {\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore allow `this`\n  return this;\n}() || Function(\"return this\")();\n\n////////////////////////////////////////////////////////////////////////////\n// React/React Native set a global __DEV__ variable when running in dev mode\nsetIsDevelopmentMode$1(typeof __DEV__ !== \"undefined\" && __DEV__);\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * In-memory storage that will not be persisted.\n */\nvar LocalStorage = /*#__PURE__*/function () {\n  /**\n   * Constructs a LocalStorage using the global window.\n   */\n  function LocalStorage() {\n    _classCallCheck(this, LocalStorage);\n    if (typeof safeGlobalThis$1.localStorage === \"object\") {\n      this.global = safeGlobalThis$1;\n    } else {\n      throw new Error(\"Cannot use LocalStorage without a global localStorage object\");\n    }\n  }\n  /** @inheritdoc */\n  _createClass(LocalStorage, [{\n    key: \"get\",\n    value: function get(key) {\n      return this.global.localStorage.getItem(key);\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"set\",\n    value: function set(key, value) {\n      return this.global.localStorage.setItem(key, value);\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"remove\",\n    value: function remove(key) {\n      return this.global.localStorage.removeItem(key);\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"prefix\",\n    value: function prefix(keyPart) {\n      return new PrefixedStorage(this, keyPart);\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"clear\",\n    value: function clear(prefix) {\n      var keys = [];\n      // Iterate all keys to find the once have a matching prefix.\n      for (var i = 0; i < this.global.localStorage.length; i++) {\n        var key = this.global.localStorage.key(i);\n        if (key && (!prefix || key.startsWith(prefix))) {\n          keys.push(key);\n        }\n      }\n      // Remove the items in a seperate loop to avoid updating while iterating.\n      for (var _i4 = 0, _keys = keys; _i4 < _keys.length; _i4++) {\n        var _key5 = _keys[_i4];\n        this.global.localStorage.removeItem(_key5);\n      }\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"addListener\",\n    value: function addListener(listener) {\n      return this.global.addEventListener(\"storage\", listener);\n    }\n    /** @inheritdoc */\n  }, {\n    key: \"removeListener\",\n    value: function removeListener(listener) {\n      return this.global.removeEventListener(\"storage\", listener);\n    }\n  }]);\n  return LocalStorage;\n}(); ////////////////////////////////////////////////////////////////////////////\nvar browser = detect();\nvar DefaultStorage = \"localStorage\" in safeGlobalThis$1 ? LocalStorage : MemoryStorage;\n/**\n * Attempt to use the browser to open a window\n *\n * @param url The url to open a window to.\n * @returns Then newly create window.\n */\nfunction openWindow(url) {\n  if (typeof safeGlobalThis$1.open === \"function\") {\n    return safeGlobalThis$1.open(url);\n  } else {\n    console.log(\"Please open \".concat(url));\n    return null;\n  }\n}\nvar environment$1 = {\n  defaultStorage: new DefaultStorage().prefix(\"realm-web\"),\n  openWindow: openWindow,\n  platform: (browser === null || browser === void 0 ? void 0 : browser.name) || \"web\",\n  platformVersion: (browser === null || browser === void 0 ? void 0 : browser.version) || \"0.0.0\",\n  TextDecoder: TextDecoder\n};\nsetEnvironment(environment$1);\n/**\n * Handle an OAuth 2.0 redirect.\n *\n * @param location An optional location to use (defaults to the windows current location).\n * @param storage Optional storage used to save any results from the location.\n */\nfunction handleAuthRedirect() {\n  var location = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : safeGlobalThis$1.location;\n  var storage = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : environment$1.defaultStorage;\n  try {\n    var queryString = location.hash.substr(1); // Strip the initial # from the hash\n    OAuth2Helper.handleRedirect(queryString, storage);\n  } catch (err) {\n    // Ensure calling this never throws: It should not interrupt a users flow.\n    console.warn(err);\n  }\n}\nexport { App, Credentials, DEFAULT_BASE_URL, LocalStorage, MongoDBRealmError, User, UserState, UserType$1 as UserType, getApp, getEnvironment, handleAuthRedirect, setEnvironment };","map":{"version":3,"names":["EJSON","ObjectId","bson","BSON","__spreadArray","undefined","to","from","pack","arguments","length","i","l","ar","Array","prototype","slice","call","concat","BrowserInfo","name","version","os","type","NodeInfo","process","platform","SearchBotDeviceInfo","bot","BotInfo","ReactNativeInfo","SEARCHBOX_UA_REGEX","SEARCHBOT_OS_REGEX","REQUIRED_VERSION_PARTS","userAgentRules","operatingSystemRules","detect","userAgent","parseUserAgent","document","navigator","product","getNodeVersion","matchUserAgent","ua","reduce","matched","_a","browser","regex","uaMatch","exec","matchedRule","match","versionParts","split","join","createVersionParts","detectOS","searchBotMatch","ii","count","isNode","output","push","DefaultNetworkTransport","_classCallCheck","fetch","Error","AbortController","_createClass","key","value","fetchWithCallbacks","request","handler","then","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","decodedBody","responseHeaders","wrap","_callee$","_context","prev","next","text","sent","headers","forEach","abrupt","statusCode","status","body","stop","_x","apply","r","onSuccess","catch","e","onError","_fetch","_callee2","timeoutMs","url","rest","_this$createTimeoutSi","signal","cancelTimeout","_callee2$","_context2","_objectWithoutProperties","_excluded","createTimeoutSignal","_objectSpread","extraFetchOptions","finish","_x2","controller","timeout","setTimeout","abort","clearTimeout","DEFAULT_HEADERS","setIsDevelopmentMode","state","check","it","Math","safeGlobalThis","globalThis","window","self","global","Function","__DEV__","bind","VERSION","_hasatob","atob","_hasbtoa","btoa","_hasBuffer","Buffer","_TD","TextDecoder","_TE","TextEncoder","b64ch","b64chs","b64tab","a","tab","c","b64re","_fromCC","String","fromCharCode","_U8Afrom","Uint8Array","fn","x","map","_mkUriSafe","src","replace","m0","_tidyB64","s","btoaPolyfill","bin","u32","c0","c1","c2","asc","pad","charCodeAt","TypeError","substring","_btoa","toString","_fromUint8Array","u8a","maxargs","strs","subarray","fromUint8Array","urlsafe","cb_utob","cc","re_utob","utob","u","_encode","encode","encodeURI","re_btou","cb_btou","cccc","cp","offset","btou","b","atobPolyfill","test","u24","r1","r2","charAt","_atob","_toUint8Array","toUint8Array","_unURI","_decode","decode","isValid","_noEnum","v","enumerable","writable","configurable","extendString","_add","Object","defineProperty","extendUint8Array","extendBuiltins","gBase64","fromBase64","toBase64","encodeURL","SERIALIZATION_OPTIONS","relaxed","serialize","obj","deserialize","isArray","doc","UserType","DataKey","DATA_MAPPING","_DATA_MAPPING","_defineProperty","NAME","EMAIL","PICTURE","FIRST_NAME","LAST_NAME","GENDER","BIRTHDAY","MIN_AGE","MAX_AGE","UserProfile","Normal","identities","data","identity","id","providerType","provider_type","mappedData","fromEntries","entries","_ref2","_ref3","_slicedToArray","PrefixedStorage","storage","keyPart","get","PART_SEPARATOR","set","remove","prefix","clear","addListener","listener","removeListener","MemoryStorage","listeners","Set","fireListeners","_i","_Object$keys","keys","startsWith","add","delete","ACCESS_TOKEN_STORAGE_KEY","REFRESH_TOKEN_STORAGE_KEY","PROFILE_STORAGE_KEY","PROVIDER_TYPE_STORAGE_KEY","UserStorage","_PrefixedStorage","_inherits","_super","_createSuper","userId","profile","assign","JSON","parse","stringify","removeKeysWithUndefinedValues","filter","entry","generateRandomString","alphabet","result","floor","random","encodeQueryString","params","prefixed","cleanedParams","_ref4","_ref5","k","encodeURIComponent","decodeQueryString","str","cleanStr","substr","kvp","_ref6","_ref7","decodeURIComponent","RESERVED_NAMES","_toConsumableArray","getOwnPropertyNames","cleanArgs","args","_iterator2","_createForOfIteratorHelper","_step2","n","done","arg","_i2","_Object$entries","_Object$entries$_i","err","f","cleanArgsAndSerialize","cleaned","FunctionsFactory","fetcher","config","serviceName","argsTransformation","_callFunction","_callee3","_len","_key","appRoute","_args3","_callee3$","_context3","service","fetchJSON","method","path","functionsCall","callFunction","_x3","callFunctionStreaming","_len2","_key2","qs","fetchStream","create","factory","Proxy","target","p","receiver","indexOf","prop","Reflect","EmailPasswordAuth","providerName","_registerUser","_callee4","details","_callee4$","_context4","emailPasswordAuth","register","registerUser","_x4","_confirmUser","_callee5","_callee5$","_context5","confirm","confirmUser","_x5","_resendConfirmationEmail","_callee6","_callee6$","_context6","confirmSend","resendConfirmationEmail","_x6","_retryCustomConfirmation","_callee7","_callee7$","_context7","confirmCall","retryCustomConfirmation","_x7","_resetPassword","_callee8","_callee8$","_context8","reset","resetPassword","_x8","_sendResetPasswordEmail","_callee9","_callee9$","_context9","resetSend","sendResetPasswordEmail","_x9","_callResetPasswordFunction","_callee10","_len3","_key3","_args10","_callee10$","_context10","resetCall","callResetPasswordFunction","_x10","api","app","appId","location","authProvider","login","authProviderRoutes","auth","apiKeys","enable","disable","session","_delete","routes","ApiKeyAuth","tokenType","keyId","fetchAll","_delete2","_callee11","_callee11$","_context11","_x11","_enable","_callee12","_callee12$","_context12","_x12","_disable","_callee13","_callee13$","_context13","_x13","environment","setEnvironment","getEnvironment","WatchError","_Error","_super2","_ref8","_this","message","code","_wrapNativeSuper","WatchStreamState","WatchStream","_state","NEED_DATA","_error","_textDecoder","_buffer","_bufferOffset","_eventType","_dataBuffer","feedBuffer","buffer","assertState","stream","advanceBufferState","feedLine","line","endsWith","feedSse","eventType","colon","field","sse","firstPercentIndex","start","percentIndex","encoded","parsed","_nextEvent","HAVE_EVENT","_unused","HAVE_ERROR","_EJSON$parse","errorCode","error_code","error","_unused2","nextEvent","out","nextNewlineIndex","MongoDBCollection","databaseName","collectionName","functions","find","options","database","collection","query","project","projection","sort","limit","findOne","findOneAndUpdate","update","upsert","returnNewDocument","findOneAndReplace","replacement","findOneAndDelete","aggregate","pipeline","insertOne","insertMany","documents","deleteOne","deleteMany","updateOne","arrayFilters","updateMany","watch","_ref9","ids","iterable","iterator","Symbol","asyncIterator","watchImpl","originalReturn","return","_return","_wrapAsyncGenerator","_callee14","watchStream","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","chunk","_callee14$","_context14","t0","_asyncIterator","_awaitAsyncGenerator","t1","t2","createCollection","createDatabase","createService","db","DEFAULT_DEVICE_ID","UserState","UserType$1","User","parameters","_accessToken","accessToken","_refreshToken","refreshToken","_profile","clone","userContext","currentUser","token","allUsers","LoggedOut","Active","Removed","decodedToken","decodeAccessToken","userData","payload","parsedPayload","deviceId","_refreshProfile","_callee15","_callee15$","_context15","refreshProfile","_logOut","_callee16","_callee16$","_context16","includes","logOut","_linkCredentials","_callee17","credentials","_callee17$","_context17","authenticator","authenticate","linkCredentials","_x14","_refreshAccessToken","_callee18","_callee18$","_context18","access_token","refreshAccessToken","_refreshCustomData","_callee19","_callee19$","_context19","customData","refreshCustomData","removeAllListeners","_this$functions","_len4","_key4","toJSON","mongoClient","parts","encodedPayload","decodedPayload","expires","exp","issuedAt","iat","subject","sub","_parsedPayload$user_d","user_data","Credentials","anonymous","apiKey","emailPassword","email","password","username","_function","jwt","google","derivePayload","id_token","idToken","facebook","redirectUrlOrAccessToken","redirectUrl","apple","redirectUrlOrIdToken","USER_IDS_STORAGE_KEY","DEVICE_ID_STORAGE_KEY","AppStorage","_PrefixedStorage2","_super3","getUserIds","userIdsString","userIds","setUserIds","mergeWithExisting","existingIds","_iterator3","_step3","removeUserId","getDeviceId","setDeviceId","LOWERCASE_LETTERS","CLOSE_CHECK_INTERVAL","REDIRECT_HASH_TO_RESULT","_stitch_client_app_id","_baas_client_app_id","_stitch_ua","_baas_ua","_stitch_link","_baas_link","_stitch_error","_baas_error","_stitch_state","_baas_state","OAuth2Helper","openWindow","openWindowAndWaitForRedirect","_this2","stateStorage","getStateStorage","Promise","resolve","reject","redirectWindow","windowClosedInterval","handleStorageUpdate","parsedResult","clearInterval","close","console","warn","setInterval","closed","generateState","parseRedirectLocation","queryString","_i3","_Object$entries2","_Object$entries2$_i","handleRedirect","defaultStorage","oauth2Storage","decodeAuthInfo","authInfo","_parts","REDIRECT_LOCATION_HEADER","Authenticator","getDeviceInformation","oauth2","_authenticate","_callee20","linkingUser","deviceInformation","isLinking","logInUrl","_response","_response$refresh_tok","_callee20$","_context20","getLogInUrl","redirect","providerRedirectHeader","device","user","mode","openWindowAndWaitForAuthResponse","user_id","refresh_token","device_id","_x15","_x16","_getLogInUrl","_callee21","link","extraQueryParams","loginRoute","locationUrl","_args21","_callee21$","_context21","_x17","_openWindowAndWaitForAuthResponse","_callee22","redirectResult","_callee22$","_context22","userAuth","_x18","_x19","MongoDBRealmError","_Error2","_super4","statusText","_this3","summary","_possibleConstructorReturn","_fromRequestAndResponse","_callee23","_callee23$","_context23","json","fromRequestAndResponse","_x20","_x21","asyncIteratorFromResponseBody","reader","getReader","read","_callee24","_callee24$","_context24","cancel","Fetcher","_ref12","transport","locationUrlContext","_fetch2","_callee25","_request$tokenType","_request$user","restOfRequest","_url","_callee25$","_context25","_excluded2","buildAuthorizationHeader","ok","_x22","_fetchJSON","_callee26","serializedBody","contentTypeHeaders","contentType","responseBody","_callee26$","_context26","buildBody","buildJsonHeader","Accept","_x23","_fetchStream","_callee27","_yield$this$fetch","_callee27$","_context27","_x24","Authorization","log","DEVICE_ID_STORAGE_KEY$1","DeviceFields","DeviceInformation","_ref13","appVersion","sdkVersion","platformVersion","DEFAULT_BASE_URL","App","idOrConfiguration","_this4","users","_locationUrl","configuration","baseUrl","skipLocationRequest","localApp","_configuration$transp","baseStorage","hydrate","switchUser","nextUser","index","findIndex","_this$users$splice","splice","_this$users$splice2","unshift","_logIn","_callee28","fetchProfile","_args28","_callee28$","_context28","createOrUpdateUser","logIn","_x25","_removeUser","_callee29","_callee29$","_context29","removeUser","_x26","_deleteUser","_callee30","_callee30$","_context30","deleteUser","_x27","activeUsers","_this5","_ref14","hostname","deviceIdStr","existingUser","_this6","getApp","appCache","instance","setIsDevelopmentMode$1","check$1","safeGlobalThis$1","LocalStorage","localStorage","getItem","setItem","removeItem","_i4","_keys","addEventListener","removeEventListener","DefaultStorage","open","environment$1","handleAuthRedirect","hash"],"sources":["C:/Users/Admin/Desktop/projects/auth/keycloak-reactjs-demo/node_modules/realm-web/dist/bundle.dom.es.js"],"sourcesContent":["import { EJSON, ObjectId } from 'bson';\nimport * as bson from 'bson';\nexport { bson as BSON };\n\nvar __spreadArray = (undefined && undefined.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar BrowserInfo = /** @class */ (function () {\n    function BrowserInfo(name, version, os) {\n        this.name = name;\n        this.version = version;\n        this.os = os;\n        this.type = 'browser';\n    }\n    return BrowserInfo;\n}());\nvar NodeInfo = /** @class */ (function () {\n    function NodeInfo(version) {\n        this.version = version;\n        this.type = 'node';\n        this.name = 'node';\n        this.os = process.platform;\n    }\n    return NodeInfo;\n}());\nvar SearchBotDeviceInfo = /** @class */ (function () {\n    function SearchBotDeviceInfo(name, version, os, bot) {\n        this.name = name;\n        this.version = version;\n        this.os = os;\n        this.bot = bot;\n        this.type = 'bot-device';\n    }\n    return SearchBotDeviceInfo;\n}());\nvar BotInfo = /** @class */ (function () {\n    function BotInfo() {\n        this.type = 'bot';\n        this.bot = true; // NOTE: deprecated test name instead\n        this.name = 'bot';\n        this.version = null;\n        this.os = null;\n    }\n    return BotInfo;\n}());\nvar ReactNativeInfo = /** @class */ (function () {\n    function ReactNativeInfo() {\n        this.type = 'react-native';\n        this.name = 'react-native';\n        this.version = null;\n        this.os = null;\n    }\n    return ReactNativeInfo;\n}());\n// tslint:disable-next-line:max-line-length\nvar SEARCHBOX_UA_REGEX = /alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/;\nvar SEARCHBOT_OS_REGEX = /(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\\ Jeeves\\/Teoma|ia_archiver)/;\nvar REQUIRED_VERSION_PARTS = 3;\nvar userAgentRules = [\n    ['aol', /AOLShield\\/([0-9\\._]+)/],\n    ['edge', /Edge\\/([0-9\\._]+)/],\n    ['edge-ios', /EdgiOS\\/([0-9\\._]+)/],\n    ['yandexbrowser', /YaBrowser\\/([0-9\\._]+)/],\n    ['kakaotalk', /KAKAOTALK\\s([0-9\\.]+)/],\n    ['samsung', /SamsungBrowser\\/([0-9\\.]+)/],\n    ['silk', /\\bSilk\\/([0-9._-]+)\\b/],\n    ['miui', /MiuiBrowser\\/([0-9\\.]+)$/],\n    ['beaker', /BeakerBrowser\\/([0-9\\.]+)/],\n    ['edge-chromium', /EdgA?\\/([0-9\\.]+)/],\n    [\n        'chromium-webview',\n        /(?!Chrom.*OPR)wv\\).*Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/,\n    ],\n    ['chrome', /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/],\n    ['phantomjs', /PhantomJS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['crios', /CriOS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['firefox', /Firefox\\/([0-9\\.]+)(?:\\s|$)/],\n    ['fxios', /FxiOS\\/([0-9\\.]+)/],\n    ['opera-mini', /Opera Mini.*Version\\/([0-9\\.]+)/],\n    ['opera', /Opera\\/([0-9\\.]+)(?:\\s|$)/],\n    ['opera', /OPR\\/([0-9\\.]+)(:?\\s|$)/],\n    ['ie', /Trident\\/7\\.0.*rv\\:([0-9\\.]+).*\\).*Gecko$/],\n    ['ie', /MSIE\\s([0-9\\.]+);.*Trident\\/[4-7].0/],\n    ['ie', /MSIE\\s(7\\.0)/],\n    ['bb10', /BB10;\\sTouch.*Version\\/([0-9\\.]+)/],\n    ['android', /Android\\s([0-9\\.]+)/],\n    ['ios', /Version\\/([0-9\\._]+).*Mobile.*Safari.*/],\n    ['safari', /Version\\/([0-9\\._]+).*Safari/],\n    ['facebook', /FB[AS]V\\/([0-9\\.]+)/],\n    ['instagram', /Instagram\\s([0-9\\.]+)/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Mobile/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Gecko\\)$/],\n    ['curl', /^curl\\/([0-9\\.]+)$/],\n    ['searchbot', SEARCHBOX_UA_REGEX],\n];\nvar operatingSystemRules = [\n    ['iOS', /iP(hone|od|ad)/],\n    ['Android OS', /Android/],\n    ['BlackBerry OS', /BlackBerry|BB10/],\n    ['Windows Mobile', /IEMobile/],\n    ['Amazon OS', /Kindle/],\n    ['Windows 3.11', /Win16/],\n    ['Windows 95', /(Windows 95)|(Win95)|(Windows_95)/],\n    ['Windows 98', /(Windows 98)|(Win98)/],\n    ['Windows 2000', /(Windows NT 5.0)|(Windows 2000)/],\n    ['Windows XP', /(Windows NT 5.1)|(Windows XP)/],\n    ['Windows Server 2003', /(Windows NT 5.2)/],\n    ['Windows Vista', /(Windows NT 6.0)/],\n    ['Windows 7', /(Windows NT 6.1)/],\n    ['Windows 8', /(Windows NT 6.2)/],\n    ['Windows 8.1', /(Windows NT 6.3)/],\n    ['Windows 10', /(Windows NT 10.0)/],\n    ['Windows ME', /Windows ME/],\n    ['Open BSD', /OpenBSD/],\n    ['Sun OS', /SunOS/],\n    ['Chrome OS', /CrOS/],\n    ['Linux', /(Linux)|(X11)/],\n    ['Mac OS', /(Mac_PowerPC)|(Macintosh)/],\n    ['QNX', /QNX/],\n    ['BeOS', /BeOS/],\n    ['OS/2', /OS\\/2/],\n];\nfunction detect(userAgent) {\n    if (!!userAgent) {\n        return parseUserAgent(userAgent);\n    }\n    if (typeof document === 'undefined' &&\n        typeof navigator !== 'undefined' &&\n        navigator.product === 'ReactNative') {\n        return new ReactNativeInfo();\n    }\n    if (typeof navigator !== 'undefined') {\n        return parseUserAgent(navigator.userAgent);\n    }\n    return getNodeVersion();\n}\nfunction matchUserAgent(ua) {\n    // opted for using reduce here rather than Array#first with a regex.test call\n    // this is primarily because using the reduce we only perform the regex\n    // execution once rather than once for the test and for the exec again below\n    // probably something that needs to be benchmarked though\n    return (ua !== '' &&\n        userAgentRules.reduce(function (matched, _a) {\n            var browser = _a[0], regex = _a[1];\n            if (matched) {\n                return matched;\n            }\n            var uaMatch = regex.exec(ua);\n            return !!uaMatch && [browser, uaMatch];\n        }, false));\n}\nfunction parseUserAgent(ua) {\n    var matchedRule = matchUserAgent(ua);\n    if (!matchedRule) {\n        return null;\n    }\n    var name = matchedRule[0], match = matchedRule[1];\n    if (name === 'searchbot') {\n        return new BotInfo();\n    }\n    // Do not use RegExp for split operation as some browser do not support it (See: http://blog.stevenlevithan.com/archives/cross-browser-split)\n    var versionParts = match[1] && match[1].split('.').join('_').split('_').slice(0, 3);\n    if (versionParts) {\n        if (versionParts.length < REQUIRED_VERSION_PARTS) {\n            versionParts = __spreadArray(__spreadArray([], versionParts, true), createVersionParts(REQUIRED_VERSION_PARTS - versionParts.length), true);\n        }\n    }\n    else {\n        versionParts = [];\n    }\n    var version = versionParts.join('.');\n    var os = detectOS(ua);\n    var searchBotMatch = SEARCHBOT_OS_REGEX.exec(ua);\n    if (searchBotMatch && searchBotMatch[1]) {\n        return new SearchBotDeviceInfo(name, version, os, searchBotMatch[1]);\n    }\n    return new BrowserInfo(name, version, os);\n}\nfunction detectOS(ua) {\n    for (var ii = 0, count = operatingSystemRules.length; ii < count; ii++) {\n        var _a = operatingSystemRules[ii], os = _a[0], regex = _a[1];\n        var match = regex.exec(ua);\n        if (match) {\n            return os;\n        }\n    }\n    return null;\n}\nfunction getNodeVersion() {\n    var isNode = typeof process !== 'undefined' && process.version;\n    return isNode ? new NodeInfo(process.version.slice(1)) : null;\n}\nfunction createVersionParts(count) {\n    var output = [];\n    for (var ii = 0; ii < count; ii++) {\n        output.push('0');\n    }\n    return output;\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\nclass DefaultNetworkTransport {\n    constructor() {\n        if (!DefaultNetworkTransport.fetch) {\n            throw new Error(\"DefaultNetworkTransport.fetch must be set before it's used\");\n        }\n        if (!DefaultNetworkTransport.AbortController) {\n            throw new Error(\"DefaultNetworkTransport.AbortController must be set before it's used\");\n        }\n    }\n    fetchWithCallbacks(request, handler) {\n        // tslint:disable-next-line: no-console\n        this.fetch(request)\n            .then(async (response) => {\n            const decodedBody = await response.text();\n            // Pull out the headers of the response\n            const responseHeaders = {};\n            response.headers.forEach((value, key) => {\n                responseHeaders[key] = value;\n            });\n            return {\n                statusCode: response.status,\n                headers: responseHeaders,\n                body: decodedBody,\n            };\n        })\n            .then((r) => handler.onSuccess(r))\n            .catch((e) => handler.onError(e));\n    }\n    async fetch(request) {\n        const { timeoutMs, url, ...rest } = request;\n        const { signal, cancelTimeout } = this.createTimeoutSignal(timeoutMs);\n        try {\n            // We'll await the response to catch throw our own error\n            return await DefaultNetworkTransport.fetch(url, {\n                ...DefaultNetworkTransport.extraFetchOptions,\n                signal,\n                ...rest,\n            });\n        }\n        finally {\n            // Whatever happens, cancel any timeout\n            cancelTimeout();\n        }\n    }\n    createTimeoutSignal(timeoutMs) {\n        if (typeof timeoutMs === \"number\") {\n            const controller = new DefaultNetworkTransport.AbortController();\n            // Call abort after a specific number of milliseconds\n            const timeout = setTimeout(() => {\n                controller.abort();\n            }, timeoutMs);\n            return {\n                signal: controller.signal,\n                cancelTimeout: () => {\n                    clearTimeout(timeout);\n                },\n            };\n        }\n        else {\n            return {\n                signal: undefined,\n                cancelTimeout: () => {\n                    /* No-op */\n                },\n            };\n        }\n    }\n}\nDefaultNetworkTransport.DEFAULT_HEADERS = {\n    \"Content-Type\": \"application/json\",\n};\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Set the value of `isDevelopmentMode`. This allows each entry point (node vs DOM)\n * to use its own method for determining whether we are in development mode.\n *\n * @param state A boolean indicating whether the user's app is running in\n * development mode or not.\n */\nconst setIsDevelopmentMode = (state) => {\n};\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2022 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n// Exports a globalThis which is polyfilled for iOS 11/12\n// From https://github.com/zloirock/core-js/blob/master/packages/core-js/internals/global.js\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst check = function (it) {\n    return it && it.Math == Math && it;\n};\n// eslint-disable-next-line no-restricted-globals\nconst safeGlobalThis = \n// eslint-disable-next-line no-restricted-globals\ncheck(typeof globalThis == \"object\" && globalThis) ||\n    check(typeof window == \"object\" && window) ||\n    // eslint-disable-next-line no-restricted-globals -- safe\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore allow `self`\n    check(typeof self == \"object\" && self) ||\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore allow `global`\n    check(typeof global == \"object\" && global) ||\n    // eslint-disable-next-line no-new-func -- fallback\n    (function () {\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore allow `this`\n        return this;\n    })() ||\n    Function(\"return this\")();\n\n////////////////////////////////////////////////////////////////////////////\n// React/React Native set a global __DEV__ variable when running in dev mode\nsetIsDevelopmentMode(typeof __DEV__ !== \"undefined\" && __DEV__);\n\n////////////////////////////////////////////////////////////////////////////\nDefaultNetworkTransport.fetch = safeGlobalThis.fetch.bind(safeGlobalThis);\nDefaultNetworkTransport.AbortController = safeGlobalThis.AbortController.bind(safeGlobalThis);\n\n/**\n *  base64.ts\n *\n *  Licensed under the BSD 3-Clause License.\n *    http://opensource.org/licenses/BSD-3-Clause\n *\n *  References:\n *    http://en.wikipedia.org/wiki/Base64\n *\n * @author Dan Kogai (https://github.com/dankogai)\n */\nconst version = '3.7.2';\n/**\n * @deprecated use lowercase `version`.\n */\nconst VERSION = version;\nconst _hasatob = typeof atob === 'function';\nconst _hasbtoa = typeof btoa === 'function';\nconst _hasBuffer = typeof Buffer === 'function';\nconst _TD = typeof TextDecoder === 'function' ? new TextDecoder() : undefined;\nconst _TE = typeof TextEncoder === 'function' ? new TextEncoder() : undefined;\nconst b64ch = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\nconst b64chs = Array.prototype.slice.call(b64ch);\nconst b64tab = ((a) => {\n    let tab = {};\n    a.forEach((c, i) => tab[c] = i);\n    return tab;\n})(b64chs);\nconst b64re = /^(?:[A-Za-z\\d+\\/]{4})*?(?:[A-Za-z\\d+\\/]{2}(?:==)?|[A-Za-z\\d+\\/]{3}=?)?$/;\nconst _fromCC = String.fromCharCode.bind(String);\nconst _U8Afrom = typeof Uint8Array.from === 'function'\n    ? Uint8Array.from.bind(Uint8Array)\n    : (it, fn = (x) => x) => new Uint8Array(Array.prototype.slice.call(it, 0).map(fn));\nconst _mkUriSafe = (src) => src\n    .replace(/=/g, '').replace(/[+\\/]/g, (m0) => m0 == '+' ? '-' : '_');\nconst _tidyB64 = (s) => s.replace(/[^A-Za-z0-9\\+\\/]/g, '');\n/**\n * polyfill version of `btoa`\n */\nconst btoaPolyfill = (bin) => {\n    // console.log('polyfilled');\n    let u32, c0, c1, c2, asc = '';\n    const pad = bin.length % 3;\n    for (let i = 0; i < bin.length;) {\n        if ((c0 = bin.charCodeAt(i++)) > 255 ||\n            (c1 = bin.charCodeAt(i++)) > 255 ||\n            (c2 = bin.charCodeAt(i++)) > 255)\n            throw new TypeError('invalid character found');\n        u32 = (c0 << 16) | (c1 << 8) | c2;\n        asc += b64chs[u32 >> 18 & 63]\n            + b64chs[u32 >> 12 & 63]\n            + b64chs[u32 >> 6 & 63]\n            + b64chs[u32 & 63];\n    }\n    return pad ? asc.slice(0, pad - 3) + \"===\".substring(pad) : asc;\n};\n/**\n * does what `window.btoa` of web browsers do.\n * @param {String} bin binary string\n * @returns {string} Base64-encoded string\n */\nconst _btoa = _hasbtoa ? (bin) => btoa(bin)\n    : _hasBuffer ? (bin) => Buffer.from(bin, 'binary').toString('base64')\n        : btoaPolyfill;\nconst _fromUint8Array = _hasBuffer\n    ? (u8a) => Buffer.from(u8a).toString('base64')\n    : (u8a) => {\n        // cf. https://stackoverflow.com/questions/12710001/how-to-convert-uint8-array-to-base64-encoded-string/12713326#12713326\n        const maxargs = 0x1000;\n        let strs = [];\n        for (let i = 0, l = u8a.length; i < l; i += maxargs) {\n            strs.push(_fromCC.apply(null, u8a.subarray(i, i + maxargs)));\n        }\n        return _btoa(strs.join(''));\n    };\n/**\n * converts a Uint8Array to a Base64 string.\n * @param {boolean} [urlsafe] URL-and-filename-safe a la RFC4648 ยง5\n * @returns {string} Base64 string\n */\nconst fromUint8Array = (u8a, urlsafe = false) => urlsafe ? _mkUriSafe(_fromUint8Array(u8a)) : _fromUint8Array(u8a);\n// This trick is found broken https://github.com/dankogai/js-base64/issues/130\n// const utob = (src: string) => unescape(encodeURIComponent(src));\n// reverting good old fationed regexp\nconst cb_utob = (c) => {\n    if (c.length < 2) {\n        var cc = c.charCodeAt(0);\n        return cc < 0x80 ? c\n            : cc < 0x800 ? (_fromCC(0xc0 | (cc >>> 6))\n                + _fromCC(0x80 | (cc & 0x3f)))\n                : (_fromCC(0xe0 | ((cc >>> 12) & 0x0f))\n                    + _fromCC(0x80 | ((cc >>> 6) & 0x3f))\n                    + _fromCC(0x80 | (cc & 0x3f)));\n    }\n    else {\n        var cc = 0x10000\n            + (c.charCodeAt(0) - 0xD800) * 0x400\n            + (c.charCodeAt(1) - 0xDC00);\n        return (_fromCC(0xf0 | ((cc >>> 18) & 0x07))\n            + _fromCC(0x80 | ((cc >>> 12) & 0x3f))\n            + _fromCC(0x80 | ((cc >>> 6) & 0x3f))\n            + _fromCC(0x80 | (cc & 0x3f)));\n    }\n};\nconst re_utob = /[\\uD800-\\uDBFF][\\uDC00-\\uDFFFF]|[^\\x00-\\x7F]/g;\n/**\n * @deprecated should have been internal use only.\n * @param {string} src UTF-8 string\n * @returns {string} UTF-16 string\n */\nconst utob = (u) => u.replace(re_utob, cb_utob);\n//\nconst _encode = _hasBuffer\n    ? (s) => Buffer.from(s, 'utf8').toString('base64')\n    : _TE\n        ? (s) => _fromUint8Array(_TE.encode(s))\n        : (s) => _btoa(utob(s));\n/**\n * converts a UTF-8-encoded string to a Base64 string.\n * @param {boolean} [urlsafe] if `true` make the result URL-safe\n * @returns {string} Base64 string\n */\nconst encode = (src, urlsafe = false) => urlsafe\n    ? _mkUriSafe(_encode(src))\n    : _encode(src);\n/**\n * converts a UTF-8-encoded string to URL-safe Base64 RFC4648 ยง5.\n * @returns {string} Base64 string\n */\nconst encodeURI = (src) => encode(src, true);\n// This trick is found broken https://github.com/dankogai/js-base64/issues/130\n// const btou = (src: string) => decodeURIComponent(escape(src));\n// reverting good old fationed regexp\nconst re_btou = /[\\xC0-\\xDF][\\x80-\\xBF]|[\\xE0-\\xEF][\\x80-\\xBF]{2}|[\\xF0-\\xF7][\\x80-\\xBF]{3}/g;\nconst cb_btou = (cccc) => {\n    switch (cccc.length) {\n        case 4:\n            var cp = ((0x07 & cccc.charCodeAt(0)) << 18)\n                | ((0x3f & cccc.charCodeAt(1)) << 12)\n                | ((0x3f & cccc.charCodeAt(2)) << 6)\n                | (0x3f & cccc.charCodeAt(3)), offset = cp - 0x10000;\n            return (_fromCC((offset >>> 10) + 0xD800)\n                + _fromCC((offset & 0x3FF) + 0xDC00));\n        case 3:\n            return _fromCC(((0x0f & cccc.charCodeAt(0)) << 12)\n                | ((0x3f & cccc.charCodeAt(1)) << 6)\n                | (0x3f & cccc.charCodeAt(2)));\n        default:\n            return _fromCC(((0x1f & cccc.charCodeAt(0)) << 6)\n                | (0x3f & cccc.charCodeAt(1)));\n    }\n};\n/**\n * @deprecated should have been internal use only.\n * @param {string} src UTF-16 string\n * @returns {string} UTF-8 string\n */\nconst btou = (b) => b.replace(re_btou, cb_btou);\n/**\n * polyfill version of `atob`\n */\nconst atobPolyfill = (asc) => {\n    // console.log('polyfilled');\n    asc = asc.replace(/\\s+/g, '');\n    if (!b64re.test(asc))\n        throw new TypeError('malformed base64.');\n    asc += '=='.slice(2 - (asc.length & 3));\n    let u24, bin = '', r1, r2;\n    for (let i = 0; i < asc.length;) {\n        u24 = b64tab[asc.charAt(i++)] << 18\n            | b64tab[asc.charAt(i++)] << 12\n            | (r1 = b64tab[asc.charAt(i++)]) << 6\n            | (r2 = b64tab[asc.charAt(i++)]);\n        bin += r1 === 64 ? _fromCC(u24 >> 16 & 255)\n            : r2 === 64 ? _fromCC(u24 >> 16 & 255, u24 >> 8 & 255)\n                : _fromCC(u24 >> 16 & 255, u24 >> 8 & 255, u24 & 255);\n    }\n    return bin;\n};\n/**\n * does what `window.atob` of web browsers do.\n * @param {String} asc Base64-encoded string\n * @returns {string} binary string\n */\nconst _atob = _hasatob ? (asc) => atob(_tidyB64(asc))\n    : _hasBuffer ? (asc) => Buffer.from(asc, 'base64').toString('binary')\n        : atobPolyfill;\n//\nconst _toUint8Array = _hasBuffer\n    ? (a) => _U8Afrom(Buffer.from(a, 'base64'))\n    : (a) => _U8Afrom(_atob(a), c => c.charCodeAt(0));\n/**\n * converts a Base64 string to a Uint8Array.\n */\nconst toUint8Array = (a) => _toUint8Array(_unURI(a));\n//\nconst _decode = _hasBuffer\n    ? (a) => Buffer.from(a, 'base64').toString('utf8')\n    : _TD\n        ? (a) => _TD.decode(_toUint8Array(a))\n        : (a) => btou(_atob(a));\nconst _unURI = (a) => _tidyB64(a.replace(/[-_]/g, (m0) => m0 == '-' ? '+' : '/'));\n/**\n * converts a Base64 string to a UTF-8 string.\n * @param {String} src Base64 string.  Both normal and URL-safe are supported\n * @returns {string} UTF-8 string\n */\nconst decode = (src) => _decode(_unURI(src));\n/**\n * check if a value is a valid Base64 string\n * @param {String} src a value to check\n  */\nconst isValid = (src) => {\n    if (typeof src !== 'string')\n        return false;\n    const s = src.replace(/\\s+/g, '').replace(/={0,2}$/, '');\n    return !/[^\\s0-9a-zA-Z\\+/]/.test(s) || !/[^\\s0-9a-zA-Z\\-_]/.test(s);\n};\n//\nconst _noEnum = (v) => {\n    return {\n        value: v, enumerable: false, writable: true, configurable: true\n    };\n};\n/**\n * extend String.prototype with relevant methods\n */\nconst extendString = function () {\n    const _add = (name, body) => Object.defineProperty(String.prototype, name, _noEnum(body));\n    _add('fromBase64', function () { return decode(this); });\n    _add('toBase64', function (urlsafe) { return encode(this, urlsafe); });\n    _add('toBase64URI', function () { return encode(this, true); });\n    _add('toBase64URL', function () { return encode(this, true); });\n    _add('toUint8Array', function () { return toUint8Array(this); });\n};\n/**\n * extend Uint8Array.prototype with relevant methods\n */\nconst extendUint8Array = function () {\n    const _add = (name, body) => Object.defineProperty(Uint8Array.prototype, name, _noEnum(body));\n    _add('toBase64', function (urlsafe) { return fromUint8Array(this, urlsafe); });\n    _add('toBase64URI', function () { return fromUint8Array(this, true); });\n    _add('toBase64URL', function () { return fromUint8Array(this, true); });\n};\n/**\n * extend Builtin prototypes with relevant methods\n */\nconst extendBuiltins = () => {\n    extendString();\n    extendUint8Array();\n};\nconst gBase64 = {\n    version: version,\n    VERSION: VERSION,\n    atob: _atob,\n    atobPolyfill: atobPolyfill,\n    btoa: _btoa,\n    btoaPolyfill: btoaPolyfill,\n    fromBase64: decode,\n    toBase64: encode,\n    encode: encode,\n    encodeURI: encodeURI,\n    encodeURL: encodeURI,\n    utob: utob,\n    btou: btou,\n    decode: decode,\n    isValid: isValid,\n    fromUint8Array: fromUint8Array,\n    toUint8Array: toUint8Array,\n    extendString: extendString,\n    extendUint8Array: extendUint8Array,\n    extendBuiltins: extendBuiltins,\n};\n\n////////////////////////////////////////////////////////////////////////////\nconst SERIALIZATION_OPTIONS = {\n    relaxed: false, // Ensure Canonical mode\n};\n/**\n * Serialize an object containing BSON types into extended-JSON.\n *\n * @param obj The object containing BSON types.\n * @returns The document in extended-JSON format.\n */\nfunction serialize(obj) {\n    return EJSON.serialize(obj, SERIALIZATION_OPTIONS);\n}\n/**\n * De-serialize an object or an array of object from extended-JSON into an object or an array of object with BSON types.\n *\n * @param obj The object or array of objects in extended-JSON format.\n * @returns The object or array of objects with inflated BSON types.\n */\nfunction deserialize(obj) {\n    if (Array.isArray(obj)) {\n        return obj.map((doc) => EJSON.deserialize(doc));\n    }\n    else {\n        return EJSON.deserialize(obj);\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * The type of a user.\n */\nvar UserType;\n(function (UserType) {\n    /**\n     * A normal end-user created this user.\n     */\n    UserType[\"Normal\"] = \"normal\";\n    /**\n     * The user was created by the server.\n     */\n    UserType[\"Server\"] = \"server\";\n})(UserType || (UserType = {}));\n/** @ignore */\nvar DataKey;\n(function (DataKey) {\n    /** @ignore */\n    DataKey[\"NAME\"] = \"name\";\n    /** @ignore */\n    DataKey[\"EMAIL\"] = \"email\";\n    /** @ignore */\n    DataKey[\"PICTURE\"] = \"picture\";\n    /** @ignore */\n    DataKey[\"FIRST_NAME\"] = \"first_name\";\n    /** @ignore */\n    DataKey[\"LAST_NAME\"] = \"last_name\";\n    /** @ignore */\n    DataKey[\"GENDER\"] = \"gender\";\n    /** @ignore */\n    DataKey[\"BIRTHDAY\"] = \"birthday\";\n    /** @ignore */\n    DataKey[\"MIN_AGE\"] = \"min_age\";\n    /** @ignore */\n    DataKey[\"MAX_AGE\"] = \"max_age\";\n})(DataKey || (DataKey = {}));\nconst DATA_MAPPING = {\n    [DataKey.NAME]: \"name\",\n    [DataKey.EMAIL]: \"email\",\n    [DataKey.PICTURE]: \"pictureUrl\",\n    [DataKey.FIRST_NAME]: \"firstName\",\n    [DataKey.LAST_NAME]: \"lastName\",\n    [DataKey.GENDER]: \"gender\",\n    [DataKey.BIRTHDAY]: \"birthday\",\n    [DataKey.MIN_AGE]: \"minAge\",\n    [DataKey.MAX_AGE]: \"maxAge\",\n};\n/** @inheritdoc */\nclass UserProfile {\n    /**\n     * @param response The response of a call fetching the users profile.\n     */\n    constructor(response) {\n        /** @ignore */\n        this.type = UserType.Normal;\n        /** @ignore */\n        this.identities = [];\n        if (typeof response === \"object\" && response !== null) {\n            const { type, identities, data } = response;\n            if (typeof type === \"string\") {\n                this.type = type;\n            }\n            else {\n                throw new Error(\"Expected 'type' in the response body\");\n            }\n            if (Array.isArray(identities)) {\n                this.identities = identities.map((identity) => {\n                    const { id, provider_type: providerType } = identity;\n                    return { id, providerType };\n                });\n            }\n            else {\n                throw new Error(\"Expected 'identities' in the response body\");\n            }\n            if (typeof data === \"object\" && data !== null) {\n                const mappedData = Object.fromEntries(Object.entries(data).map(([key, value]) => {\n                    if (key in DATA_MAPPING) {\n                        // Translate any known data field to its JS idiomatic alias\n                        return [DATA_MAPPING[key], value];\n                    }\n                    else {\n                        // Pass through any other values\n                        return [key, value];\n                    }\n                }));\n                // We can use `any` since we trust the user supplies the correct type\n                this.data = deserialize(mappedData);\n            }\n            else {\n                throw new Error(\"Expected 'data' in the response body\");\n            }\n        }\n        else {\n            this.data = {};\n        }\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * A `Storage` which will prefix a key part to every operation.\n */\nclass PrefixedStorage {\n    /**\n     * Construct a `Storage` which will prefix a key part to every operation.\n     *\n     * @param storage The underlying storage to use for operations.\n     * @param keyPart The part of the key to prefix when performing operations.\n     */\n    constructor(storage, keyPart) {\n        this.storage = storage;\n        this.keyPart = keyPart;\n    }\n    /** @inheritdoc */\n    get(key) {\n        return this.storage.get(this.keyPart + PrefixedStorage.PART_SEPARATOR + key);\n    }\n    /** @inheritdoc */\n    set(key, value) {\n        return this.storage.set(this.keyPart + PrefixedStorage.PART_SEPARATOR + key, value);\n    }\n    /** @inheritdoc */\n    remove(key) {\n        return this.storage.remove(this.keyPart + PrefixedStorage.PART_SEPARATOR + key);\n    }\n    /** @inheritdoc */\n    prefix(keyPart) {\n        return new PrefixedStorage(this, keyPart);\n    }\n    /** @inheritdoc */\n    clear(prefix = \"\") {\n        return this.storage.clear(this.keyPart + PrefixedStorage.PART_SEPARATOR + prefix);\n    }\n    /** @inheritdoc */\n    addListener(listener) {\n        return this.storage.addListener(listener);\n    }\n    /** @inheritdoc */\n    removeListener(listener) {\n        return this.storage.addListener(listener);\n    }\n}\n/**\n * The string separating two parts.\n */\nPrefixedStorage.PART_SEPARATOR = \":\";\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * In-memory storage that will not be persisted.\n */\nclass MemoryStorage {\n    constructor() {\n        /**\n         * Internal state of the storage.\n         */\n        this.storage = {};\n        /**\n         * A set of listners.\n         */\n        this.listeners = new Set();\n    }\n    /** @inheritdoc */\n    get(key) {\n        if (key in this.storage) {\n            return this.storage[key];\n        }\n        else {\n            return null;\n        }\n    }\n    /** @inheritdoc */\n    set(key, value) {\n        this.storage[key] = value;\n        // Fire the listeners\n        this.fireListeners();\n    }\n    /** @inheritdoc */\n    remove(key) {\n        delete this.storage[key];\n        // Fire the listeners\n        this.fireListeners();\n    }\n    /** @inheritdoc */\n    prefix(keyPart) {\n        return new PrefixedStorage(this, keyPart);\n    }\n    /** @inheritdoc */\n    clear(prefix) {\n        // Iterate all keys and delete their values if they have a matching prefix\n        for (const key of Object.keys(this.storage)) {\n            if (!prefix || key.startsWith(prefix)) {\n                delete this.storage[key];\n            }\n        }\n        // Fire the listeners\n        this.fireListeners();\n    }\n    /** @inheritdoc */\n    addListener(listener) {\n        this.listeners.add(listener);\n    }\n    /** @inheritdoc */\n    removeListener(listener) {\n        this.listeners.delete(listener);\n    }\n    /**\n     * Tell the listeners that a change occurred.\n     */\n    fireListeners() {\n        this.listeners.forEach((listener) => listener());\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\nconst ACCESS_TOKEN_STORAGE_KEY = \"accessToken\";\nconst REFRESH_TOKEN_STORAGE_KEY = \"refreshToken\";\nconst PROFILE_STORAGE_KEY = \"profile\";\nconst PROVIDER_TYPE_STORAGE_KEY = \"providerType\";\n/**\n * Storage specific to the app.\n */\nclass UserStorage extends PrefixedStorage {\n    /**\n     * Construct a storage for a `User`.\n     *\n     * @param storage The underlying storage to wrap.\n     * @param userId The id of the user.\n     */\n    constructor(storage, userId) {\n        super(storage, `user(${userId})`);\n    }\n    /**\n     * Get the access token from storage.\n     *\n     * @returns Access token (null if unknown).\n     */\n    get accessToken() {\n        return this.get(ACCESS_TOKEN_STORAGE_KEY);\n    }\n    /**\n     * Set the access token in storage.\n     *\n     * @param value Access token (null if unknown).\n     */\n    set accessToken(value) {\n        if (value === null) {\n            this.remove(ACCESS_TOKEN_STORAGE_KEY);\n        }\n        else {\n            this.set(ACCESS_TOKEN_STORAGE_KEY, value);\n        }\n    }\n    /**\n     * Get the refresh token from storage.\n     *\n     * @returns Refresh token (null if unknown and user is logged out).\n     */\n    get refreshToken() {\n        return this.get(REFRESH_TOKEN_STORAGE_KEY);\n    }\n    /**\n     * Set the refresh token in storage.\n     *\n     * @param value Refresh token (null if unknown and user is logged out).\n     */\n    set refreshToken(value) {\n        if (value === null) {\n            this.remove(REFRESH_TOKEN_STORAGE_KEY);\n        }\n        else {\n            this.set(REFRESH_TOKEN_STORAGE_KEY, value);\n        }\n    }\n    /**\n     * Get the user profile from storage.\n     *\n     * @returns User profile (undefined if its unknown).\n     */\n    get profile() {\n        const value = this.get(PROFILE_STORAGE_KEY);\n        if (value) {\n            const profile = new UserProfile();\n            // Patch in the values\n            Object.assign(profile, JSON.parse(value));\n            return profile;\n        }\n    }\n    /**\n     * Set the user profile in storage.\n     *\n     * @param value User profile (undefined if its unknown).\n     */\n    set profile(value) {\n        if (value) {\n            this.set(PROFILE_STORAGE_KEY, JSON.stringify(value));\n        }\n        else {\n            this.remove(PROFILE_STORAGE_KEY);\n        }\n    }\n    /**\n     * Get the type of authentication provider used to authenticate\n     *\n     * @returns User profile (undefined if its unknown).\n     */\n    get providerType() {\n        const value = this.get(PROVIDER_TYPE_STORAGE_KEY);\n        if (value) {\n            return value;\n        }\n    }\n    /**\n     * Set the type of authentication provider used to authenticate\n     *\n     * @param value Type of authentication provider.\n     */\n    set providerType(value) {\n        if (value) {\n            this.set(PROVIDER_TYPE_STORAGE_KEY, value);\n        }\n        else {\n            this.remove(PROVIDER_TYPE_STORAGE_KEY);\n        }\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * @param obj The object to remove keys (and undefined values from)\n * @returns A new object without the keys where the value is undefined.\n */\nfunction removeKeysWithUndefinedValues(obj) {\n    return Object.fromEntries(Object.entries(obj).filter((entry) => typeof entry[1] !== \"undefined\"));\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Generate a random sequence of characters.\n *\n * @param length The length of the string.\n * @param alphabet The alphabet of characters to pick from.\n * @returns A string of characters picked randomly from `alphabet`.\n */\nfunction generateRandomString(length, alphabet) {\n    let result = \"\";\n    for (let i = 0; i < length; i++) {\n        result += alphabet[Math.floor(Math.random() * alphabet.length)];\n    }\n    return result;\n}\n/**\n * Encode an object mapping from string to string, into a query string to be appended a URL.\n *\n * @param params The parameters to include in the string.\n * @param prefixed Should the \"?\" prefix be added if values exists?\n * @returns A URL encoded representation of the parameters (omitting a \"?\" prefix).\n */\nfunction encodeQueryString(params, prefixed = true) {\n    // Filter out undefined values\n    const cleanedParams = removeKeysWithUndefinedValues(params);\n    // Determine if a prefixed \"?\" is appropreate\n    const prefix = prefixed && Object.keys(cleanedParams).length > 0 ? \"?\" : \"\";\n    // Transform keys and values to a query string\n    return (prefix +\n        Object.entries(cleanedParams)\n            .map(([k, v]) => `${k}=${encodeURIComponent(v)}`)\n            .join(\"&\"));\n}\n/**\n * Decodes a query string into an object.\n *\n * @param str The query string to decode.\n * @returns The decoded query string.\n */\nfunction decodeQueryString(str) {\n    const cleanStr = str[0] === \"?\" ? str.substr(1) : str;\n    return Object.fromEntries(cleanStr\n        .split(\"&\")\n        .filter((s) => s.length > 0)\n        .map((kvp) => kvp.split(\"=\"))\n        .map(([k, v]) => [k, decodeURIComponent(v)]));\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * A list of names that functions cannot have to be callable through the functions proxy.\n */\nconst RESERVED_NAMES = [\n    \"inspect\",\n    \"callFunction\",\n    \"callFunctionStreaming\",\n    // Methods defined on the Object.prototype might be \"typeof probed\" and called by libraries and runtime environments.\n    ...Object.getOwnPropertyNames(Object.prototype),\n];\n/**\n * Remove the key for any fields with undefined values.\n *\n * @param args The arguments to clean.\n * @returns The cleaned arguments.\n */\nfunction cleanArgs(args) {\n    for (const arg of args) {\n        if (typeof arg === \"object\" && arg) {\n            for (const [key, value] of Object.entries(arg)) {\n                if (value === undefined) {\n                    delete arg[key];\n                }\n            }\n        }\n    }\n    return args;\n}\n/**\n * Remove keys for any undefined values and serialize to EJSON.\n *\n * @param args The arguments to clean and serialize.\n * @returns The cleaned and serialized arguments.\n */\nfunction cleanArgsAndSerialize(args) {\n    const cleaned = cleanArgs(args);\n    return cleaned.map((arg) => (typeof arg === \"object\" ? serialize(arg) : arg));\n}\n/**\n * Defines how functions are called.\n */\nclass FunctionsFactory {\n    /**\n     * @param fetcher The underlying fetcher to use when sending requests.\n     * @param config Additional configuration parameters.\n     */\n    constructor(fetcher, config = {}) {\n        this.fetcher = fetcher;\n        this.serviceName = config.serviceName;\n        this.argsTransformation = config.argsTransformation || cleanArgsAndSerialize;\n    }\n    /**\n     * Create a factory of functions, wrapped in a Proxy that returns bound copies of `callFunction` on any property.\n     *\n     * @param fetcher The underlying fetcher to use when requesting.\n     * @param config Additional configuration parameters.\n     * @returns The newly created factory of functions.\n     */\n    static create(fetcher, config = {}) {\n        // Create a proxy, wrapping a simple object returning methods that calls functions\n        // TODO: Lazily fetch available functions and return these from the ownKeys() trap\n        const factory = new FunctionsFactory(fetcher, config);\n        // Wrap the factory in a proxy that calls the internal call method\n        return new Proxy(factory, {\n            get(target, p, receiver) {\n                if (typeof p === \"string\" && RESERVED_NAMES.indexOf(p) === -1) {\n                    return target.callFunction.bind(target, p);\n                }\n                else {\n                    const prop = Reflect.get(target, p, receiver);\n                    return typeof prop === \"function\" ? prop.bind(target) : prop;\n                }\n            },\n        });\n    }\n    /**\n     * Call a remote function by it's name.\n     *\n     * @param name Name of the remote function.\n     * @param args Arguments to pass to the remote function.\n     * @returns A promise of the value returned when executing the remote function.\n     */\n    async callFunction(name, ...args) {\n        // See https://github.com/mongodb/stitch-js-sdk/blob/master/packages/core/sdk/src/services/internal/CoreStitchServiceClientImpl.ts\n        const body = {\n            name,\n            arguments: this.argsTransformation ? this.argsTransformation(args) : args,\n        };\n        if (this.serviceName) {\n            body.service = this.serviceName;\n        }\n        const appRoute = this.fetcher.appRoute;\n        return this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.functionsCall().path,\n            body,\n        });\n    }\n    /**\n     * Call a remote function by it's name.\n     *\n     * @param name Name of the remote function.\n     * @param args Arguments to pass to the remote function.\n     * @returns A promise of the value returned when executing the remote function.\n     */\n    callFunctionStreaming(name, ...args) {\n        const body = {\n            name,\n            arguments: this.argsTransformation ? this.argsTransformation(args) : args,\n        };\n        if (this.serviceName) {\n            body.service = this.serviceName;\n        }\n        const appRoute = this.fetcher.appRoute;\n        const qs = encodeQueryString({\n            [\"baas_request\"]: gBase64.encode(JSON.stringify(body)),\n        });\n        return this.fetcher.fetchStream({\n            method: \"GET\",\n            path: appRoute.functionsCall().path + qs,\n        });\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/** @inheritdoc */\nclass EmailPasswordAuth {\n    /**\n     * Construct an interface to the email / password authentication provider.\n     *\n     * @param fetcher The underlying fetcher used to request the services.\n     * @param providerName Optional custom name of the authentication provider.\n     */\n    constructor(fetcher, providerName = \"local-userpass\") {\n        this.fetcher = fetcher;\n        this.providerName = providerName;\n    }\n    /** @inheritdoc */\n    async registerUser(details) {\n        const appRoute = this.fetcher.appRoute;\n        await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.emailPasswordAuth(this.providerName).register().path,\n            body: details,\n        });\n    }\n    /** @inheritdoc */\n    async confirmUser(details) {\n        const appRoute = this.fetcher.appRoute;\n        await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.emailPasswordAuth(this.providerName).confirm().path,\n            body: details,\n        });\n    }\n    /** @inheritdoc */\n    async resendConfirmationEmail(details) {\n        const appRoute = this.fetcher.appRoute;\n        await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.emailPasswordAuth(this.providerName).confirmSend().path,\n            body: details,\n        });\n    }\n    /** @inheritdoc */\n    async retryCustomConfirmation(details) {\n        const appRoute = this.fetcher.appRoute;\n        await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.emailPasswordAuth(this.providerName).confirmCall().path,\n            body: details,\n        });\n    }\n    /** @inheritdoc */\n    async resetPassword(details) {\n        const appRoute = this.fetcher.appRoute;\n        await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.emailPasswordAuth(this.providerName).reset().path,\n            body: details,\n        });\n    }\n    /** @inheritdoc */\n    async sendResetPasswordEmail(details) {\n        const appRoute = this.fetcher.appRoute;\n        await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.emailPasswordAuth(this.providerName).resetSend().path,\n            body: details,\n        });\n    }\n    /** @inheritdoc */\n    async callResetPasswordFunction(details, ...args) {\n        const appRoute = this.fetcher.appRoute;\n        await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: appRoute.emailPasswordAuth(this.providerName).resetCall().path,\n            body: { ...details, arguments: args },\n        });\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * @returns The base api route.\n */\nfunction api() {\n    return {\n        path: \"/api/client/v2.0\",\n        /**\n         * @param appId The id of the app.\n         * @returns The URL of the app endpoint.\n         */\n        app(appId) {\n            return {\n                path: this.path + `/app/${appId}`,\n                /**\n                 * @returns The URL of the app location endpoint.\n                 */\n                location() {\n                    return {\n                        path: this.path + \"/location\",\n                    };\n                },\n                /**\n                 * @param providerName The name of the provider.\n                 * @returns The app url concatinated with the /auth/providers/{providerName}\n                 */\n                authProvider(providerName) {\n                    return {\n                        path: this.path + `/auth/providers/${providerName}`,\n                        /**\n                         * @returns Get the URL of an authentication provider.\n                         */\n                        login() {\n                            return { path: this.path + \"/login\" };\n                        },\n                    };\n                },\n                /**\n                 * @param providerName The name of the provider.\n                 * @returns The app url concatinated with the /auth/providers/{providerName}\n                 */\n                emailPasswordAuth(providerName) {\n                    const authProviderRoutes = this.authProvider(providerName);\n                    return {\n                        ...authProviderRoutes,\n                        register() {\n                            return { path: this.path + \"/register\" };\n                        },\n                        confirm() {\n                            return { path: this.path + \"/confirm\" };\n                        },\n                        confirmSend() {\n                            return { path: this.path + \"/confirm/send\" };\n                        },\n                        confirmCall() {\n                            return { path: this.path + \"/confirm/call\" };\n                        },\n                        reset() {\n                            return { path: this.path + \"/reset\" };\n                        },\n                        resetSend() {\n                            return { path: this.path + \"/reset/send\" };\n                        },\n                        resetCall() {\n                            return { path: this.path + \"/reset/call\" };\n                        },\n                    };\n                },\n                functionsCall() {\n                    return {\n                        path: this.path + \"/functions/call\",\n                    };\n                },\n            };\n        },\n        auth() {\n            return {\n                path: this.path + \"/auth\",\n                apiKeys() {\n                    return {\n                        path: this.path + \"/api_keys\",\n                        key(id) {\n                            return {\n                                path: this.path + `/${id}`,\n                                enable() {\n                                    return { path: this.path + \"/enable\" };\n                                },\n                                disable() {\n                                    return { path: this.path + \"/disable\" };\n                                },\n                            };\n                        },\n                    };\n                },\n                profile() {\n                    return { path: this.path + \"/profile\" };\n                },\n                session() {\n                    return { path: this.path + \"/session\" };\n                },\n                delete() {\n                    return { path: this.path + \"/delete\" };\n                },\n            };\n        },\n    };\n}\nvar routes = { api };\n\n////////////////////////////////////////////////////////////////////////////\n/** @inheritdoc */\nclass ApiKeyAuth {\n    /**\n     * Construct an interface to the API-key authentication provider.\n     *\n     * @param fetcher The fetcher used to send requests to services.\n     */\n    constructor(fetcher) {\n        this.fetcher = fetcher;\n    }\n    /** @inheritdoc */\n    create(name) {\n        return this.fetcher.fetchJSON({\n            method: \"POST\",\n            body: { name },\n            path: routes.api().auth().apiKeys().path,\n            tokenType: \"refresh\",\n        });\n    }\n    /** @inheritdoc */\n    fetch(keyId) {\n        return this.fetcher.fetchJSON({\n            method: \"GET\",\n            path: routes.api().auth().apiKeys().key(keyId).path,\n            tokenType: \"refresh\",\n        });\n    }\n    /** @inheritdoc */\n    fetchAll() {\n        return this.fetcher.fetchJSON({\n            method: \"GET\",\n            tokenType: \"refresh\",\n            path: routes.api().auth().apiKeys().path,\n        });\n    }\n    /** @inheritdoc */\n    async delete(keyId) {\n        await this.fetcher.fetchJSON({\n            method: \"DELETE\",\n            path: routes.api().auth().apiKeys().key(keyId).path,\n            tokenType: \"refresh\",\n        });\n    }\n    /** @inheritdoc */\n    async enable(keyId) {\n        await this.fetcher.fetchJSON({\n            method: \"PUT\",\n            path: routes.api().auth().apiKeys().key(keyId).enable().path,\n            tokenType: \"refresh\",\n        });\n    }\n    /** @inheritdoc */\n    async disable(keyId) {\n        await this.fetcher.fetchJSON({\n            method: \"PUT\",\n            path: routes.api().auth().apiKeys().key(keyId).disable().path,\n            tokenType: \"refresh\",\n        });\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\nlet environment = null;\n/**\n * Set the environment of execution.\n * Note: This should be called as the first thing before executing any code which calls getEnvironment()\n *\n * @param e An object containing environment specific implementations.\n */\nfunction setEnvironment(e) {\n    environment = e;\n}\n/**\n * Get the environment of execution.\n *\n * @returns An object containing environment specific implementations.\n */\nfunction getEnvironment() {\n    if (environment) {\n        return environment;\n    }\n    else {\n        throw new Error(\"Cannot get environment before it's set\");\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n/**\n * An error occured during the parsing of a watch stream.\n */\nclass WatchError extends Error {\n    constructor({ message, code }) {\n        super(message);\n        /**\n         * The name of this type of error\n         */\n        this.name = \"WatchError\";\n        this.code = code;\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n// NOTE: this is a fully processed event, not a single \"data: foo\" line!\n/**\n * The state of a WatchStream.\n */\nvar WatchStreamState;\n(function (WatchStreamState) {\n    /**\n     * Need to call one of the feed functions.\n     */\n    WatchStreamState[\"NEED_DATA\"] = \"NEED_DATA\";\n    /**\n     * Call nextEvent() to consume an event.\n     */\n    WatchStreamState[\"HAVE_EVENT\"] = \"HAVE_EVENT\";\n    /**\n     * Call error().\n     */\n    WatchStreamState[\"HAVE_ERROR\"] = \"HAVE_ERROR\";\n})(WatchStreamState || (WatchStreamState = {}));\n/**\n * Represents a stream of events\n */\nclass WatchStream {\n    constructor() {\n        this._state = WatchStreamState.NEED_DATA;\n        this._error = null;\n        // Used by feedBuffer to construct lines\n        this._textDecoder = new (getEnvironment().TextDecoder)();\n        this._buffer = \"\";\n        this._bufferOffset = 0;\n        // Used by feedLine for building the next SSE\n        this._eventType = \"\";\n        this._dataBuffer = \"\";\n    }\n    // Call these when you have data, in whatever shape is easiest for your SDK to get.\n    // Pick one, mixing and matching on a single instance isn't supported.\n    // These can only be called in NEED_DATA state, which is the initial state.\n    feedBuffer(buffer) {\n        this.assertState(WatchStreamState.NEED_DATA);\n        this._buffer += this._textDecoder.decode(buffer, { stream: true });\n        this.advanceBufferState();\n    }\n    feedLine(line) {\n        this.assertState(WatchStreamState.NEED_DATA);\n        // This is an implementation of the algorithm described at\n        // https://html.spec.whatwg.org/multipage/server-sent-events.html#event-stream-interpretation.\n        // Currently the server does not use id or retry lines, so that processing isn't implemented.\n        // ignore trailing LF if not removed by SDK.\n        if (line.endsWith(\"\\n\"))\n            line = line.substr(0, line.length - 1);\n        // ignore trailing CR from CRLF\n        if (line.endsWith(\"\\r\"))\n            line = line.substr(0, line.length - 1);\n        if (line.length === 0) {\n            // This is the \"dispatch the event\" portion of the algorithm.\n            if (this._dataBuffer.length === 0) {\n                this._eventType = \"\";\n                return;\n            }\n            if (this._dataBuffer.endsWith(\"\\n\"))\n                this._dataBuffer = this._dataBuffer.substr(0, this._dataBuffer.length - 1);\n            this.feedSse({\n                data: this._dataBuffer,\n                eventType: this._eventType,\n            });\n            this._dataBuffer = \"\";\n            this._eventType = \"\";\n        }\n        if (line[0] === \":\")\n            return;\n        const colon = line.indexOf(\":\");\n        const field = line.substr(0, colon);\n        let value = colon === -1 ? \"\" : line.substr(colon + 1);\n        if (value.startsWith(\" \"))\n            value = value.substr(1);\n        if (field === \"event\") {\n            this._eventType = value;\n        }\n        else if (field === \"data\") {\n            this._dataBuffer += value;\n            this._dataBuffer += \"\\n\";\n        }\n        else ;\n    }\n    feedSse(sse) {\n        this.assertState(WatchStreamState.NEED_DATA);\n        const firstPercentIndex = sse.data.indexOf(\"%\");\n        if (firstPercentIndex !== -1) {\n            // For some reason, the stich server decided to add percent-encoding for '%', '\\n', and '\\r' to its\n            // event-stream replies. But it isn't real urlencoding, since most characters pass through, so we can't use\n            // uri_percent_decode() here.\n            let buffer = \"\";\n            let start = 0;\n            for (let percentIndex = firstPercentIndex; percentIndex !== -1; percentIndex = sse.data.indexOf(\"%\", start)) {\n                buffer += sse.data.substr(start, percentIndex - start);\n                const encoded = sse.data.substr(percentIndex, 3); // may be smaller than 3 if string ends with %\n                if (encoded === \"%25\") {\n                    buffer += \"%\";\n                }\n                else if (encoded === \"%0A\") {\n                    buffer += \"\\x0A\"; // '\\n'\n                }\n                else if (encoded === \"%0D\") {\n                    buffer += \"\\x0D\"; // '\\r'\n                }\n                else {\n                    buffer += encoded; // propagate as-is\n                }\n                start = percentIndex + encoded.length;\n            }\n            // Advance the buffer with the last part\n            buffer += sse.data.substr(start);\n            sse.data = buffer;\n        }\n        if (!sse.eventType || sse.eventType === \"message\") {\n            try {\n                const parsed = EJSON.parse(sse.data);\n                if (typeof parsed === \"object\") {\n                    // ???\n                    this._nextEvent = parsed;\n                    this._state = WatchStreamState.HAVE_EVENT;\n                    return;\n                }\n            }\n            catch {\n                // fallthrough to same handling as for non-document value.\n            }\n            this._state = WatchStreamState.HAVE_ERROR;\n            this._error = new WatchError({\n                message: \"server returned malformed event: \" + sse.data,\n                code: \"bad bson parse\",\n            });\n        }\n        else if (sse.eventType === \"error\") {\n            this._state = WatchStreamState.HAVE_ERROR;\n            // default error message if we have issues parsing the reply.\n            this._error = new WatchError({\n                message: sse.data,\n                code: \"unknown\",\n            });\n            try {\n                const { error_code: errorCode, error } = EJSON.parse(sse.data);\n                if (typeof errorCode !== \"string\")\n                    return;\n                if (typeof error !== \"string\")\n                    return;\n                // XXX in realm-js, object-store will error if the error_code is not one of the known\n                // error code enum values.\n                this._error = new WatchError({\n                    message: error,\n                    code: errorCode,\n                });\n            }\n            catch {\n                return; // Use the default state.\n            }\n        }\n        else ;\n    }\n    get state() {\n        return this._state;\n    }\n    // Consumes the returned event. If you used feedBuffer(), there may be another event or error after this one,\n    // so you need to call state() again to see what to do next.\n    nextEvent() {\n        this.assertState(WatchStreamState.HAVE_EVENT);\n        // We can use \"as ChangeEvent<T>\" since we just asserted the state.\n        const out = this._nextEvent;\n        this._state = WatchStreamState.NEED_DATA;\n        this.advanceBufferState();\n        return out;\n    }\n    // Once this enters the error state, it stays that way. You should not feed any more data.\n    get error() {\n        return this._error;\n    }\n    ////////////////////////////////////////////\n    advanceBufferState() {\n        this.assertState(WatchStreamState.NEED_DATA);\n        while (this.state === WatchStreamState.NEED_DATA) {\n            if (this._bufferOffset === this._buffer.length) {\n                this._buffer = \"\";\n                this._bufferOffset = 0;\n                return;\n            }\n            // NOTE not supporting CR-only newlines, just LF and CRLF.\n            const nextNewlineIndex = this._buffer.indexOf(\"\\n\", this._bufferOffset);\n            if (nextNewlineIndex === -1) {\n                // We have a partial line.\n                if (this._bufferOffset !== 0) {\n                    // Slide the partial line down to the front of the buffer.\n                    this._buffer = this._buffer.substr(this._bufferOffset, this._buffer.length - this._bufferOffset);\n                    this._bufferOffset = 0;\n                }\n                return;\n            }\n            this.feedLine(this._buffer.substr(this._bufferOffset, nextNewlineIndex - this._bufferOffset));\n            this._bufferOffset = nextNewlineIndex + 1; // Advance past this line, including its newline.\n        }\n    }\n    assertState(state) {\n        if (this._state !== state) {\n            throw Error(`Expected WatchStream to be in state ${state}, but in state ${this._state}`);\n        }\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * A remote collection of documents.\n */\nclass MongoDBCollection {\n    /**\n     * Construct a remote collection of documents.\n     *\n     * @param fetcher The fetcher to use when requesting the service.\n     * @param serviceName The name of the remote service.\n     * @param databaseName The name of the database.\n     * @param collectionName The name of the remote collection.\n     */\n    constructor(fetcher, serviceName, databaseName, collectionName) {\n        this.functions = FunctionsFactory.create(fetcher, {\n            serviceName,\n        });\n        this.databaseName = databaseName;\n        this.collectionName = collectionName;\n        this.serviceName = serviceName;\n        this.fetcher = fetcher;\n    }\n    /** @inheritdoc */\n    find(filter = {}, options = {}) {\n        return this.functions.find({\n            database: this.databaseName,\n            collection: this.collectionName,\n            query: filter,\n            project: options.projection,\n            sort: options.sort,\n            limit: options.limit,\n        });\n    }\n    /** @inheritdoc */\n    findOne(filter = {}, options = {}) {\n        return this.functions.findOne({\n            database: this.databaseName,\n            collection: this.collectionName,\n            query: filter,\n            project: options.projection,\n            sort: options.sort,\n        });\n    }\n    /** @inheritdoc */\n    findOneAndUpdate(filter = {}, update, options = {}) {\n        return this.functions.findOneAndUpdate({\n            database: this.databaseName,\n            collection: this.collectionName,\n            filter,\n            update,\n            sort: options.sort,\n            projection: options.projection,\n            upsert: options.upsert,\n            returnNewDocument: options.returnNewDocument,\n        });\n    }\n    /** @inheritdoc */\n    findOneAndReplace(filter = {}, replacement, options = {}) {\n        return this.functions.findOneAndReplace({\n            database: this.databaseName,\n            collection: this.collectionName,\n            filter: filter,\n            update: replacement,\n            sort: options.sort,\n            projection: options.projection,\n            upsert: options.upsert,\n            returnNewDocument: options.returnNewDocument,\n        });\n    }\n    /** @inheritdoc */\n    findOneAndDelete(filter = {}, options = {}) {\n        return this.functions.findOneAndReplace({\n            database: this.databaseName,\n            collection: this.collectionName,\n            filter,\n            sort: options.sort,\n            projection: options.projection,\n        });\n    }\n    /** @inheritdoc */\n    aggregate(pipeline) {\n        return this.functions.aggregate({\n            database: this.databaseName,\n            collection: this.collectionName,\n            pipeline,\n        });\n    }\n    /** @inheritdoc */\n    count(filter = {}, options = {}) {\n        return this.functions.count({\n            database: this.databaseName,\n            collection: this.collectionName,\n            query: filter,\n            limit: options.limit,\n        });\n    }\n    /** @inheritdoc */\n    insertOne(document) {\n        return this.functions.insertOne({\n            database: this.databaseName,\n            collection: this.collectionName,\n            document,\n        });\n    }\n    /** @inheritdoc */\n    insertMany(documents) {\n        return this.functions.insertMany({\n            database: this.databaseName,\n            collection: this.collectionName,\n            documents,\n        });\n    }\n    /** @inheritdoc */\n    deleteOne(filter = {}) {\n        return this.functions.deleteOne({\n            database: this.databaseName,\n            collection: this.collectionName,\n            query: filter,\n        });\n    }\n    /** @inheritdoc */\n    deleteMany(filter = {}) {\n        return this.functions.deleteMany({\n            database: this.databaseName,\n            collection: this.collectionName,\n            query: filter,\n        });\n    }\n    /** @inheritdoc */\n    updateOne(filter, update, options = {}) {\n        return this.functions.updateOne({\n            database: this.databaseName,\n            collection: this.collectionName,\n            query: filter,\n            update,\n            upsert: options.upsert,\n            arrayFilters: options.arrayFilters,\n        });\n    }\n    /** @inheritdoc */\n    updateMany(filter, update, options = {}) {\n        return this.functions.updateMany({\n            database: this.databaseName,\n            collection: this.collectionName,\n            query: filter,\n            update,\n            upsert: options.upsert,\n            arrayFilters: options.arrayFilters,\n        });\n    }\n    watch({ ids, filter, } = {}) {\n        const iterable = this.functions.callFunctionStreaming(\"watch\", {\n            database: this.databaseName,\n            collection: this.collectionName,\n            ids,\n            filter,\n        });\n        // Unpack the async iterable, making it possible for us to propagate the `return` when this generator is returning\n        const iterator = iterable.then((i) => i[Symbol.asyncIterator]());\n        const stream = this.watchImpl(iterator);\n        // Store the original return on the stream, to enable propagating to the original implementation after we've returned on the iterator\n        const originalReturn = stream.return;\n        return Object.assign(stream, {\n            return(value) {\n                iterator.then((i) => (i.return ? i.return(value) : undefined));\n                return originalReturn.call(stream, value);\n            },\n        });\n    }\n    /**\n     * @param iterator An async iterator of the response body of a watch request.\n     * @yields Change events.\n     * Note: We had to split this from the `watch` method above to enable manually calling `return` on the response body iterator.\n     */\n    async *watchImpl(iterator) {\n        const watchStream = new WatchStream();\n        // Repack the iterator into an interable for the `watchImpl` to consume\n        const iterable = iterator.then((i) => ({ [Symbol.asyncIterator]: () => i }));\n        // Start consuming change events\n        for await (const chunk of await iterable) {\n            if (!chunk)\n                continue;\n            watchStream.feedBuffer(chunk);\n            while (watchStream.state == WatchStreamState.HAVE_EVENT) {\n                yield watchStream.nextEvent();\n            }\n            if (watchStream.state == WatchStreamState.HAVE_ERROR)\n                // XXX this is just throwing an error like {error_code: \"BadRequest, error: \"message\"},\n                // which matches realm-js, but is different from how errors are handled in realm-web\n                throw watchStream.error;\n        }\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Creates an Remote MongoDB Collection.\n * Note: This method exists to enable function binding.\n *\n * @param fetcher The underlying fetcher.\n * @param serviceName A service name.\n * @param databaseName A database name.\n * @param collectionName A collection name.\n * @returns The collection.\n */\nfunction createCollection(fetcher, serviceName, databaseName, collectionName) {\n    return new MongoDBCollection(fetcher, serviceName, databaseName, collectionName);\n}\n/**\n * Creates a Remote MongoDB Database.\n * Note: This method exists to enable function binding.\n *\n * @param fetcher The underlying fetcher\n * @param serviceName A service name\n * @param databaseName A database name\n * @returns The database.\n */\nfunction createDatabase(fetcher, serviceName, databaseName) {\n    return {\n        collection: createCollection.bind(null, fetcher, serviceName, databaseName),\n    };\n}\n/**\n * Creates a Remote MongoDB Service.\n * Note: This method exists to enable function binding.\n *\n * @param fetcher The underlying fetcher.\n * @param serviceName An optional service name.\n * @returns The service.\n */\nfunction createService(fetcher, serviceName = \"mongo-db\") {\n    return { db: createDatabase.bind(null, fetcher, serviceName) };\n}\n\n////////////////////////////////////////////////////////////////////////////\nconst DEFAULT_DEVICE_ID = \"000000000000000000000000\";\n/** The state of a user within the app */\nvar UserState;\n(function (UserState) {\n    /** Active, with both access and refresh tokens */\n    UserState[\"Active\"] = \"active\";\n    /** Logged out, but there might still be data persisted about the user, in the browser. */\n    UserState[\"LoggedOut\"] = \"logged-out\";\n    /** Logged out and all data about the user has been removed. */\n    UserState[\"Removed\"] = \"removed\";\n})(UserState || (UserState = {}));\n/** The type of a user. */\nvar UserType$1;\n(function (UserType) {\n    /** Created by the user itself. */\n    UserType[\"Normal\"] = \"normal\";\n    /** Created by an administrator of the app. */\n    UserType[\"Server\"] = \"server\";\n})(UserType$1 || (UserType$1 = {}));\n/**\n * Representation of an authenticated user of an app.\n */\nclass User {\n    /**\n     * @param parameters Parameters of the user.\n     */\n    constructor(parameters) {\n        this.app = parameters.app;\n        this.id = parameters.id;\n        this.storage = new UserStorage(this.app.storage, this.id);\n        if (\"accessToken\" in parameters && \"refreshToken\" in parameters && \"providerType\" in parameters) {\n            this._accessToken = parameters.accessToken;\n            this._refreshToken = parameters.refreshToken;\n            this.providerType = parameters.providerType;\n            // Save the parameters to storage, for future instances to be hydrated from\n            this.storage.accessToken = parameters.accessToken;\n            this.storage.refreshToken = parameters.refreshToken;\n            this.storage.providerType = parameters.providerType;\n        }\n        else {\n            // Hydrate the rest of the parameters from storage\n            this._accessToken = this.storage.accessToken;\n            this._refreshToken = this.storage.refreshToken;\n            const providerType = this.storage.providerType;\n            this._profile = this.storage.profile;\n            if (providerType) {\n                this.providerType = providerType;\n            }\n            else {\n                throw new Error(\"Storage is missing a provider type\");\n            }\n        }\n        this.fetcher = this.app.fetcher.clone({\n            userContext: { currentUser: this },\n        });\n        this.apiKeys = new ApiKeyAuth(this.fetcher);\n        this.functions = FunctionsFactory.create(this.fetcher);\n    }\n    /**\n     * @returns The access token used to authenticate the user towards Atlas App Services.\n     */\n    get accessToken() {\n        return this._accessToken;\n    }\n    /**\n     * @param token The new access token.\n     */\n    set accessToken(token) {\n        this._accessToken = token;\n        this.storage.accessToken = token;\n    }\n    /**\n     * @returns The refresh token used to issue new access tokens.\n     */\n    get refreshToken() {\n        return this._refreshToken;\n    }\n    /**\n     * @param token The new refresh token.\n     */\n    set refreshToken(token) {\n        this._refreshToken = token;\n        this.storage.refreshToken = token;\n    }\n    /**\n     * @returns The current state of the user.\n     */\n    get state() {\n        if (this.id in this.app.allUsers) {\n            return this.refreshToken === null ? UserState.LoggedOut : UserState.Active;\n        }\n        else {\n            return UserState.Removed;\n        }\n    }\n    /**\n     * @returns The logged in state of the user.\n     */\n    get isLoggedIn() {\n        return this.state === UserState.Active;\n    }\n    get customData() {\n        if (this.accessToken) {\n            const decodedToken = this.decodeAccessToken();\n            return decodedToken.userData;\n        }\n        else {\n            throw new Error(\"Cannot read custom data without an access token\");\n        }\n    }\n    /**\n     * @returns Profile containing detailed information about the user.\n     */\n    get profile() {\n        if (this._profile) {\n            return this._profile.data;\n        }\n        else {\n            throw new Error(\"A profile was never fetched for this user\");\n        }\n    }\n    get identities() {\n        if (this._profile) {\n            return this._profile.identities;\n        }\n        else {\n            throw new Error(\"A profile was never fetched for this user\");\n        }\n    }\n    get deviceId() {\n        if (this.accessToken) {\n            const payload = this.accessToken.split(\".\")[1];\n            if (payload) {\n                const parsedPayload = JSON.parse(gBase64.decode(payload));\n                const deviceId = parsedPayload[\"baas_device_id\"];\n                if (typeof deviceId === \"string\" && deviceId !== DEFAULT_DEVICE_ID) {\n                    return deviceId;\n                }\n            }\n        }\n        return null;\n    }\n    /**\n     * Refresh the users profile data.\n     */\n    async refreshProfile() {\n        // Fetch the latest profile\n        const response = await this.fetcher.fetchJSON({\n            method: \"GET\",\n            path: routes.api().auth().profile().path,\n        });\n        // Create a profile instance\n        this._profile = new UserProfile(response);\n        // Store this for later hydration\n        this.storage.profile = this._profile;\n    }\n    /**\n     * Log out the user, invalidating the session (and its refresh token).\n     */\n    async logOut() {\n        // Invalidate the refresh token\n        try {\n            if (this._refreshToken !== null) {\n                await this.fetcher.fetchJSON({\n                    method: \"DELETE\",\n                    path: routes.api().auth().session().path,\n                    tokenType: \"refresh\",\n                });\n            }\n        }\n        catch (err) {\n            // Ignore failing to delete a missing refresh token\n            // It might have expired or it might be gone due to the user being deleted\n            if (!(err instanceof Error) || !err.message.includes(\"failed to find refresh token\")) {\n                throw err;\n            }\n        }\n        finally {\n            // Forget the access and refresh token\n            this.accessToken = null;\n            this.refreshToken = null;\n        }\n    }\n    /** @inheritdoc */\n    async linkCredentials(credentials) {\n        const response = await this.app.authenticator.authenticate(credentials, this);\n        // Sanity check the response\n        if (this.id !== response.userId) {\n            const details = `got user id ${response.userId} expected ${this.id}`;\n            throw new Error(`Link response ment for another user (${details})`);\n        }\n        // Update the access token\n        this.accessToken = response.accessToken;\n        // Refresh the profile to include the new identity\n        await this.refreshProfile();\n    }\n    /**\n     * Request a new access token, using the refresh token.\n     */\n    async refreshAccessToken() {\n        const response = await this.fetcher.fetchJSON({\n            method: \"POST\",\n            path: routes.api().auth().session().path,\n            tokenType: \"refresh\",\n        });\n        const { access_token: accessToken } = response;\n        if (typeof accessToken === \"string\") {\n            this.accessToken = accessToken;\n        }\n        else {\n            throw new Error(\"Expected an 'access_token' in the response\");\n        }\n    }\n    /** @inheritdoc */\n    async refreshCustomData() {\n        await this.refreshAccessToken();\n        return this.customData;\n    }\n    /**\n     * @inheritdoc\n     */\n    addListener() {\n        throw new Error(\"Not yet implemented\");\n    }\n    /**\n     * @inheritdoc\n     */\n    removeListener() {\n        throw new Error(\"Not yet implemented\");\n    }\n    /**\n     * @inheritdoc\n     */\n    removeAllListeners() {\n        throw new Error(\"Not yet implemented\");\n    }\n    /** @inheritdoc */\n    callFunction(name, ...args) {\n        return this.functions.callFunction(name, ...args);\n    }\n    /**\n     * @returns A plain ol' JavaScript object representation of the user.\n     */\n    toJSON() {\n        return {\n            id: this.id,\n            accessToken: this.accessToken,\n            refreshToken: this.refreshToken,\n            profile: this._profile,\n            state: this.state,\n            customData: this.customData,\n        };\n    }\n    /** @inheritdoc */\n    push() {\n        throw new Error(\"Not yet implemented\");\n    }\n    /** @inheritdoc */\n    mongoClient(serviceName) {\n        return createService(this.fetcher, serviceName);\n    }\n    decodeAccessToken() {\n        if (this.accessToken) {\n            // Decode and spread the token\n            const parts = this.accessToken.split(\".\");\n            if (parts.length !== 3) {\n                throw new Error(\"Expected an access token with three parts\");\n            }\n            // Decode the payload\n            const encodedPayload = parts[1];\n            const decodedPayload = gBase64.decode(encodedPayload);\n            const parsedPayload = JSON.parse(decodedPayload);\n            const { exp: expires, iat: issuedAt, sub: subject, user_data: userData = {} } = parsedPayload;\n            // Validate the types\n            if (typeof expires !== \"number\") {\n                throw new Error(\"Failed to decode access token 'exp'\");\n            }\n            else if (typeof issuedAt !== \"number\") {\n                throw new Error(\"Failed to decode access token 'iat'\");\n            }\n            return { expires, issuedAt, subject, userData };\n        }\n        else {\n            throw new Error(\"Missing an access token\");\n        }\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n// TODO: Ensure the static interface of the Credentials class implements the static interface of Realm.Credentials\n// See https://stackoverflow.com/a/43484801\n/**\n * Instances of this class can be passed to the `app.logIn` method to authenticate an end-user.\n */\nclass Credentials {\n    /**\n     * Constructs an instance of credentials.\n     *\n     * @param providerName The name of the authentication provider used when authenticating.\n     * @param providerType The type of the authentication provider used when authenticating.\n     * @param payload The data being sent to the service when authenticating.\n     */\n    constructor(providerName, providerType, payload) {\n        this.providerName = providerName;\n        this.providerType = providerType;\n        this.payload = payload;\n    }\n    /**\n     * Creates credentials that logs in using the [Anonymous Provider](https://docs.mongodb.com/realm/authentication/anonymous/).\n     *\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static anonymous() {\n        return new Credentials(\"anon-user\", \"anon-user\", {});\n    }\n    /**\n     * Creates credentials that logs in using the [API Key Provider](https://docs.mongodb.com/realm/authentication/api-key/).\n     *\n     * @param key The secret content of the API key.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static apiKey(key) {\n        return new Credentials(\"api-key\", \"api-key\", { key });\n    }\n    /**\n     * Creates credentials that logs in using the [Email/Password Provider](https://docs.mongodb.com/realm/authentication/email-password/).\n     * Note: This was formerly known as the \"Username/Password\" provider.\n     *\n     * @param email The end-users email address.\n     * @param password The end-users password.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static emailPassword(email, password) {\n        return new Credentials(\"local-userpass\", \"local-userpass\", {\n            username: email,\n            password,\n        });\n    }\n    /**\n     * Creates credentials that logs in using the [Custom Function Provider](https://docs.mongodb.com/realm/authentication/custom-function/).\n     *\n     * @param payload The custom payload as expected by the server.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static function(payload) {\n        return new Credentials(\"custom-function\", \"custom-function\", payload);\n    }\n    /**\n     * Creates credentials that logs in using the [Custom JWT Provider](https://docs.mongodb.com/realm/authentication/custom-jwt/).\n     *\n     * @param token The JSON Web Token (JWT).\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static jwt(token) {\n        return new Credentials(\"custom-token\", \"custom-token\", {\n            token,\n        });\n    }\n    /**\n     * Creates credentials that logs in using the [Google Provider](https://docs.mongodb.com/realm/authentication/google/).\n     *\n     * @param payload The URL that users should be redirected to, the auth code or id token from Google.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static google(payload) {\n        return new Credentials(\"oauth2-google\", \"oauth2-google\", Credentials.derivePayload(payload));\n    }\n    /**\n     * @param payload The payload string.\n     * @returns A payload object based on the string.\n     */\n    static derivePayload(payload) {\n        if (typeof payload === \"string\") {\n            throw new Error(\"`google(<tokenString>)` has been deprecated.  Please use `google(<authCodeObject>).\");\n        }\n        else if (Object.keys(payload).length === 1) {\n            if (\"authCode\" in payload || \"redirectUrl\" in payload) {\n                return payload;\n            }\n            else if (\"idToken\" in payload) {\n                return { id_token: payload.idToken };\n            }\n            else {\n                throw new Error(\"Unexpected payload: \" + JSON.stringify(payload));\n            }\n        }\n        else {\n            throw new Error(\"Expected only one property in payload, got \" + JSON.stringify(payload));\n        }\n    }\n    /**\n     * Creates credentials that logs in using the [Facebook Provider](https://docs.mongodb.com/realm/authentication/facebook/).\n     *\n     * @param redirectUrlOrAccessToken The URL that users should be redirected to or the auth code returned from Facebook.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static facebook(redirectUrlOrAccessToken) {\n        return new Credentials(\"oauth2-facebook\", \"oauth2-facebook\", redirectUrlOrAccessToken.includes(\"://\")\n            ? { redirectUrl: redirectUrlOrAccessToken }\n            : { accessToken: redirectUrlOrAccessToken });\n    }\n    /**\n     * Creates credentials that logs in using the [Apple ID Provider](https://docs.mongodb.com/realm/authentication/apple/).\n     *\n     * @param redirectUrlOrIdToken The URL that users should be redirected to or the id_token returned from Apple.\n     * @returns The credentials instance, which can be passed to `app.logIn`.\n     */\n    static apple(redirectUrlOrIdToken) {\n        return new Credentials(\"oauth2-apple\", \"oauth2-apple\", redirectUrlOrIdToken.includes(\"://\") ? { redirectUrl: redirectUrlOrIdToken } : { id_token: redirectUrlOrIdToken });\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\nconst USER_IDS_STORAGE_KEY = \"userIds\";\nconst DEVICE_ID_STORAGE_KEY = \"deviceId\";\n/**\n * Storage specific to the app.\n */\nclass AppStorage extends PrefixedStorage {\n    /**\n     * @param storage The underlying storage to wrap.\n     * @param appId The id of the app.\n     */\n    constructor(storage, appId) {\n        super(storage, `app(${appId})`);\n    }\n    /**\n     * Reads out the list of user ids from storage.\n     *\n     * @returns A list of user ids.\n     */\n    getUserIds() {\n        const userIdsString = this.get(USER_IDS_STORAGE_KEY);\n        const userIds = userIdsString ? JSON.parse(userIdsString) : [];\n        if (Array.isArray(userIds)) {\n            // Remove any duplicates that might have been added\n            // The Set preserves insertion order\n            return [...new Set(userIds)];\n        }\n        else {\n            throw new Error(\"Expected the user ids to be an array\");\n        }\n    }\n    /**\n     * Sets the list of ids in storage.\n     * Optionally merging with existing ids stored in the storage, by prepending these while voiding duplicates.\n     *\n     * @param userIds The list of ids to store.\n     * @param mergeWithExisting Prepend existing ids to avoid data-races with other apps using this storage.\n     */\n    setUserIds(userIds, mergeWithExisting) {\n        if (mergeWithExisting) {\n            // Add any existing user id to the end of this list, avoiding duplicates\n            const existingIds = this.getUserIds();\n            for (const id of existingIds) {\n                if (userIds.indexOf(id) === -1) {\n                    userIds.push(id);\n                }\n            }\n        }\n        // Store the list of ids\n        this.set(USER_IDS_STORAGE_KEY, JSON.stringify(userIds));\n    }\n    /**\n     * Remove an id from the list of ids.\n     *\n     * @param userId The id of a User to be removed.\n     */\n    removeUserId(userId) {\n        const existingIds = this.getUserIds();\n        const userIds = existingIds.filter((id) => id !== userId);\n        // Store the list of ids\n        this.setUserIds(userIds, false);\n    }\n    /**\n     * @returns id of this device (if any exists)\n     */\n    getDeviceId() {\n        return this.get(DEVICE_ID_STORAGE_KEY);\n    }\n    /**\n     * @param deviceId The id of this device, to send on subsequent authentication requests.\n     */\n    setDeviceId(deviceId) {\n        this.set(DEVICE_ID_STORAGE_KEY, deviceId);\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\nconst LOWERCASE_LETTERS = \"abcdefghijklmnopqrstuvwxyz\";\nconst CLOSE_CHECK_INTERVAL = 100; // 10 times per second\nconst REDIRECT_HASH_TO_RESULT = {\n    _stitch_client_app_id: \"appId\",\n    _baas_client_app_id: \"appId\",\n    _stitch_ua: \"userAuth\",\n    _baas_ua: \"userAuth\",\n    _stitch_link: \"link\",\n    _baas_link: \"link\",\n    _stitch_error: \"error\",\n    _baas_error: \"error\",\n    _stitch_state: \"state\",\n    _baas_state: \"state\",\n};\n/**\n * A collection of methods helping implement the OAuth2 flow.\n */\nclass OAuth2Helper {\n    /**\n     * @param storage The underlying storage to use when storing and retriving secrets.\n     * @param openWindow An optional function called when a browser window needs to open.\n     */\n    constructor(storage, openWindow = getEnvironment().openWindow) {\n        this.storage = storage.prefix(\"oauth2\");\n        this.openWindow = openWindow;\n    }\n    /**\n     * Parses the query string from the final step of the OAuth flow.\n     *\n     * @param queryString The query string passed through in location.hash.\n     * @returns The result of the OAuth flow.\n     */\n    static parseRedirectLocation(queryString) {\n        const params = decodeQueryString(queryString);\n        const result = {};\n        for (const [p, r] of Object.entries(REDIRECT_HASH_TO_RESULT)) {\n            const value = params[p];\n            if (value) {\n                result[r] = value;\n            }\n        }\n        return result;\n    }\n    /**\n     * Handle the redirect querystring by parsing it and storing it for others to consume.\n     *\n     * @param queryString The query string containing the encoded result from the OAuth provider.\n     * @param storage The underlying storage used to persist the result.\n     */\n    static handleRedirect(queryString, storage = getEnvironment().defaultStorage) {\n        const result = OAuth2Helper.parseRedirectLocation(queryString);\n        const { state, error } = result;\n        if (typeof state === \"string\") {\n            const oauth2Storage = storage.prefix(\"oauth2\");\n            const stateStorage = OAuth2Helper.getStateStorage(oauth2Storage, state);\n            stateStorage.set(\"result\", JSON.stringify(result));\n        }\n        else if (error) {\n            throw new Error(`Failed to handle OAuth 2.0 redirect: ${error}`);\n        }\n        else {\n            throw new Error(\"Failed to handle OAuth 2.0 redirect.\");\n        }\n    }\n    /**\n     * Decodes the authInfo string into its seperate parts.\n     *\n     * @param authInfo An authInfo string returned from the server.\n     * @returns An object containing the separate parts of the authInfo string.\n     */\n    static decodeAuthInfo(authInfo) {\n        const parts = (authInfo || \"\").split(\"$\");\n        if (parts.length === 4) {\n            const [accessToken, refreshToken, userId, deviceId] = parts;\n            return { accessToken, refreshToken, userId, deviceId };\n        }\n        else {\n            throw new Error(\"Failed to decode 'authInfo' into ids and tokens\");\n        }\n    }\n    /**\n     * Get the storage key associated of an secret associated with a state.\n     *\n     * @param storage The root storage used to derive a \"state namespaced\" storage.\n     * @param state The random state.\n     * @returns The storage associated with a particular state.\n     */\n    static getStateStorage(storage, state) {\n        return storage.prefix(`state(${state})`);\n    }\n    /**\n     * Open a window and wait for the redirect to be handled.\n     *\n     * @param url The URL to open.\n     * @param state The state which will be used to listen for storage updates.\n     * @returns The result passed through the redirect.\n     */\n    openWindowAndWaitForRedirect(url, state) {\n        const stateStorage = OAuth2Helper.getStateStorage(this.storage, state);\n        // Return a promise that resolves when the  gets known\n        return new Promise((resolve, reject) => {\n            let redirectWindow = null;\n            // We're declaring the interval now to enable referencing before its initialized\n            let windowClosedInterval; // eslint-disable-line prefer-const\n            const handleStorageUpdate = () => {\n                // Trying to get the secret from storage\n                const result = stateStorage.get(\"result\");\n                if (result) {\n                    const parsedResult = JSON.parse(result);\n                    // The secret got updated!\n                    stateStorage.removeListener(handleStorageUpdate);\n                    // Clear the storage to prevent others from reading this\n                    stateStorage.clear();\n                    // Try closing the newly created window\n                    try {\n                        if (redirectWindow) {\n                            // Stop checking if the window closed\n                            clearInterval(windowClosedInterval);\n                            redirectWindow.close();\n                        }\n                    }\n                    catch (err) {\n                        console.warn(`Failed closing redirect window: ${err}`);\n                    }\n                    finally {\n                        resolve(parsedResult);\n                    }\n                }\n            };\n            // Add a listener to the state storage, awaiting an update to the secret\n            stateStorage.addListener(handleStorageUpdate);\n            // Open up a window\n            redirectWindow = this.openWindow(url);\n            // Not using a const, because we need the two listeners to reference each other when removing the other.\n            windowClosedInterval = setInterval(() => {\n                // Polling \"closed\" because registering listeners on the window violates cross-origin policies\n                if (!redirectWindow) {\n                    // No need to keep polling for a window that we can't check\n                    clearInterval(windowClosedInterval);\n                }\n                else if (redirectWindow.closed) {\n                    // Stop polling the window state\n                    clearInterval(windowClosedInterval);\n                    // Stop listening for changes to the storage\n                    stateStorage.removeListener(handleStorageUpdate);\n                    // Reject the promise\n                    const err = new Error(\"Window closed\");\n                    reject(err);\n                }\n            }, CLOSE_CHECK_INTERVAL);\n        });\n    }\n    /**\n     * Generate a random state string.\n     *\n     * @returns The random state string.\n     */\n    generateState() {\n        return generateRandomString(12, LOWERCASE_LETTERS);\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\nconst REDIRECT_LOCATION_HEADER = \"x-baas-location\";\n/**\n * Handles authentication and linking of users.\n */\nclass Authenticator {\n    /**\n     * @param fetcher The fetcher used to fetch responses from the server.\n     * @param storage The storage used when completing OAuth 2.0 flows (should not be scoped to a specific app).\n     * @param getDeviceInformation Called to get device information to be sent to the server.\n     */\n    constructor(fetcher, storage, getDeviceInformation) {\n        this.fetcher = fetcher;\n        this.oauth2 = new OAuth2Helper(storage);\n        this.getDeviceInformation = getDeviceInformation;\n    }\n    /**\n     * @param credentials Credentials to use when logging in.\n     * @param linkingUser A user requesting to link.\n     * @returns A promise resolving to the response from the server.\n     */\n    async authenticate(credentials, linkingUser) {\n        const deviceInformation = this.getDeviceInformation();\n        const isLinking = typeof linkingUser === \"object\";\n        if (credentials.providerType.startsWith(\"oauth2\") && typeof credentials.payload.redirectUrl === \"string\") {\n            // Initiate the OAuth2 flow by generating a state and fetch a redirect URL\n            const state = this.oauth2.generateState();\n            const url = await this.getLogInUrl(credentials, isLinking, {\n                state,\n                redirect: credentials.payload.redirectUrl,\n                // Ensure redirects are communicated in a header different from \"Location\" and status remains 200 OK\n                providerRedirectHeader: isLinking ? true : undefined,\n                // Add the device information, only if we're not linking - since that request won't have a body of its own.\n                device: !isLinking ? deviceInformation.encode() : undefined,\n            });\n            // If we're linking, we need to send the users access token in the request\n            if (isLinking) {\n                const response = await this.fetcher.fetch({\n                    method: \"GET\",\n                    url,\n                    tokenType: isLinking ? \"access\" : \"none\",\n                    user: linkingUser,\n                    // The response will set a cookie that we need to tell the browser to store\n                    mode: \"cors\",\n                    credentials: \"include\",\n                });\n                // If a response header contains a redirect URL: Open a window and wait for the redirect to be handled\n                const redirectUrl = response.headers.get(REDIRECT_LOCATION_HEADER);\n                if (redirectUrl) {\n                    return this.openWindowAndWaitForAuthResponse(redirectUrl, state);\n                }\n                else {\n                    throw new Error(`Missing ${REDIRECT_LOCATION_HEADER} header`);\n                }\n            }\n            else {\n                // Otherwise we can open a window and let the server redirect the user right away\n                // This gives lower latency (as we don't need the client to receive and execute the redirect in code)\n                // This also has less dependency on cookies and doesn't sent any tokens.\n                return this.openWindowAndWaitForAuthResponse(url, state);\n            }\n        }\n        else {\n            const logInUrl = await this.getLogInUrl(credentials, isLinking);\n            const response = await this.fetcher.fetchJSON({\n                method: \"POST\",\n                url: logInUrl,\n                body: {\n                    ...credentials.payload,\n                    options: {\n                        device: deviceInformation.toJSON(),\n                    },\n                },\n                tokenType: isLinking ? \"access\" : \"none\",\n                user: linkingUser,\n            });\n            // Spread out values from the response and ensure they're valid\n            const { user_id: userId, access_token: accessToken, refresh_token: refreshToken = null, device_id: deviceId, } = response;\n            if (typeof userId !== \"string\") {\n                throw new Error(\"Expected a user id in the response\");\n            }\n            if (typeof accessToken !== \"string\") {\n                throw new Error(\"Expected an access token in the response\");\n            }\n            if (typeof refreshToken !== \"string\" && refreshToken !== null) {\n                throw new Error(\"Expected refresh token to be a string or null\");\n            }\n            if (typeof deviceId !== \"string\") {\n                throw new Error(\"Expected device id to be a string\");\n            }\n            return { userId, accessToken, refreshToken, deviceId };\n        }\n    }\n    /**\n     * @param credentials Credentials to use when logging in.\n     * @param link Should the request link with the current user?\n     * @param extraQueryParams Any extra parameters to include in the query string\n     * @returns A promise resolving to the url to be used when logging in.\n     */\n    async getLogInUrl(credentials, link = false, extraQueryParams = {}) {\n        // See https://github.com/mongodb/stitch-js-sdk/blob/310f0bd5af80f818cdfbc3caf1ae29ffa8e9c7cf/packages/core/sdk/src/auth/internal/CoreStitchAuth.ts#L746-L780\n        const appRoute = this.fetcher.appRoute;\n        const loginRoute = appRoute.authProvider(credentials.providerName).login();\n        const qs = encodeQueryString({\n            link: link ? \"true\" : undefined,\n            ...extraQueryParams,\n        });\n        const locationUrl = await this.fetcher.locationUrl;\n        return locationUrl + loginRoute.path + qs;\n    }\n    async openWindowAndWaitForAuthResponse(redirectUrl, state) {\n        const redirectResult = await this.oauth2.openWindowAndWaitForRedirect(redirectUrl, state);\n        // Decode the auth info (id, tokens, etc.) from the result of the redirect\n        return OAuth2Helper.decodeAuthInfo(redirectResult.userAuth);\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2020 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n// TODO: Determine if the shape of an error response is specific to each service or widely used.\n/**\n * An error produced while communicating with the MongoDB Realm server.\n */\nclass MongoDBRealmError extends Error {\n    constructor(method, url, statusCode, statusText, error, errorCode, link) {\n        const summary = statusText ? `status ${statusCode} ${statusText}` : `status ${statusCode}`;\n        if (typeof error === \"string\") {\n            super(`Request failed (${method} ${url}): ${error} (${summary})`);\n        }\n        else {\n            super(`Request failed (${method} ${url}): (${summary})`);\n        }\n        this.method = method;\n        this.url = url;\n        this.statusText = statusText;\n        this.statusCode = statusCode;\n        this.error = error;\n        this.errorCode = errorCode;\n        this.link = link;\n    }\n    /**\n     * Constructs and returns an error from a request and a response.\n     * Note: The caller must throw this error themselves.\n     *\n     * @param request The request sent to the server.\n     * @param response A raw response, as returned from the server.\n     * @returns An error from a request and a response.\n     */\n    static async fromRequestAndResponse(request, response) {\n        var _a;\n        const { url, method } = request;\n        const { status, statusText } = response;\n        if ((_a = response.headers.get(\"content-type\")) === null || _a === void 0 ? void 0 : _a.startsWith(\"application/json\")) {\n            const body = await response.json();\n            if (typeof body === \"object\" && body) {\n                const { error, error_code: errorCode, link } = body;\n                return new MongoDBRealmError(method, url, status, statusText, typeof error === \"string\" ? error : undefined, typeof errorCode === \"string\" ? errorCode : undefined, typeof link === \"string\" ? link : undefined);\n            }\n        }\n        return new MongoDBRealmError(method, url, status, statusText);\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * @param body A possible resonse body.\n * @returns An async iterator.\n */\nfunction asyncIteratorFromResponseBody(body) {\n    if (typeof body !== \"object\" || body === null) {\n        throw new Error(\"Expected a non-null object\");\n    }\n    else if (Symbol.asyncIterator in body) {\n        return body;\n    }\n    else if (\"getReader\" in body) {\n        const stream = body;\n        return {\n            [Symbol.asyncIterator]() {\n                const reader = stream.getReader();\n                return {\n                    next() {\n                        return reader.read();\n                    },\n                    async return() {\n                        await reader.cancel();\n                        return { done: true, value: null };\n                    },\n                };\n            },\n        };\n    }\n    else {\n        throw new Error(\"Expected an AsyncIterable or a ReadableStream\");\n    }\n}\n/**\n * Wraps a NetworkTransport from the \"@realm/network-transport\" package.\n * Extracts error messages and throws `MongoDBRealmError` objects upon failures.\n * Injects access or refresh tokens for a current or specific user.\n * Refreshes access tokens if requests fails due to a 401 error.\n * Optionally parses response as JSON before returning it.\n * Fetches and exposes an app's location url.\n */\nclass Fetcher {\n    /**\n     * @param config A configuration of the fetcher.\n     * @param config.appId The application id.\n     * @param config.transport The transport used when fetching.\n     * @param config.userContext An object used to determine the requesting user.\n     * @param config.locationUrlContext An object used to determine the location / base URL.\n     */\n    constructor({ appId, transport, userContext, locationUrlContext }) {\n        this.appId = appId;\n        this.transport = transport;\n        this.userContext = userContext;\n        this.locationUrlContext = locationUrlContext;\n    }\n    /**\n     * @param user An optional user to generate the header for.\n     * @param tokenType The type of token (access or refresh).\n     * @returns An object containing the user's token as \"Authorization\" header or undefined if no user is given.\n     */\n    static buildAuthorizationHeader(user, tokenType) {\n        if (!user || tokenType === \"none\") {\n            return {};\n        }\n        else if (tokenType === \"access\") {\n            return { Authorization: `Bearer ${user.accessToken}` };\n        }\n        else if (tokenType === \"refresh\") {\n            return { Authorization: `Bearer ${user.refreshToken}` };\n        }\n        else {\n            throw new Error(`Unexpected token type (${tokenType})`);\n        }\n    }\n    /**\n     * @param body The body string or object passed from a request.\n     * @returns An object optionally specifying the \"Content-Type\" header.\n     */\n    static buildBody(body) {\n        if (!body) {\n            return;\n        }\n        else if (typeof body === \"object\" && body !== null) {\n            return JSON.stringify(serialize(body));\n        }\n        else if (typeof body === \"string\") {\n            return body;\n        }\n        else {\n            console.log(\"body is\", body);\n            throw new Error(\"Unexpected type of body\");\n        }\n    }\n    /**\n     * @param body The body string or object passed from a request.\n     * @returns An object optionally specifying the \"Content-Type\" header.\n     */\n    static buildJsonHeader(body) {\n        if (body && body.length > 0) {\n            return { \"Content-Type\": \"application/json\" };\n        }\n        else {\n            return {};\n        }\n    }\n    clone(config) {\n        return new Fetcher({\n            appId: this.appId,\n            transport: this.transport,\n            userContext: this.userContext,\n            locationUrlContext: this.locationUrlContext,\n            ...config,\n        });\n    }\n    /**\n     * Fetch a network resource as an authenticated user.\n     *\n     * @param request The request which should be sent to the server.\n     * @returns The response from the server.\n     */\n    async fetch(request) {\n        const { path, url, tokenType = \"access\", user = this.userContext.currentUser, ...restOfRequest } = request;\n        if (typeof path === \"string\" && typeof url === \"string\") {\n            throw new Error(\"Use of 'url' and 'path' mutually exclusive\");\n        }\n        else if (typeof path === \"string\") {\n            // Derive the URL\n            const url = (await this.locationUrlContext.locationUrl) + path;\n            return this.fetch({ ...request, path: undefined, url });\n        }\n        else if (typeof url === \"string\") {\n            const response = await this.transport.fetch({\n                ...restOfRequest,\n                url,\n                headers: {\n                    ...Fetcher.buildAuthorizationHeader(user, tokenType),\n                    ...request.headers,\n                },\n            });\n            if (response.ok) {\n                return response;\n            }\n            else if (user && response.status === 401 && tokenType === \"access\") {\n                // If the access token has expired, it would help refreshing it\n                await user.refreshAccessToken();\n                // Retry with the specific user, since the currentUser might have changed.\n                return this.fetch({ ...request, user });\n            }\n            else {\n                if (user && response.status === 401 && tokenType === \"refresh\") {\n                    // A 401 error while using the refresh token indicates the token has an issue.\n                    // Reset the tokens to prevent a lock.\n                    user.accessToken = null;\n                    user.refreshToken = null;\n                }\n                // Throw an error with a message extracted from the body\n                throw await MongoDBRealmError.fromRequestAndResponse(request, response);\n            }\n        }\n        else {\n            throw new Error(\"Expected either 'url' or 'path'\");\n        }\n    }\n    /**\n     * Fetch a network resource as an authenticated user and parse the result as extended JSON.\n     *\n     * @param request The request which should be sent to the server.\n     * @returns The response from the server, parsed as extended JSON.\n     */\n    async fetchJSON(request) {\n        const { body } = request;\n        const serializedBody = Fetcher.buildBody(body);\n        const contentTypeHeaders = Fetcher.buildJsonHeader(serializedBody);\n        const response = await this.fetch({\n            ...request,\n            body: serializedBody,\n            headers: {\n                Accept: \"application/json\",\n                ...contentTypeHeaders,\n                ...request.headers,\n            },\n        });\n        const contentType = response.headers.get(\"content-type\");\n        if (contentType === null || contentType === void 0 ? void 0 : contentType.startsWith(\"application/json\")) {\n            const responseBody = await response.json();\n            return deserialize(responseBody);\n        }\n        else if (contentType === null) {\n            return null;\n        }\n        else {\n            throw new Error(`Expected JSON response, got \"${contentType}\"`);\n        }\n    }\n    /**\n     * Fetch an \"event-stream\" resource as an authenticated user.\n     *\n     * @param request The request which should be sent to the server.\n     * @returns An async iterator over the response body.\n     */\n    async fetchStream(request) {\n        const { body } = await this.fetch({\n            ...request,\n            headers: {\n                Accept: \"text/event-stream\",\n                ...request.headers,\n            },\n        });\n        return asyncIteratorFromResponseBody(body);\n    }\n    /**\n     * @returns The path of the app route.\n     */\n    get appRoute() {\n        return routes.api().app(this.appId);\n    }\n    /**\n     * @returns A promise of the location URL of the app.\n     */\n    get locationUrl() {\n        return this.locationUrlContext.locationUrl;\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * The key in a storage on which the device id is stored.\n */\nconst DEVICE_ID_STORAGE_KEY$1 = \"deviceId\";\nvar DeviceFields;\n(function (DeviceFields) {\n    DeviceFields[\"DEVICE_ID\"] = \"deviceId\";\n    DeviceFields[\"APP_ID\"] = \"appId\";\n    DeviceFields[\"APP_VERSION\"] = \"appVersion\";\n    DeviceFields[\"PLATFORM\"] = \"platform\";\n    DeviceFields[\"PLATFORM_VERSION\"] = \"platformVersion\";\n    DeviceFields[\"SDK_VERSION\"] = \"sdkVersion\";\n})(DeviceFields || (DeviceFields = {}));\n/**\n * Information describing the device, app and SDK.\n */\nclass DeviceInformation {\n    /**\n     * @param params Construct the device information from these parameters.\n     * @param params.appId A user-defined application id.\n     * @param params.appVersion A user-defined application version.\n     * @param params.deviceId An unique id for the end-users device.\n     */\n    constructor({ appId, appVersion, deviceId }) {\n        /**\n         * The version of the Realm Web SDK (constant provided by Rollup).\n         */\n        this.sdkVersion = \"2.0.0\";\n        const environment = getEnvironment();\n        this.platform = environment.platform;\n        this.platformVersion = environment.platformVersion;\n        this.appId = appId;\n        this.appVersion = appVersion;\n        this.deviceId = deviceId;\n    }\n    /**\n     * @returns An base64 URI encoded representation of the device information.\n     */\n    encode() {\n        const obj = removeKeysWithUndefinedValues(this);\n        return gBase64.encode(JSON.stringify(obj));\n    }\n    /**\n     * @returns The defaults\n     */\n    toJSON() {\n        return removeKeysWithUndefinedValues(this);\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Default base url to prefix all requests if no baseUrl is specified in the configuration.\n */\nconst DEFAULT_BASE_URL = \"https://realm.mongodb.com\";\n/**\n * Atlas App Services Application\n */\nclass App {\n    /**\n     * Construct a Realm App, either from the Realm App id visible from the Atlas App Services UI or a configuration.\n     *\n     * @param idOrConfiguration The Realm App id or a configuration to use for this app.\n     */\n    constructor(idOrConfiguration) {\n        /**\n         * An array of active and logged-out users.\n         * Elements in the beginning of the array is considered more recent than the later elements.\n         */\n        this.users = [];\n        /**\n         * A promise resolving to the App's location url.\n         */\n        this._locationUrl = null;\n        // If the argument is a string, convert it to a simple configuration object.\n        const configuration = typeof idOrConfiguration === \"string\" ? { id: idOrConfiguration } : idOrConfiguration;\n        // Initialize properties from the configuration\n        if (typeof configuration === \"object\" && typeof configuration.id === \"string\") {\n            this.id = configuration.id;\n        }\n        else {\n            throw new Error(\"Missing an Atlas App Services app-id\");\n        }\n        this.baseUrl = configuration.baseUrl || DEFAULT_BASE_URL;\n        if (configuration.skipLocationRequest) {\n            // Use the base url directly, instead of requesting a location URL from the server\n            this._locationUrl = Promise.resolve(this.baseUrl);\n        }\n        this.localApp = configuration.app;\n        const { storage, transport = new DefaultNetworkTransport() } = configuration;\n        // Construct a fetcher wrapping the network transport\n        this.fetcher = new Fetcher({\n            appId: this.id,\n            userContext: this,\n            locationUrlContext: this,\n            transport,\n        });\n        // Construct the auth providers\n        this.emailPasswordAuth = new EmailPasswordAuth(this.fetcher);\n        // Construct the storage\n        const baseStorage = storage || getEnvironment().defaultStorage;\n        this.storage = new AppStorage(baseStorage, this.id);\n        this.authenticator = new Authenticator(this.fetcher, baseStorage, () => this.deviceInformation);\n        // Hydrate the app state from storage\n        try {\n            this.hydrate();\n        }\n        catch (err) {\n            // The storage was corrupted\n            this.storage.clear();\n            // A failed hydration shouldn't throw and break the app experience\n            // Since this is \"just\" persisted state that unfortunately got corrupted or partially lost\n            console.warn(\"Realm app hydration failed:\", err instanceof Error ? err.message : err);\n        }\n    }\n    /**\n     * Get or create a singleton Realm App from an id.\n     * Calling this function multiple times with the same id will return the same instance.\n     *\n     * @param id The Realm App id visible from the Atlas App Services UI or a configuration.\n     * @returns The Realm App instance.\n     */\n    static getApp(id) {\n        if (id in App.appCache) {\n            return App.appCache[id];\n        }\n        else {\n            const instance = new App(id);\n            App.appCache[id] = instance;\n            return instance;\n        }\n    }\n    /**\n     * Switch user.\n     *\n     * @param nextUser The user or id of the user to switch to.\n     */\n    switchUser(nextUser) {\n        const index = this.users.findIndex((u) => u === nextUser);\n        if (index === -1) {\n            throw new Error(\"The user was never logged into this app\");\n        }\n        // Remove the user from the stack\n        const [user] = this.users.splice(index, 1);\n        // Insert the user in the beginning of the stack\n        this.users.unshift(user);\n    }\n    /**\n     * Log in a user.\n     *\n     * @param credentials Credentials to use when logging in.\n     * @param fetchProfile Should the users profile be fetched? (default: true)\n     * @returns A promise resolving to the newly logged in user.\n     */\n    async logIn(credentials, fetchProfile = true) {\n        const response = await this.authenticator.authenticate(credentials);\n        const user = this.createOrUpdateUser(response, credentials.providerType);\n        // Let's ensure this will be the current user, in case the user object was reused.\n        this.switchUser(user);\n        // If needed, fetch and set the profile on the user\n        if (fetchProfile) {\n            await user.refreshProfile();\n        }\n        // Persist the user id in the storage,\n        // merging to avoid overriding logins from other apps using the same underlying storage\n        this.storage.setUserIds(this.users.map((u) => u.id), true);\n        // Read out and store the device id from the server\n        const deviceId = response.deviceId;\n        if (deviceId && deviceId !== \"000000000000000000000000\") {\n            this.storage.set(DEVICE_ID_STORAGE_KEY$1, deviceId);\n        }\n        // Return the user\n        return user;\n    }\n    /**\n     * @inheritdoc\n     */\n    async removeUser(user) {\n        // Remove the user from the list of users\n        const index = this.users.findIndex((u) => u === user);\n        if (index === -1) {\n            throw new Error(\"The user was never logged into this app\");\n        }\n        this.users.splice(index, 1);\n        // Log out the user - this removes access and refresh tokens from storage\n        await user.logOut();\n        // Remove the users profile from storage\n        this.storage.remove(`user(${user.id}):profile`);\n        // Remove the user from the storage\n        this.storage.removeUserId(user.id);\n    }\n    /**\n     * @inheritdoc\n     */\n    async deleteUser(user) {\n        await this.fetcher.fetchJSON({\n            method: \"DELETE\",\n            path: routes.api().auth().delete().path,\n        });\n        await this.removeUser(user);\n    }\n    /**\n     * @inheritdoc\n     */\n    addListener() {\n        throw new Error(\"Not yet implemented\");\n    }\n    /**\n     * @inheritdoc\n     */\n    removeListener() {\n        throw new Error(\"Not yet implemented\");\n    }\n    /**\n     * @inheritdoc\n     */\n    removeAllListeners() {\n        throw new Error(\"Not yet implemented\");\n    }\n    /**\n     * The currently active user (or null if no active users exists).\n     *\n     * @returns the currently active user or null.\n     */\n    get currentUser() {\n        const activeUsers = this.users.filter((user) => user.state === UserState.Active);\n        if (activeUsers.length === 0) {\n            return null;\n        }\n        else {\n            // Current user is the top of the stack\n            return activeUsers[0];\n        }\n    }\n    /**\n     * All active and logged-out users:\n     *  - First in the list are active users (ordered by most recent call to switchUser or login)\n     *  - Followed by logged out users (also ordered by most recent call to switchUser or login).\n     *\n     * @returns An array of users active or logged out users (current user being the first).\n     */\n    get allUsers() {\n        // Returning a freezed copy of the list of users to prevent outside changes\n        return Object.fromEntries(this.users.map((user) => [user.id, user]));\n    }\n    /**\n     * @returns A promise of the app URL, with the app location resolved.\n     */\n    get locationUrl() {\n        if (!this._locationUrl) {\n            const path = routes.api().app(this.id).location().path;\n            this._locationUrl = this.fetcher\n                .fetchJSON({\n                method: \"GET\",\n                url: this.baseUrl + path,\n                tokenType: \"none\",\n            })\n                .then((body) => {\n                if (typeof body !== \"object\") {\n                    throw new Error(\"Expected response body be an object\");\n                }\n                else {\n                    return body;\n                }\n            })\n                .then(({ hostname }) => {\n                if (typeof hostname !== \"string\") {\n                    throw new Error(\"Expected response to contain a 'hostname'\");\n                }\n                else {\n                    return hostname;\n                }\n            })\n                .catch((err) => {\n                // Reset the location to allow another request to fetch again.\n                this._locationUrl = null;\n                throw err;\n            });\n        }\n        return this._locationUrl;\n    }\n    /**\n     * @returns Information about the current device, sent to the server when authenticating.\n     */\n    get deviceInformation() {\n        const deviceIdStr = this.storage.getDeviceId();\n        const deviceId = typeof deviceIdStr === \"string\" && deviceIdStr !== \"000000000000000000000000\"\n            ? new ObjectId(deviceIdStr)\n            : undefined;\n        return new DeviceInformation({\n            appId: this.localApp ? this.localApp.name : undefined,\n            appVersion: this.localApp ? this.localApp.version : undefined,\n            deviceId,\n        });\n    }\n    /**\n     * Create (and store) a new user or update an existing user's access and refresh tokens.\n     * This helps de-duplicating users in the list of users known to the app.\n     *\n     * @param response A response from the Authenticator.\n     * @param providerType The type of the authentication provider used.\n     * @returns A new or an existing user.\n     */\n    createOrUpdateUser(response, providerType) {\n        const existingUser = this.users.find((u) => u.id === response.userId);\n        if (existingUser) {\n            // Update the users access and refresh tokens\n            existingUser.accessToken = response.accessToken;\n            existingUser.refreshToken = response.refreshToken;\n            return existingUser;\n        }\n        else {\n            // Create and store a new user\n            if (!response.refreshToken) {\n                throw new Error(\"No refresh token in response from server\");\n            }\n            const user = new User({\n                app: this,\n                id: response.userId,\n                accessToken: response.accessToken,\n                refreshToken: response.refreshToken,\n                providerType,\n            });\n            this.users.unshift(user);\n            return user;\n        }\n    }\n    /**\n     * Restores the state of the app (active and logged-out users) from the storage\n     */\n    hydrate() {\n        const userIds = this.storage.getUserIds();\n        this.users = userIds.map((id) => new User({ app: this, id }));\n    }\n}\n/**\n * A map of app instances returned from calling getApp.\n */\nApp.appCache = {};\n/**\n * Instances of this class can be passed to the `app.logIn` method to authenticate an end-user.\n */\nApp.Credentials = Credentials;\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Get or create a singleton Realm App from an id.\n * Calling this function multiple times with the same id will return the same instance.\n *\n * @param id The Realm App id visible from the Atlas App Services UI or a configuration.\n * @returns The Realm App instance.\n */\nfunction getApp(id) {\n    return App.getApp(id);\n}\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * Set the value of `isDevelopmentMode`. This allows each entry point (node vs DOM)\n * to use its own method for determining whether we are in development mode.\n *\n * @param state A boolean indicating whether the user's app is running in\n * development mode or not.\n */\nconst setIsDevelopmentMode$1 = (state) => {\n};\n\n////////////////////////////////////////////////////////////////////////////\n//\n// Copyright 2022 Realm Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n// http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n////////////////////////////////////////////////////////////////////////////\n// Exports a globalThis which is polyfilled for iOS 11/12\n// From https://github.com/zloirock/core-js/blob/master/packages/core-js/internals/global.js\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst check$1 = function (it) {\n    return it && it.Math == Math && it;\n};\n// eslint-disable-next-line no-restricted-globals\nconst safeGlobalThis$1 = \n// eslint-disable-next-line no-restricted-globals\ncheck$1(typeof globalThis == \"object\" && globalThis) ||\n    check$1(typeof window == \"object\" && window) ||\n    // eslint-disable-next-line no-restricted-globals -- safe\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore allow `self`\n    check$1(typeof self == \"object\" && self) ||\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore allow `global`\n    check$1(typeof global == \"object\" && global) ||\n    // eslint-disable-next-line no-new-func -- fallback\n    (function () {\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore allow `this`\n        return this;\n    })() ||\n    Function(\"return this\")();\n\n////////////////////////////////////////////////////////////////////////////\n// React/React Native set a global __DEV__ variable when running in dev mode\nsetIsDevelopmentMode$1(typeof __DEV__ !== \"undefined\" && __DEV__);\n\n////////////////////////////////////////////////////////////////////////////\n/**\n * In-memory storage that will not be persisted.\n */\nclass LocalStorage {\n    /**\n     * Constructs a LocalStorage using the global window.\n     */\n    constructor() {\n        if (typeof safeGlobalThis$1.localStorage === \"object\") {\n            this.global = safeGlobalThis$1;\n        }\n        else {\n            throw new Error(\"Cannot use LocalStorage without a global localStorage object\");\n        }\n    }\n    /** @inheritdoc */\n    get(key) {\n        return this.global.localStorage.getItem(key);\n    }\n    /** @inheritdoc */\n    set(key, value) {\n        return this.global.localStorage.setItem(key, value);\n    }\n    /** @inheritdoc */\n    remove(key) {\n        return this.global.localStorage.removeItem(key);\n    }\n    /** @inheritdoc */\n    prefix(keyPart) {\n        return new PrefixedStorage(this, keyPart);\n    }\n    /** @inheritdoc */\n    clear(prefix) {\n        const keys = [];\n        // Iterate all keys to find the once have a matching prefix.\n        for (let i = 0; i < this.global.localStorage.length; i++) {\n            const key = this.global.localStorage.key(i);\n            if (key && (!prefix || key.startsWith(prefix))) {\n                keys.push(key);\n            }\n        }\n        // Remove the items in a seperate loop to avoid updating while iterating.\n        for (const key of keys) {\n            this.global.localStorage.removeItem(key);\n        }\n    }\n    /** @inheritdoc */\n    addListener(listener) {\n        return this.global.addEventListener(\"storage\", listener);\n    }\n    /** @inheritdoc */\n    removeListener(listener) {\n        return this.global.removeEventListener(\"storage\", listener);\n    }\n}\n\n////////////////////////////////////////////////////////////////////////////\nconst browser = detect();\nconst DefaultStorage = \"localStorage\" in safeGlobalThis$1 ? LocalStorage : MemoryStorage;\n/**\n * Attempt to use the browser to open a window\n *\n * @param url The url to open a window to.\n * @returns Then newly create window.\n */\nfunction openWindow(url) {\n    if (typeof safeGlobalThis$1.open === \"function\") {\n        return safeGlobalThis$1.open(url);\n    }\n    else {\n        console.log(`Please open ${url}`);\n        return null;\n    }\n}\nconst environment$1 = {\n    defaultStorage: new DefaultStorage().prefix(\"realm-web\"),\n    openWindow,\n    platform: (browser === null || browser === void 0 ? void 0 : browser.name) || \"web\",\n    platformVersion: (browser === null || browser === void 0 ? void 0 : browser.version) || \"0.0.0\",\n    TextDecoder,\n};\nsetEnvironment(environment$1);\n/**\n * Handle an OAuth 2.0 redirect.\n *\n * @param location An optional location to use (defaults to the windows current location).\n * @param storage Optional storage used to save any results from the location.\n */\nfunction handleAuthRedirect(location = safeGlobalThis$1.location, storage = environment$1.defaultStorage) {\n    try {\n        const queryString = location.hash.substr(1); // Strip the initial # from the hash\n        OAuth2Helper.handleRedirect(queryString, storage);\n    }\n    catch (err) {\n        // Ensure calling this never throws: It should not interrupt a users flow.\n        console.warn(err);\n    }\n}\n\nexport { App, Credentials, DEFAULT_BASE_URL, LocalStorage, MongoDBRealmError, User, UserState, UserType$1 as UserType, getApp, getEnvironment, handleAuthRedirect, setEnvironment };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}